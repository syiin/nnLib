// @tensorflow/tfjs Copyright 2018 Google
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.tf=t.tf||{})}(this,function(t){"use strict";var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function n(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function r(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function i(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function o(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function a(t){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}}function s(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function u(t,e,n){return Math.max(t,Math.min(e,n))}function l(t,e){return Math.random()*(e-t)+t}function c(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function h(t,e,n){void 0===n&&(n=""),c(v(t,e),n+" Shapes "+t+" and "+e+" must match")}function p(t){c(null!=t,"The input to the tensor constructor must be a non-null value.")}function f(t,e){if(void 0===e&&(e=[]),Array.isArray(t))for(var n=0;n<t.length;++n)f(t[n],e);else e.push(t);return e}function d(t){var e=t;if(N(t))return[t.length];if(!Array.isArray(t))return[];for(var n=[];e instanceof Array;)n.push(e.length),e=e[0];return t instanceof Array&&function t(e,n,r){if(r=r||[],e instanceof Array){c(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),c(e.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"});for(var i=n.slice(1),o=0;o<e.length;++o)t(e[o],i,r.concat(o))}else c(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array of "+n[0]+" elements"})}(t,n,[]),n}function g(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function v(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function m(t){return t%1==0}function y(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function b(t){for(var e=Math.floor(Math.sqrt(t));e>1;--e)if(t%e==0)return[e,t/e];return[1,t]}function w(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function x(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise(function(r,i){var o=0,a=function(){if(t())r();else{var s=e(++o);null!=n&&o>=n?i():setTimeout(a,s)}};a()})}function S(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")}),e}function E(t,e){for(var n=1,r=-1,i=0;i<t.length;++i)if(t[i]>0)n*=t[i];else if(-1===t[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found - 1 at dim "+r+" and dim "+i);r=i}else if(t[i]<=0)throw Error("Shapes can not be <= 0. Found "+t[i]+" at dim "+i);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var o=t.slice();return o[r]=e/n,o}function k(t,e){for(var n=[],r=[],i=0,o=0;o<t.length;++o){if(null!=e){if(e[i]===o&&t[o]>1)throw new Error("Can't squeeze axis "+o+" since its dim '"+t[o]+"' is not 1");(null==e[i]||e[i]>o)&&1===t[o]&&(n.push(t[o]),r.push(o)),e[i]<=o&&i++}t[o]>1&&(n.push(t[o]),r.push(o))}return{newShape:n,keptDims:r}}function C(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function R(t,e,n){if("float32"===e)for(var r=0;r<t.length;r++)if(isNaN(t[r]))throw Error("The result of the '"+n+"' has NaNs.")}function I(t,e){return!("float32"===e||"int32"===e&&"float32"!==t||"bool"===e&&"bool"===t)}function A(t,e){if(null==e||"float32"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var n=new Uint8Array(t.length),r=0;r<n.length;++r)0!==Math.round(t[r])&&(n[r]=1);return n}throw new Error("Unknown data type "+e)}function N(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function T(t){if("float32"===t||"int32"===t)return 4;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function D(t){return!!(t&&t.constructor&&t.call&&t.apply)}function z(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function M(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function O(t,e){return function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e)?t:(Array.isArray(t)&&(t=f(t)),A(t,e))}function L(t,e){for(var n=F(t,e),r=0;r<n.length;r++)n[r]=1;return n}function F(t,e){if(null==e||"float32"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type $ {dtype}")}var _=Object.freeze({shuffle:s,clamp:u,randUniform:l,distSquared:function(t,e){for(var n=0,r=0;r<t.length;r++){var i=Number(t[r])-Number(e[r]);n+=i*i}return n},assert:c,assertShapesMatch:h,assertNonNull:p,flatten:f,inferShape:d,sizeFromShape:g,isScalarShape:function(t){return 0===t.length},arraysEqual:v,isInt:m,tanh:y,sizeToSquarishShape:b,createShuffledIndices:function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return s(e),e},rightPad:w,repeatedTry:x,getQueryParams:S,inferFromImplicitShape:E,squeezeShape:k,getTypedArrayFromDType:C,checkForNaN:R,hasEncodingLoss:I,copyTypedArray:A,isTypedArray:N,bytesPerElement:T,isFunction:D,nearestDivisor:z,computeStrides:M,toTypedArray:O,makeOnesTypedArray:L,makeZerosTypedArray:F}),B=20,P=3,U=7;function W(t,e,n,r){var i=M(e),o=function(t,e,n){var r=g(e),i=n[n.length-1],o=new Array(i).fill(0);if(e.length>1)for(var a=0;a<r/i;a++)for(var s=a*i,u=0;u<i;u++)o[u]=Math.max(o[u],V(t[s+u],0).length);return o}(t,e,i),a=e.length,s=function t(e,n,r,i,o){void 0===o&&(o=!0);var a=n[0],s=n.length;if(0===s)return[e[0].toString()];if(1===s){if(a>B){var u=Array.from(e.subarray(0,P)),l=Array.from(e.subarray(a-P,a));return["["+u.map(function(t,e){return V(t,i[e])}).join(", ")+", ..., "+l.map(function(t,e){return V(t,i[a-P+e])}).join(", ")+"]"]}return["["+Array.from(e).map(function(t,e){return V(t,i[e])}).join(", ")+"]"]}var c=n.slice(1),h=r.slice(1),p=r[0],f=[];if(a>B){for(var d=0;d<P;d++){var g=(v=d*p)+p;f.push.apply(f,t(e.subarray(v,g),c,h,i,!1))}for(f.push("..."),d=a-P;d<a;d++)g=(v=d*p)+p,f.push.apply(f,t(e.subarray(v,g),c,h,i,d===a-1))}else for(d=0;d<a;d++){var v;g=(v=d*p)+p,f.push.apply(f,t(e.subarray(v,g),c,h,i,d===a-1))}var m=2===s?",":"";f[0]="["+f[0]+m;for(d=1;d<f.length-1;d++)f[d]=" "+f[d]+m;var y=",\n";for(d=2;d<s;d++)y+="\n";return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":y),f}(t,e,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(t){return"    "+t}).join("\n")),u.join("\n")}function V(t,e){return w(parseFloat(t.toFixed(U)).toString(),e)}var q=function(){function t(t,e,n){if(this.dtype=e,null!=n){var r=n.length,i=g(t);c(r===i,"Length of values '"+r+"' does not match the size inferred by the shape '"+i+"'")}this.shape=t.slice(),this.values=n||C(e,g(t)),this.strides=M(t),this.size=g(t)}return t.prototype.set=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length&&(e=[0]),c(e.length===this.rank,"The number of provided coordinates ("+e.length+") must match the rank ("+this.rank+")");var r=this.locToIndex(e);this.values[r]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.values[n]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return $.make(this.shape,{values:this.values},this.dtype)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"set",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"get",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"toTensor",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t)}(),G=null,j=null;function H(t){G=t}var $=function(){function t(t,n,r,i){this.isDisposedInternal=!1,this.size=g(t),null!=r&&c(this.size===r.length,"Constructing tensor of shape ("+this.size+") should match the length of values ("+r.length+")"),this.shape=t.slice(),this.dtype=n||"float32",this.strides=M(t),this.dataId=null!=i?i:{},this.id=e.nextId++,this.rankType=this.rank<5?this.rank.toString():"higher",G().registerTensor(this),null!=r&&G().write(this.dataId,r)}var e;return e=t,t.make=function(t,n,r){return new e(t,r,n.values,n.dataId)},t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),c(1===this.size,"The array must have only 1 element."),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.asType=function(t){return this.throwIfDisposed(),j.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];c(t.length===this.rank,"Number of coordinates in get() must match the rank of the tensor"),this.throwIfDisposed(),0===t.length&&(t=[0]);for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.dataSync()[n]},t.prototype.buffer=function(){return j.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.data=function(){return i(this,void 0,void 0,function(){return o(this,function(t){return this.throwIfDisposed(),[2,G().read(this.dataId)]})})},t.prototype.dataSync=function(){return this.throwIfDisposed(),G().readSync(this.dataId)},t.prototype.dispose=function(){this.isDisposed||(G().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),j.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),j.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),j.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),j.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),j.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),j.clone(this)},t.prototype.toString=function(t){return void 0===t&&(t=!1),W(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),j.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),j.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),j.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),j.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),j.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),j.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),j.reverse(this,t)},t.prototype.concat=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),j.concat([this,t],e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),j.stack([this,t],e)},t.prototype.unstack=function(t,e){return void 0===e&&(e=0),j.unstack(this,e)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),j.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,i){return void 0===n&&(n=.001),this.throwIfDisposed(),j.batchNormalization(this,t,e,n,r,i)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),j.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),j.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),j.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),j.sum(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),j.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),j.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),j.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),j.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),j.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),j.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),j.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),j.addStrict(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),j.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),j.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),j.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),j.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),j.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),j.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),j.div(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),j.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),j.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),j.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),j.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),j.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),j.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),j.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),j.modStrict(this,t)},t.prototype.squaredDifference=function(t){return this.throwIfDisposed(),j.squaredDifference(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),j.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),j.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),j.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),j.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),j.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),j.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),j.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),j.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),j.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),j.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),j.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),j.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),j.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),j.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),j.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),j.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),j.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),j.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),j.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),j.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),j.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),j.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),j.sign(this)},t.prototype.exp=function(){return this.throwIfDisposed(),j.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),j.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),j.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),j.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),j.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),j.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),j.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),j.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),j.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),j.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),j.relu(this)},t.prototype.elu=function(){return this.throwIfDisposed(),j.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),j.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),j.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),j.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),j.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),j.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),j.softplus(this)},t.prototype.sin=function(){return this.throwIfDisposed(),j.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),j.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),j.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),j.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),j.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),j.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),j.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),j.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),j.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),j.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),j.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),j.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),j.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),j.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),j.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),j.softmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),j.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),j.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,i,o){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),j.conv1d(this,t,e,n,r,i,o)},t.prototype.conv2d=function(t,e,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),j.conv2d(this,t,e,n,r,i,o)},t.prototype.conv2dTranspose=function(t,e,n,r,i){return this.throwIfDisposed(),j.conv2dTranspose(this,t,e,n,r,i)},t.prototype.depthwiseConv2D=function(t,e,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),j.depthwiseConv2d(this,t,e,n,r,i,o)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),j.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),j.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),j.localResponseNormalization(this,t,e,n,r)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),K.variable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),j.unsortedSegmentSum(this,t,e)},t.nextId=0,r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"flatten",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"asScalar",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"as1D",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"as2D",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"as3D",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"as4D",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"asType",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"buffer",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"data",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"dataSync",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"dispose",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"toFloat",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"toInt",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"toBool",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"print",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"reshape",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"reshapeAs",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"expandDims",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"cumsum",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"squeeze",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"clone",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"toString",null),e=r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t)}(),K=function(t){function e(e,n,r){void 0===n&&(n=!0);var o=t.call(this,e.shape,e.dtype,null,e.dataId)||this;return o.trainable=n,o.name=r,null==o.name&&(o.name=i.nextVarId.toString(),i.nextVarId++),G().registerVariable(o),o}var i;return n(e,t),i=e,e.variable=function(t,e,n,r){return void 0===e&&(e=!0),null!=r&&r!==t.dtype&&(t=t.asType(r)),new i(t,e,n)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!v(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");G().disposeTensor(this),this.dataId=t.dataId,G().registerTensor(this)},e.nextVarId=0,r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"assign",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e,"variable",null),i=r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e)}($),X=K.variable;function J(t,e){c(t.dtype===e.dtype," The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match")}function Y(t,e,n,r){if(void 0===r&&(r="float32"),r=r||"float32",t instanceof $)return t;if(!N(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t)throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got "+t.constructor.name);var i=d(t);return N(t)||Array.isArray(t)||(t=[t]),$.make(i,{values:O(t,r)},r)}function Z(t,e,n){if(!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(t,r){return Y(t,e+"["+r+"]",n)})}function Q(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof $)n.push(e);else if(function(t){return Array.isArray(t)||"object"==typeof t}(e)){var i=e;for(var o in i){var a=i[o];r.has(a)||(r.add(a),t(a,n,r))}}}(t,e,new Set),e}var tt=function(){function t(){}return t.tensor=function(t,e,n){if(void 0===n&&(n="float32"),!N(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t)throw new Error("values passed to tensor(values) must be an array of numbers or booleans, or a TypedArray");var r=d(t);return null!=e&&1!==r.length&&h(e,r,"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+e+"). "),N(t)||Array.isArray(t)||(t=[t]),e=e||r,$.make(e,{values:O(t,n)},n)},t.scalar=function(e,n){if(void 0===n&&(n="float32"),N(e)||Array.isArray(e))throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean)");return t.tensor(e,[],n)},t.tensor1d=function(e,n){void 0===n&&(n="float32"),p(e);var r=d(e);if(1!==r.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return t.tensor(e,r,n)},t.tensor2d=function(e,n,r){if(void 0===r&&(r="float32"),p(e),null!=n&&2!==n.length)throw new Error("tensor2d() requires shape to have two numbers");var i=d(e);if(2!==i.length&&1!==i.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===i.length&&null==n)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return n=n||i,t.tensor(e,n,r)},t.tensor3d=function(e,n,r){if(void 0===r&&(r="float32"),p(e),null!=n&&3!==n.length)throw new Error("tensor3d() requires shape to have three numbers");var i=d(e);if(3!==i.length&&1!==i.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===i.length&&null==n)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return n=n||i,t.tensor(e,n,r)},t.tensor4d=function(e,n,r){if(void 0===r&&(r="float32"),p(e),null!=n&&4!==n.length)throw new Error("tensor4d() requires shape to have four numbers");var i=d(e);if(4!==i.length&&1!==i.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===i.length&&null==n)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return n=n||i,t.tensor(e,n,r)},t.tensor5d=function(e,n,r){if(void 0===r&&(r="float32"),p(e),null!=n&&5!==n.length)throw new Error("tensor5d() requires shape to have five numbers");var i=d(e);if(5!==i.length&&1!==i.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===i.length&&null==n)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return n=n||i,t.tensor(e,n,r)},t.tensor6d=function(e,n,r){if(void 0===r&&(r="float32"),p(e),null!=n&&6!==n.length)throw new Error("tensor6d() requires shape to have six numbers");var i=d(e);if(6!==i.length&&1!==i.length)throw new Error("tensor6d() requires values to be number[][][][] or flat/TypedArray");if(1===i.length&&null==n)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return n=n||i,t.tensor(e,n,r)},t.ones=function(t,e){void 0===e&&(e="float32");var n=L(g(t),e);return $.make(t,{values:n},e)},t.zeros=function(t,e){void 0===e&&(e="float32");var n=F(g(t),e);return $.make(t,{values:n},e)},t.fill=function(t,e,n){void 0===n&&(n="float32");var r=C(n,g(t));return r.fill(e),$.make(t,{values:r},n)},t.onesLike=function(e){var n=Y(e,"x","onesLike");return t.ones(n.shape,n.dtype)},t.zerosLike=function(e){var n=Y(e,"x","zerosLike");return t.zeros(n.shape,n.dtype)},t.linspace=function(e,n,r){if(0===r)throw new Error("Cannot request zero samples");var i=(n-e)/(r-1),o=F(r,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+i;return t.tensor1d(o,"float32")},t.range=function(e,n,r,i){if(void 0===r&&(r=1),void 0===i&&(i="float32"),0===r)throw new Error("Cannot have a step of zero");if(e===n||e<n&&r<0||n<e&&r>1)return t.zeros([0],i);var o=F(Math.abs(Math.ceil((n-e)/r)),i);n<e&&1===r&&(r=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return t.tensor1d(o,i)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"tensor",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"scalar",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"tensor1d",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"tensor2d",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"tensor3d",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"tensor4d",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"tensor5d",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"tensor6d",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"ones",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"zeros",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"fill",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"onesLike",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"zerosLike",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"linspace",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"range",null),t}(),et=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new nt)}return t.prototype.profileKernel=function(t,e){var n,r=this,i=this.backendTimer.time(function(){n=e()}),o=n.dataSync();return R(o,n.dtype,t),i.then(function(e){r.logger.logKernelProfile(t,n,o,e.kernelMs)}),n},t}(),nt=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r){var i=w(r+"ms",9),o=w(t,25),a=e.rank,s=e.size,u=w(e.shape.toString(),14);console.log("%c"+o+"\t%c"+i+"\t%c"+a+"D "+u+"\t%c"+s,"font-weight:bold","color:red","color:blue","color: orange")},t}();var rt,it,ot=function(){function t(t,e,n){this.backend=t,this.safeMode=e,this.debugMode=n,this.registeredVariables={},this.refCounter=new WeakMap,this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numDataBuffers=0,this.gradientScopeCount=0,this.customGradientDepth=0,this.keepTensors=new Set,this.activeScope={track:[]},this.scopeStack=[this.activeScope],this.profiler=new et(t)}return t.prototype.tidy=function(t,e,n){void 0===n&&(n=!1);var r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}this.startScope(r,n);var i=e();return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),this.endScope(i,n),i},t.prototype.runKernel=function(t,e,n){var r,i=this,o=[],a=function(t){return o.push(t),t},s=this.activeScope.name;if(this.customGradientDepth++,r=this.debugMode?this.profiler.profileKernel(s,function(){return t(i.backend,a)}):t(this.backend,a),this.customGradientDepth--,this.shouldRecord()){var u={id:this.nextTapeNodeId++,name:s,inputs:e,output:r};null!=n&&(u.gradient=function(t){return n(t,o)}),this.activeTape.push(u)}return r},t.prototype.registerTensor=function(t){var e=this.refCounter.has(t.dataId)?this.refCounter.get(t.dataId):0;this.numTensors++,0===e&&(this.numDataBuffers++,this.numBytes+=g(t.shape)*T(t.dtype),this.backend.register(t.dataId,t.shape,t.dtype)),this.refCounter.set(t.dataId,e+1),t instanceof K||this.track(t)},t.prototype.registerVariable=function(t){if(null!=this.registeredVariables[t.name])throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},t.prototype.disposeTensor=function(t){if(this.refCounter.has(t.dataId)){this.keepTensors.has(t.id)&&this.keepTensors.delete(t.id),this.numTensors--;var e=this.refCounter.get(t.dataId);e<=1?(this.refCounter.delete(t.dataId),this.backend.disposeData(t.dataId),this.numDataBuffers--,this.numBytes-=g(t.shape)*T(t.dtype)):this.refCounter.set(t.dataId,e-1)}},t.prototype.disposeVariables=function(){for(var t in this.registeredVariables){var e=this.registeredVariables[t];this.disposeTensor(e),delete this.registeredVariables[t]}},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,t},t.prototype.shouldRecord=function(){return null!=this.activeTape&&0===this.customGradientDepth},t.prototype.addTapeNode=function(t,e,n){var r={};t.forEach(function(t,e){r[e]=t});var i={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:r,output:e,gradient:function(t){var e={};return n(t).forEach(function(t,n){e[n]=function(){return t}}),e}};this.activeTape.push(i)},t.prototype.keep=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return this.keepTensors.add(t.id),t},t.prototype.startScope=function(t,e){void 0===e&&(e=!1),e&&0===this.gradientScopeCount&&(this.activeTape=[]),e&&this.gradientScopeCount++;var n={track:[]};t&&(n.name=t),this.scopeStack.push(n),this.activeScope=n},t.prototype.endScope=function(t,e){var n=this;void 0===e&&(e=!1),e&&(this.gradientScopeCount--,0===this.gradientScopeCount&&(this.activeTape=null));var r=new Set(this.keepTensors),i=Q(t);i.forEach(function(t){return r.add(t.id)});for(var o=0;o<this.activeScope.track.length;o++){var a=this.activeScope.track[o];r.has(a.id)||(null!=this.activeTape?i.push(a):a.dispose())}var s=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?{track:[]}:this.scopeStack[this.scopeStack.length-1],i.forEach(function(t){!n.keepTensors.has(t.id)&&function(t,e){for(var n=0;n<e.length;n++)if(e[n].id===t.id)return!0;return!1}(t,s.track)&&n.track(t)})},t.prototype.gradients=function(t,e,n,r){var i=this;return void 0===r&&(r=!1),c(e.length>0,"gradients() received an empty list of xs."),this.tidy("gradients",function(){var o=t();c(o instanceof $,"The result y returned by f() must be a tensor.");var a=function(t,e,n){for(var r={},i={},o=0;o<e.length;o++)r[e[o].id]=!0;for(o=0;o<t.length;o++){var a=(g=t[o]).inputs;for(var s in a){for(var u=a[s],l=!1,c=0;c<e.length;c++)if(r[u.id]){r[g.output.id]=!0,l=!0,i[g.id]=!0;break}if(l)break}}var h={};h[n.id]=!0;var p={};for(o=t.length-1;o>=0;o--){a=(g=t[o]).inputs;var f=[];for(f.push(g.output),c=0;c<f.length;c++)if(h[f[c].id]){for(var s in a)h[a[s].id]=!0,p[g.id]=!0;break}}var d=[];for(o=0;o<t.length;o++){var g;if(i[(g=t[o]).id]&&p[g.id]){var v={};for(var s in g.inputs){var m=g.inputs[s];r[m.id]&&(v[s]=m)}var y=Object.assign({},g);y.inputs=v,y.output=g.output,d.push(y)}}return d}(i.activeTape,e,o);if(!r&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var s={};return s[o.id]=null==n?tt.ones(o.shape):n,function(t,e){for(var n=e.length-1;n>=0;n--){var r=e[n],i=t[r.output.id];if(null==r.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+r.name+".");var o=r.gradient(i);for(var a in r.inputs){if(!(a in o))throw new Error("Cannot backprop through input "+a+". Available gradients found: "+Object.keys(o)+".");var s=o[a](),u=r.inputs[a];if(!v(s.shape,u.shape))throw new Error("Error in gradient for op "+r.name+". The gradient of input '"+a+"' has shape '"+s.shape+"', which does not match the shape of the input '"+u.shape+"'");if(null==t[u.id])t[u.id]=s;else{var l=t[u.id];t[u.id]=l.add(s),l.dispose()}}}}(s,a),{value:o,grads:e.map(function(t){return s[t.id]})}},!0)},t.prototype.customGrad=function(t){var e=this;return c(D(t),"The f passed in customGrad(f) must be a function."),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];c(r.every(function(t){return t instanceof $}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors"),e.customGradientDepth++;var o=e.tidy(t.name,function(){var e=t.apply(void 0,r),i=e.value,o=e.gradFunc;return c(i instanceof $,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),c(D(o),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n=o,i},!0);return e.customGradientDepth--,e.shouldRecord()&&e.addTapeNode(r,o,function(t){var e=n(t),i=Array.isArray(e)?e:[e];return c(i.length===r.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),c(i.every(function(t){return t instanceof $}),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),i}),o}},t.prototype.write=function(t,e){this.backend.write(t,e)},t.prototype.readSync=function(t){return this.backend.readSync(t)},t.prototype.read=function(t){return this.backend.read(t)},t.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},t.prototype.time=function(t){return i(this,void 0,void 0,function(){var e,n;return o(this,function(r){switch(r.label){case 0:return e=performance.now(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=performance.now()-e,[2,n]}})})},t.prototype.track=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope.track.push(t),t},t}();(it=rt||(rt={}))[it.NUMBER=0]="NUMBER",it[it.BOOLEAN=1]="BOOLEAN",it[it.STRING=2]="STRING";var at=[{name:"DEBUG",type:rt.BOOLEAN},{name:"IS_BROWSER",type:rt.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:rt.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:rt.BOOLEAN},{name:"WEBGL_VERSION",type:rt.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:rt.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:rt.BOOLEAN},{name:"WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED",type:rt.BOOLEAN},{name:"BACKEND",type:rt.STRING}];function st(t,e){var n;try{n=ht(t,e)}catch(t){return!1}return null!=n&&(pt(n),!0)}var ut="tfjsflags";function lt(){var t={};if("undefined"==typeof window||void 0===window.location)return t;var e=S(window.location.search);if(ut in e){var n={};e[ut].split(",").forEach(function(t){var e=t.split(":"),r=e[0],i=e[1];n[r]=i}),at.forEach(function(e){e.name in n&&(console.log("Setting feature override from URL "+e.name+": "+n[e.name]),e.type===rt.NUMBER?t[e.name]=+n[e.name]:e.type===rt.BOOLEAN?t[e.name]="true"===n[e.name]:e.type===rt.STRING?t[e.name]=n[e.name]:console.warn("Unknown URL param: "+e.name+"."))})}return t}function ct(t,e){return null!=t.getExtension(e)}function ht(t,e){if(0===t||!e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=document.createElement("canvas");return 1===t?n.getContext("webgl")||n.getContext("experimental-webgl"):n.getContext("webgl2")}function pt(t){if(null!=t){var e=t.getExtension("WEBGL_lose_context");if(null==e)throw new Error("Extension WEBGL_lose_context not supported on this browser.");e.loseContext()}}function ft(t,e){var n=t.createFramebuffer(),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);var i=2===e?t.RGBA32F:t.RGBA;t.texImage2D(t.TEXTURE_2D,0,i,1,1,0,t.RGBA,t.FLOAT,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)}var dt=function(){function t(t){this.features={},this.registry={},null!=t&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return t.setBackend=function(t,e){if(void 0===e&&(e=!1),!(t in bt.registry))throw new Error("Backend type '"+t+"' not found in registry");bt.initBackend(t,e)},t.getBackend=function(){return bt.initDefaultBackend(),bt.currentBackend},t.disposeVariables=function(){bt.engine.disposeVariables()},t.memory=function(){return bt.engine.memory()},t.tidy=function(t,e,n){return void 0===n&&(n=!1),bt.engine.tidy(t,e,n)},t.dispose=function(t){Q(t).forEach(function(t){return t.dispose()})},t.keep=function(t){return bt.engine.keep(t)},t.time=function(t){return bt.engine.time(t)},t.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},t.prototype.getFeatures=function(){return this.features},t.prototype.set=function(t,e){this.features[t]=e},t.prototype.getBestBackendType=function(){var t=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(e){return{name:e,entry:t.registry[e]}}).sort(function(t,e){return e.entry.priority-t.entry.priority})[0].name},t.prototype.evaluateFeature=function(t){if("DEBUG"===t)return!1;if("IS_BROWSER"===t)return"undefined"!=typeof window;if("IS_NODE"===t)return"undefined"!=typeof process&&void 0!==process.versions.node;if("IS_CHROME"===t)return null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if("BACKEND"===t)return this.getBestBackendType();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===t){var e=this.get("WEBGL_VERSION");return 0===e?0:function(t,e){if(0===t)return 0;var n,r=ht(t,e);return n=ct(r,"EXT_disjoint_timer_query_webgl2")&&2===t?2:ct(r,"EXT_disjoint_timer_query")?1:0,null!=r&&pt(r),n}(e,this.get("IS_BROWSER"))}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===t)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!function(){var t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}();if("WEBGL_VERSION"===t)return st(2,this.get("IS_BROWSER"))?2:st(1,this.get("IS_BROWSER"))?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===t)return function(t,e){if(0===t)return!1;var n=ht(t,e);if(1===t){if(!ct(n,"OES_texture_float"))return!1}else if(!ct(n,"EXT_color_buffer_float"))return!1;ft(n,t);var r=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return pt(n),r}(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===t)return function(t,e){if(0===t)return!1;var n=ht(t,e);if(1===t){if(!ct(n,"OES_texture_float"))return!1}else if(!ct(n,"EXT_color_buffer_float"))return!1;ft(n,t),n.readPixels(0,0,1,1,n.RGBA,n.FLOAT,new Float32Array(4));var r=n.getError()===n.NO_ERROR;return pt(n),r}(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"));if("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED"===t)return function(t,e){if(t>0)return!1;if(2!==t)return!1;var n=ht(t,e),r=ct(n,"WEBGL_get_buffer_sub_data_async");return pt(n),r}(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"));if("TEST_EPSILON"===t)return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?.001:.1;throw new Error("Unknown feature "+t+".")},t.prototype.setFeatures=function(t){this.features=t},t.prototype.reset=function(){this.features=lt(),null!=this.globalEngine&&(this.globalEngine=null)},t.prototype.initBackend=function(t,e){void 0===e&&(e=!1),this.currentBackend=t;var n=this.findBackend(t);this.globalEngine=new ot(n,e,this.get("DEBUG"))},t.prototype.findBackend=function(t){return t in this.registry?this.registry[t].backend:null},t.prototype.registerBackend=function(t,e,n,r){var i=this;if(void 0===n&&(n=1),t in this.registry)return console.warn(t+" backend was already registered. Reusing existing backend"),null!=r&&r(function(){return i.engine}),!1;try{var o=e();return this.registry[t]={backend:o,priority:n},!0}catch(e){return console.warn("Registration of backend "+t+" failed"),console.warn(e.stack||e.message),!1}},t.prototype.removeBackend=function(t){if(!(t in this.registry))throw new Error(t+" backend not found in registry");this.registry[t].backend.dispose(),delete this.registry[t]},Object.defineProperty(t.prototype,"engine",{get:function(){return this.initDefaultBackend(),this.globalEngine},enumerable:!0,configurable:!0}),t.prototype.initDefaultBackend=function(){null==this.globalEngine&&this.initBackend(this.get("BACKEND"),!1)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"setBackend",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"getBackend",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"disposeVariables",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"memory",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"tidy",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"dispose",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"keep",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"time",null),t}();var gt,vt,mt,yt,bt=function(){var t=function(){var t;if("undefined"!=typeof window)t=window;else{if("undefined"==typeof process)throw new Error("Could not find a global object");t=process}return t}();return null==t.ENV&&(t.ENV=new dt(lt()),H(function(){return t.ENV.engine})),t.ENV}(),wt=Object.freeze({Environment:dt,ENV:bt});function xt(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function St(t,e){for(var n=[],r=t.length,i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map(function(e){return t[e]})]}function Et(t,e){return function(t,e,n){for(var r=t.length+e.length,i=[],o=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(t[o++]):i.push(e[a++]);return i}(t,e.map(function(t){return 1}),e)}function kt(t,e){var n=e.length;return c((t=null==t?e.map(function(t,e){return e}):[].concat(t)).every(function(t){return t>=-n&&t<n}),"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t),c(t.every(function(t){return m(t)}),"All values in axis param must be integers but got axis "+t),t.map(function(t){return t<0?n+t:t})}function Ct(t,e,n){c(xt(e,n),t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input.")}function Rt(t,e){if(xt(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach(function(t){return n.push(t)}),n}function It(t){return t.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function At(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}!function(t){t.float32="float32",t.int32="int32",t.bool="bool"}(gt||(gt={})),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(t.Rank||(t.Rank={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32"}(vt||(vt={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool"}(mt||(mt={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32"}(yt||(yt={}));var Nt={float32:yt,int32:vt,bool:mt};function Tt(t,e){return Nt[t][e]}function Dt(t){return Tt(t,"int32")}function zt(t,e,n){c(t.length===e.length,"x1 and x2 should have the same rank.");var r=t.slice();return r[n]+=e[n],r}function Mt(t,e,n){var r=n.value;return n.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return dt.tidy(e,function(){return r.apply(void 0,t)})},n}var Ot=function(){function t(){}return t.concat1d=function(e){return t.concat(e,0)},t.concat2d=function(e,n){return t.concat(e,n)},t.concat3d=function(e,n){return t.concat(e,n)},t.concat4d=function(e,n){return t.concat(e,n)},t.concat=function(t,e){void 0===e&&(e=0),c(t.length>=1,"Pass at least one tensor to concat");var n=Z(t,"tensors","concat"),r=n[0];if(1===n.length)return r;for(var i=kt(e,r.shape),o=1;o<n.length;++o)r=Lt(r,n[o],i[0]);return r},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"concat",null),t}();function Lt(t,e,n){!function(t,e,n){var r=t.length,i=e.length;c(t.length===e.length,"Error in concat"+r+"D: rank of x1 ("+r+") and x2 ("+i+") must be the same."),c(n>=0&&n<r,"Error in concat"+r+"D: axis must be between 0 and "+(r-1)+".");for(var o=0;o<r;o++)c(o===n||t[o]===e[o],"Error in concat"+r+"D: Shape ("+t+") does not match ("+e+") along the non-concatenated axis "+o+".")}(t.shape,e.shape,n);var r=zt(t.shape,e.shape,n),i=t.as2D(-1,g(t.shape.slice(n))),o=e.as2D(-1,g(e.shape.slice(n))),a=function(t,e){return{aBegin:[0,0],aSize:t,bBegin:[0,t[1]],bSize:e}}(i.shape,o.shape),s=a.aBegin,u=a.aSize,l=a.bBegin,h=a.bSize;return bt.engine.runKernel(function(t){return t.concat(i,o)},{a:i,b:o},function(t){return{a:function(){return t.slice(s,u)},b:function(){return t.slice(l,h)}}}).reshape(r)}function Ft(t,e){return t(e={exports:{}},e.exports),e.exports}var _t=Ft(function(t){!function(t,e,n){function r(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function i(t,e){var n=new function(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}(t),i=e&&e.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+1.1102230246251565e-16*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&r(i,n),o.state=function(){return r(n,{})}),o}e&&e.exports?e.exports=i:this.alea=i}(0,t)}),Bt=Ft(function(t){!function(t,e,n){function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function i(t,e){var n=new function(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}(t),i=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&r(i,n),o.state=function(){return r(n,{})}),o}e&&e.exports?e.exports=i:this.xor128=i}(0,t)}),Pt=Ft(function(t){!function(t,e,n){function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function i(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}(t),i=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&r(i,n),o.state=function(){return r(n,{})}),o}e&&e.exports?e.exports=i:this.xorwow=i}(0,t)}),Ut=Ft(function(t){!function(t,e,n){function r(t,e){return e.x=t.x.slice(),e.i=t.i,e}function i(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}(t),i=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,i&&(i.x&&r(i,n),o.state=function(){return r(n,{})}),o}e&&e.exports?e.exports=i:this.xorshift7=i}(0,t)}),Wt=Ft(function(t){!function(t,e,n){function r(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function i(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,o=e.i;return e.w=r=r+1640531527|0,n=i[o+34&127],t=i[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,i,o,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),i=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(a=a+1640531527|0,i=0==(n=s[127&o]^=r+a)?i+1:0);for(i>=128&&(s[127&(e&&e.length||0)]=-1),i=127,o=512;o>0;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;t.w=a,t.X=s,t.i=i}(e,t)}(t),i=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,i&&(i.X&&r(i,n),o.state=function(){return r(n,{})}),o}e&&e.exports?e.exports=i:this.xor4096=i}(0,t)}),Vt=Ft(function(t){!function(t,e,n){function r(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function i(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}(t),i=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&r(i,n),o.state=function(){return r(n,{})}),o}e&&e.exports?e.exports=i:this.tychei=i}(0,t)}),qt=Ft(function(t){!function(e,n){var r,i=this,o=256,a=6,s="random",u=n.pow(o,a),l=n.pow(2,52),c=2*l,h=o-1;function p(t,p,v){var m=[],y=d(function t(e,n){var r,i=[],o=typeof e;if(n&&"object"==o)for(r in e)try{i.push(t(e[r],n-1))}catch(t){}return i.length?i:"string"==o?e:e+"\0"}((p=1==p?{entropy:!0}:p||{}).entropy?[t,g(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(o):(t=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(t)),g(t)}catch(t){var n=i.navigator,a=n&&n.plugins;return[+new Date,i,a,i.screen,g(e)]}}():t,3),m),b=new function(t){var e,n=t.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=h&a+t[i%n]+(e=s[i])],s[a]=e;(r.g=function(t){for(var e,n=0,i=r.i,a=r.j,s=r.S;t--;)e=s[i=h&i+1],n=n*o+s[h&(s[i]=s[a=h&a+e])+(s[a]=e)];return r.i=i,r.j=a,n})(o)}(m),w=function(){for(var t=b.g(a),e=u,n=0;t<l;)t=(t+n)*o,e*=o,n=b.g(1);for(;t>=c;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,d(g(b.S),e),(p.pass||v||function(t,e,r,i){return i&&(i.S&&f(i,b),t.state=function(){return f(b,{})}),r?(n[s]=t,e):t})(w,y,"global"in p?p.global:this==n,p.state)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function d(t,e){for(var n,r=t+"",i=0;i<r.length;)e[h&i]=h&(n^=19*e[h&i])+r.charCodeAt(i++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(n["seed"+s]=p,d(n.random(),e),t.exports){t.exports=p;try{r=require("crypto")}catch(t){}}}([],Math)});qt.alea=_t,qt.xor128=Bt,qt.xorwow=Pt,qt.xorshift7=Ut,qt.xor4096=Wt,qt.tychei=Vt;var Gt=qt.alea,jt=function(){function t(t,e,n,r,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Gt(o.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var i=void 0,o=void 0,a=void 0;do{a=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*o*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),Ht=function(){function t(){}return t.clone=function(t){var e=Y(t,"x","clone");return bt.engine.runKernel(function(t){return $.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})},t.eye=function(e,n,r,i){void 0===i&&(i="float32"),null==n&&(n=e);for(var o=t.buffer([e,n],i),a=e<=n?e:n,s=0;s<a;++s)o.set(1,s,s);var u=o.toTensor().as2D(e,n);if(null==r)return u;if(1===r.length)return t.tile(t.expandDims(u,0),[r[0],1,1]);if(2===r.length)return t.tile(t.expandDims(t.expandDims(u,0),0),[r[0],r[1],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+r.length+"D.")},t.randomNormal=function(e,n,r,i,o){if(void 0===n&&(n=0),void 0===r&&(r=1),null!=i&&"bool"===i)throw new Error("Unsupported data type "+i);for(var a=new jt(n,r,i,!1,o),s=t.buffer(e,i),u=0;u<s.values.length;u++)s.values[u]=a.nextValue();return s.toTensor()},t.truncatedNormal=function(e,n,r,i,o){if(void 0===n&&(n=0),void 0===r&&(r=1),null!=i&&"bool"===i)throw new Error("Unsupported data type "+i);for(var a=new jt(n,r,i,!0,o),s=t.buffer(e,i),u=0;u<s.values.length;u++)s.values[u]=a.nextValue();return s.toTensor()},t.randomUniform=function(e,n,r,i){void 0===n&&(n=0),void 0===r&&(r=1),void 0===i&&(i="float32");for(var o=t.buffer(e,i),a=0;a<o.values.length;a++)o.values[a]=l(n,r);return o.toTensor()},t.rand=function(t,e,n){var r=g(t),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return $.make(t,{values:i},n)},t.multinomial=function(t,e,n,r){void 0===r&&(r=!1);var i=Y(t,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?i.as2D(1,-1):i,u=bt.engine.runKernel(function(t){return t.multinomial(s,r,e,n)},{logits2D:s});return 1===a?u.as1D():u},t.oneHot=function(t,e,n,r){void 0===n&&(n=1),void 0===r&&(r=0);var i=Y(t,"indices","oneHot","int32");if(c("int32"===i.dtype,"Indices must be of dtype `int32`"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);return bt.engine.runKernel(function(t){return t.oneHot(i,e,n,r)},{$indices:i})},t.fromPixels=function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return bt.engine.fromPixels(t,e)},t.toPixels=function(t,e){return i(this,void 0,void 0,function(){var n,r,i,a,s,u,l,c,h,p,f,d,g,v,m,y,b,w,x,S;return o(this,function(o){switch(o.label){case 0:if(2!==(n=Y(t,"img","toPixels","int32")).rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],a=r[1],(s=2===n.rank?1:n.shape[2])>4||2===s)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return u=n.min(),l=n.max(),[4,u.data()];case 1:return c=o.sent()[0],[4,l.data()];case 2:if(h=o.sent()[0],u.dispose(),l.dispose(),"float32"===n.dtype){if(c<0||h>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+c+" - "+h+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(c<0||h>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+c+" - "+h+"].")}return[4,n.data()];case 3:for(p=o.sent(),f="float32"===n.dtype?255:1,d=new Uint8ClampedArray(a*i*4),g=0;g<i*a;++g)v=void 0,m=void 0,y=void 0,b=void 0,1===s?(v=p[g]*f,m=p[g]*f,y=p[g]*f,b=255):3===s?(v=p[3*g]*f,m=p[3*g+1]*f,y=p[3*g+2]*f,b=255):4===s&&(v=p[4*g]*f,m=p[4*g+1]*f,y=p[4*g+2]*f,b=p[4*g+3]*f),d[0+(w=4*g)]=Math.round(v),d[w+1]=Math.round(m),d[w+2]=Math.round(y),d[w+3]=Math.round(b);return null!=e&&(e.width=a,e.height=i,x=e.getContext("2d"),S=new ImageData(d,a,i),x.putImageData(S,0,0)),[2,d]}})})},t.reshape=function(t,e){var n=Y(t,"x","reshape");return e=E(e,n.size),c(n.size===g(e),"new shape and old shape must have the same number of elements."),bt.engine.runKernel(function(t){return t.reshape(n,e)},{$x:n},function(t){return{$x:function(){return t.reshape(n.shape)}}})},t.squeeze=function(e,n){var r=Y(e,"x","squeeze");return t.reshape(r,k(r.shape,n).newShape)},t.cast=function(t,e){var n=Y(t,"x","cast");return bt.engine.runKernel(function(t){return t.cast(n,e)},{$x:n},function(t){return{$x:function(){return t.clone()}}})},t.tile=function(t,e){var n=Y(t,"x","tile");return c(n.rank===e.length,"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."),bt.engine.runKernel(function(t){return t.tile(n,e)},{$x:n},function(t){return{$x:function(){var r=tt.zerosLike(n);if(1===n.rank)for(var i=0;i<e[0];++i)r=r.add(t.slice([i*n.shape[0]],[n.shape[0]]));else if(2===n.rank)for(i=0;i<e[0];++i)for(var o=0;o<e[1];++o)r=r.add(t.slice([i*n.shape[0],o*n.shape[1]],[n.shape[0],n.shape[1]]));else if(3===n.rank)for(i=0;i<e[0];++i)for(o=0;o<e[1];++o)for(var a=0;a<e[2];++a)r=r.add(t.slice([i*n.shape[0],o*n.shape[1],a*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(4!==n.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(i=0;i<e[0];++i)for(o=0;o<e[1];++o)for(a=0;a<e[2];++a)for(var s=0;s<e[3];++s)r=r.add(t.slice([i*n.shape[0],o*n.shape[1],a*n.shape[2],s*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return r}}})},t.pad1d=function(e,n,r){return void 0===r&&(r=0),c(2===n.length,"Invalid number of paddings. Must be length of 2."),t.pad(e,[n],r)},t.pad2d=function(e,n,r){return void 0===r&&(r=0),c(2===n.length&&2===n[0].length&&2===n[1].length,"Invalid number of paddings. Must be length of 2 each."),t.pad(e,n,r)},t.pad3d=function(e,n,r){return void 0===r&&(r=0),c(3===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length,"Invalid number of paddings. Must be length of 2 each."),t.pad(e,n,r)},t.pad4d=function(e,n,r){return void 0===r&&(r=0),c(4===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length&&2===n[3].length,"Invalid number of paddings. Must be length of 2 each."),t.pad(e,n,r)},t.pad=function(t,e,n){void 0===n&&(n=0);var r=Y(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=e.map(function(t){return t[0]});return bt.engine.runKernel(function(t){return t.pad(r,e,n)},{$x:r},function(t){return{$x:function(){return t.slice(i,r.shape)}}})},t.stack=function(t,e){void 0===e&&(e=0);var n=Z(t,"tensors","stack");if(c(n.length>=1,"Pass at least one tensor to tf.stack"),1===n.length)return n[0].expandDims(e);var r=n[0].rank,i=n[0].shape,o=n[0].dtype;c(e<=r,"Axis must be <= rank of the tensor"),n.forEach(function(t){h(i,t.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(t){c(o===t.dtype,"All tensors passed to stack must have matching dtypes")});var a=n.map(function(t){return t.expandDims(e)});return Ot.concat(a,e)},t.unstack=function(t,e){void 0===e&&(e=0);for(var n,r=Y(t,"x","unstack"),i=r.shape[e],o=Array(r.rank-1).fill(0),a=0,s=0;s<r.rank;s++)s!==e&&(o[a]=r.shape[s],a++);n=Array(i).fill(1);var u=Array(r.rank).fill(0),l=r.shape.slice();return n.map(function(t){l[e]=t;var n=r.slice(u,l);return u[e]+=t,n.reshape(o)})},t.split=function(t,e,n){void 0===n&&(n=0);var r,i=Y(t,"x","split");n=kt(n,i.shape)[0],"number"==typeof e?(c(i.shape[n]%e==0,"Number of splits must evenly divide the axis."),r=Array(e).fill(i.shape[n]/e)):(c(i.shape[n]===e.reduce(function(t,e){return t+e}),"The sum of sizes must match the size of the axis dimension."),r=e);var o=Array(i.rank).fill(0),a=i.shape.slice();return r.map(function(t){a[n]=t;var e=i.slice(o,a);return o[n]+=t,e})},t.cumsum=function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=Y(t,"x","cumsum"),o=Rt([e|=0],i.rank),a=i;null!=o&&(a=i.transpose(o));var s=At(1,i.rank)[0],u=bt.engine.runKernel(function(t){return t.cumsum(a,s,n,r)},{permutedX:a},function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}});return null!=o&&(u=u.transpose(o)),u},t.expandDims=function(e,n){void 0===n&&(n=0);var r=Y(e,"x","expandDims");c(n<=r.rank,"Axis must be <= rank of the tensor");var i=r.shape.slice();return i.splice(n,0,1),t.reshape(r,i)},t.buffer=function(t,e,n){return void 0===e&&(e="float32"),new q(t,e,n)},t.print=function(t,e){void 0===e&&(e=!1),console.log(t.toString(e))},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"clone",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"eye",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"randomNormal",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"truncatedNormal",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"randomUniform",null),r([Mt],t,"rand",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"multinomial",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"oneHot",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"fromPixels",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"toPixels",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"reshape",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"squeeze",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"cast",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"tile",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"pad",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"stack",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"unstack",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"split",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"cumsum",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"expandDims",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"buffer",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"print",null),t}();function $t(t,e){for(var n=t.length,r=[],i=0;i<n;i++){var o=n-1-i,a=t[o]||1;(e[e.length-1-i]||1)>1&&1===a&&r.unshift(o)}return r}function Kt(t,e){for(var n=[],r=0;r<e.length;r++){var i=t[t.length-r-1],o=e.length-r-1,a=e[o];(null==i||1===i&&a>1)&&n.unshift(o)}return n}function Xt(t,e){for(var n=[],r="Operands could not be broadcast together with shapes "+t+" and "+e+".",i=Math.max(t.length,e.length),o=0;o<i;o++){var a=t[t.length-o-1]||1,s=e[e.length-o-1]||1;if(a>1&&s>1&&a!==s)throw Error(r);n.unshift(Math.max(a,s))}return n}var Jt=function(){function t(){}return t.neg=function(t){var e=Y(t,"x","neg");return bt.engine.runKernel(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})},t.ceil=function(t){var e=Y(t,"x","ceil");return bt.engine.runKernel(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return tt.zerosLike(t)}}})},t.floor=function(t){var e=Y(t,"x","floor");return bt.engine.runKernel(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return tt.zerosLike(t)}}})},t.sign=function(t){var e=Y(t,"x","sign");return bt.engine.runKernel(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return tt.zerosLike(t)}}})},t.round=function(t){var e=Y(t,"x","round");return bt.engine.runKernel(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return tt.zerosLike(t)}}})},t.exp=function(t){var e=Y(t,"x","exp");return bt.engine.runKernel(function(t,n){return n(t.exp(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mulStrict(n)}}})},t.expm1=function(t){var e=Y(t,"x","expm1");return bt.engine.runKernel(function(t){return t.expm1(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.exp())}}})},t.log=function(t){var e=Y(t,"x","log");return bt.engine.runKernel(function(t){return t.log(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.toFloat())}}})},t.log1p=function(t){var e=Y(t,"x","log1p");return bt.engine.runKernel(function(t){return t.log1p(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.add(tt.scalar(1)))}}})},t.sqrt=function(t){var e=Y(t,"x","sqrt");return bt.engine.runKernel(function(t){return t.sqrt(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.toFloat().sqrt().mul(tt.scalar(2)))}}})},t.rsqrt=function(t){var e=Y(t,"x","rsqrt");return bt.engine.runKernel(function(t){return t.rsqrt(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.pow(tt.scalar(1.5)).mul(tt.scalar(2))).neg()}}})},t.square=function(t){var e=Y(t,"x","square");return bt.engine.runKernel(function(t){return t.square(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.toFloat().mul(tt.scalar(2)))}}})},t.reciprocal=function(t){var e=Y(t,"x","reciprocal");return bt.engine.runKernel(function(t){return t.reciprocal(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.square().neg())}}})},t.abs=function(t){var e=Y(t,"x","abs");return bt.engine.runKernel(function(t){return t.abs(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.toFloat().step(-1))}}})},t.clipByValue=function(t,e,n){var r=Y(t,"x","clipByValue");return c(e<=n,"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."),bt.engine.runKernel(function(t){return t.clip(r,e,n)},{$x:r},function(t){return{$x:function(){return t.where(r.greaterEqual(tt.scalar(e)).logicalAnd(r.lessEqual(tt.scalar(n))),tt.zerosLike(t))}}})},t.sigmoid=function(t){var e=Y(t,"x","sigmoid");return bt.engine.runKernel(function(t,n){return n(t.sigmoid(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mulStrict(n.mul(tt.scalar(1).sub(n)))}}})},t.logSigmoid=function(t){var e=Y(t,"x","logSigmoid");return bt.engine.runKernel(function(t){return t.softplus(e.neg()).neg()},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.neg().sigmoid())}}})},t.softplus=function(t){var e=Y(t,"x","softplus");return bt.engine.runKernel(function(t){return t.softplus(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.sigmoid())}}})},t.sin=function(t){var e=Y(t,"x","sin");return bt.engine.runKernel(function(t){return t.sin(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().cos().mulStrict(t)}}})},t.cos=function(t){var e=Y(t,"x","cos");return bt.engine.runKernel(function(t){return t.cos(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().sin().neg().mulStrict(t)}}})},t.tan=function(t){var e=Y(t,"x","tan");return bt.engine.runKernel(function(t){return t.tan(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.cos().square())}}})},t.asin=function(t){var e=Y(t,"x","asin");return bt.engine.runKernel(function(t){return t.asin(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(tt.scalar(1).sub(e.toFloat().square()).sqrt())}}})},t.acos=function(t){var e=Y(t,"x","acos");return bt.engine.runKernel(function(t){return t.acos(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(tt.scalar(1).sub(e.toFloat().square()).sqrt()).neg()}}})},t.atan=function(t){var e=Y(t,"x","atan");return bt.engine.runKernel(function(t){return t.atan(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(tt.scalar(1).add(e.toFloat().square()))}}})},t.sinh=function(t){var e=Y(t,"x","sinh");return bt.engine.runKernel(function(t){return t.sinh(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().cosh().mulStrict(t)}}})},t.cosh=function(t){var e=Y(t,"x","cosh");return bt.engine.runKernel(function(t){return t.cosh(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().sinh().mulStrict(t)}}})},t.tanh=function(t){var e=Y(t,"x","tanh");return bt.engine.runKernel(function(t,n){return n(t.tanh(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return tt.scalar(1).sub(n.square()).mulStrict(t)}}})},t.asinh=function(t){var e=Y(t,"x","asinh");return bt.engine.runKernel(function(t){return t.asinh(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(tt.scalar(1).add(e.toFloat().square()).sqrt())}}})},t.acosh=function(t){var e=Y(t,"x","acosh");return bt.engine.runKernel(function(t){return t.acosh(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.toFloat().square().sub(tt.scalar(1)).sqrt())}}})},t.atanh=function(t){var e=Y(t,"x","atanh");return bt.engine.runKernel(function(t){return t.atanh(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(tt.scalar(1).sub(e.toFloat().square()))}}})},t.erf=function(t){var e=Y(t,"x","erf");return c("int32"===e.dtype||"float32"===e.dtype,"Input dtype must be `int32` or `float32`."),"int32"===e.dtype&&(e=e.toFloat()),bt.engine.runKernel(function(t){return t.erf(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(tt.scalar(2/Math.sqrt(Math.PI)).mul(e.square().neg().exp()))}}})},t.step=function(t,e){void 0===e&&(e=0);var n=Y(t,"x","step");return bt.engine.runKernel(function(t){return t.step(n,e)},{$x:n},function(t){return{$x:function(){return tt.zerosLike(t)}}})},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"neg",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"ceil",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"floor",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"sign",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"round",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"exp",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"expm1",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"log",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"log1p",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"sqrt",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"rsqrt",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"square",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"reciprocal",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"abs",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"clipByValue",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"sigmoid",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"logSigmoid",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"softplus",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"sin",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"cos",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"tan",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"asin",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"acos",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"atan",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"sinh",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"cosh",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"tanh",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"asinh",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"acosh",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"atanh",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"erf",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"step",null),t}(),Yt=function(){function t(){}return t.batchNormalization2d=function(e,n,r,i,o,a){void 0===i&&(i=.001);var s,u,l=Y(e,"x","batchNormalization"),h=Y(n,"mean","batchNormalization"),p=Y(r,"variance","batchNormalization");return null!=o&&(s=Y(o,"scale","batchNormalization")),null!=a&&(u=Y(a,"offset","batchNormalization")),c(2===l.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+l.rank+"."),c(2===h.rank||1===h.rank,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."),c(2===p.rank||1===p.rank,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+p.rank+"."),null!=s&&c(2===s.rank||1===s.rank,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."),null!=u&&c(2===u.rank||1===u.rank,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."),t.batchNormalization(l,h,p,i,s,u)},t.batchNormalization3d=function(e,n,r,i,o,a){void 0===i&&(i=.001);var s,u,l=Y(e,"x","batchNormalization"),h=Y(n,"mean","batchNormalization"),p=Y(r,"variance","batchNormalization");return null!=o&&(s=Y(o,"scale","batchNormalization")),null!=a&&(u=Y(a,"offset","batchNormalization")),c(3===l.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+l.rank+"."),c(3===h.rank||1===h.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."),c(3===p.rank||1===p.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+p.rank+"."),null!=s&&c(3===s.rank||1===s.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."),null!=u&&c(3===u.rank||1===u.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."),t.batchNormalization(l,h,p,i,s,u)},t.batchNormalization4d=function(e,n,r,i,o,a){void 0===i&&(i=.001);var s,u,l=Y(e,"x","batchNormalization"),h=Y(n,"mean","batchNormalization"),p=Y(r,"variance","batchNormalization");return null!=o&&(s=Y(o,"scale","batchNormalization")),null!=a&&(u=Y(a,"offset","batchNormalization")),c(4===l.rank,"Error in batchNormalization4D: x must be rank 4 but got rank "+l.rank+"."),c(4===h.rank||1===h.rank,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."),c(4===p.rank||1===p.rank,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+p.rank+"."),null!=s&&c(4===s.rank||1===s.rank,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."),null!=u&&c(4===u.rank||1===u.rank,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."),t.batchNormalization(l,h,p,i,s,u)},t.batchNormalization=function(t,e,n,r,i,o){void 0===r&&(r=.001);var a,s,u,l=Y(t,"x","batchNormalization"),h=Y(e,"mean","batchNormalization"),p=Y(n,"variance","batchNormalization");return null!=i&&(a=Y(i,"scale","batchNormalization")),null!=o&&(s=Y(o,"offset","batchNormalization")),c(h.rank===p.rank,"Batch normalization gradient requires mean and variance to have equal ranks."),c(null==s||h.rank===s.rank,"Batch normalization gradient requires mean and offset to have equal ranks."),c(null==a||h.rank===a.rank,"Batch normalization gradient requires mean and scale to have equal ranks."),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,bt.engine.runKernel(function(t){return t.batchNormalization(u,Zt(h),Zt(p),r,Zt(a),Zt(s))},{$x:l,$mean:h,$variance:p,$scale:a,$offset:s},function(t){var e=null==a?tt.scalar(1):a,n=Kt(h.shape,u.shape),i=[];if(1===h.rank){for(var o=0;o<u.shape.length-1;++o)i.push(u.shape[o]);i.push(1)}var s=l.sub(h),c=t.mul(e),f=Jt.rsqrt(p.add(tt.scalar(r))),d=f.mul(f).mul(f).mul(tt.scalar(-.5));return{$x:function(){return 1===h.rank?t.mul(Ht.tile(f.as4D(1,1,1,h.shape[0]),i)).mul(e).reshape(l.shape):t.mul(f).mul(e).reshape(l.shape)},$mean:function(){var t=f.mul(tt.scalar(-1)).mul(c);return 1===h.rank&&(t=t.sum(n)),t.reshape(h.shape)},$variance:function(){var t=d.mul(s).mul(c);return 1===h.rank&&(t=t.sum(n)),t.reshape(h.shape)},$scale:function(){var e=s.mul(f),r=t.mul(e);return 1===h.rank&&(r=r.sum(n)),r.reshape(h.shape)},$offset:function(){var e=t;return 1===h.rank&&(e=e.sum(n)),e.reshape(h.shape)}}}).reshape(l.shape)},r([Mt],t,"batchNormalization2d",null),r([Mt],t,"batchNormalization3d",null),r([Mt],t,"batchNormalization4d",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"batchNormalization",null),t}();function Zt(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}var Qt=function(){function t(){}return t.add=function(t,e){var n=Y(t,"a","add"),r=Y(e,"b","add");J(n,r);var i=Xt(n.shape,r.shape);return bt.engine.runKernel(function(t){return t.add(n,r)},{$a:n,$b:r},function(t){return{$a:function(){var e=t,r=Kt(n.shape,i);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},$b:function(){var e=t,n=Kt(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)}}})},t.addStrict=function(t,e){return h(t.shape,e.shape,"Error in addStrict: "),t.add(e)},t.sub=function(t,e){var n=Y(t,"a","sub"),r=Y(e,"b","sub");J(n,r);var i=Xt(n.shape,r.shape);return bt.engine.runKernel(function(t){return t.subtract(n,r)},{$a:n,$b:r},function(t){return{$a:function(){var e=t,r=Kt(n.shape,i);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},$b:function(){var e=t,n=Kt(r.shape,i);return n.length>0&&(e=e.sum(n)),e.neg().reshape(r.shape)}}})},t.subStrict=function(t,e){return h(t.shape,e.shape,"Error in subStrict: "),t.sub(e)},t.pow=function(t,e){var n=Y(t,"base","pow"),r=Y(e,"exp","pow"),i=Xt(n.shape,r.shape);return t=n.cast(Tt(n.dtype,r.dtype)),e=r.cast(Tt(n.dtype,r.dtype)),bt.engine.runKernel(function(t,e){return e(t.pow(n,r))},{$base:n,$exp:r},function(t,e){var o=e[0];return{$base:function(){var e=t.mul(r.toFloat().mul(o.div(n))),a=Kt(n.shape,i);return a.length>0&&(e=e.sum(a)),e.reshape(n.shape)},$exp:function(){var e=t.mul(o.mul(n.log()).toFloat()),a=Kt(r.shape,i);return a.length>0&&(e=e.sum(a)),e.reshape(r.shape)}}})},t.powStrict=function(t,e){return h(t.shape,e.shape,"Error in powStrict: "),t.pow(e)},t.mul=function(t,e){var n=Y(t,"a","mul"),r=Y(e,"b","mul");J(n,r);var i=Xt(n.shape,r.shape);return bt.engine.runKernel(function(t){return t.multiply(n,r)},{$a:n,$b:r},function(t){return{$a:function(){var e=t.mul(r.toFloat()),o=Kt(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},$b:function(){var e=t.mul(n.toFloat()),o=Kt(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e}}})},t.mulStrict=function(t,e){return h(t.shape,e.shape,"Error in multiplyStrict: "),t.mul(e)},t.div=function(e,n){var r,i=Y(e,"a","div"),o=Y(n,"b","div");if(J(i,o),"int32"===i.dtype&&"int32"===o.dtype)return t.floorDiv(i,o);r=function(t){return t.realDivide(i,o)};var a=Xt(i.shape,o.shape);return bt.engine.runKernel(r,{$a:i,$b:o},function(t){return{$a:function(){var e=t.div(o.toFloat()),n=Kt(i.shape,a);return n.length>0?e.sum(n).reshape(i.shape):e},$b:function(){var e=t.mul(i.toFloat()),n=Kt(o.shape,a);n.length>0&&(e=e.sum(n).reshape(o.shape));var r=o.square();return e.div(r.toFloat()).neg()}}})},t.floorDiv=function(t,e){var n=Y(t,"a","floorDiv"),r=Y(e,"b","floorDiv");J(n,r);var i=Xt(n.shape,r.shape);return bt.engine.runKernel(function(t){return t.floorDiv(n,r)},{$a:n,$b:r},function(t){return{$a:function(){var e=t.div(r.toFloat()),o=Kt(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},$b:function(){var e=t.mul(n.toFloat()),o=Kt(r.shape,i);o.length>0&&(e=e.sum(o).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}})},t.divStrict=function(t,e){return h(t.shape,e.shape,"Error in divideStrict: "),t.div(e)},t.mod=function(t,e){var n=Y(t,"a","mod"),r=Y(e,"b","mod");J(n,r);var i=Xt(n.shape,r.shape);return bt.engine.runKernel(function(t){return t.mod(n,r)},{$a:n,$b:r},function(t){return{$a:function(){var e=Kt(n.shape,i);return e.length>0?t.sum(e).reshape(n.shape):t},$b:function(){var e=t.mul(n.div(r).floor().neg()),o=Kt(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e}}})},t.modStrict=function(t,e){return h(t.shape,e.shape,"Error in modStrict: "),t.mod(e)},t.minimum=function(t,e){var n=Y(t,"a","minimum"),r=Y(e,"b","minimum");return J(n,r),"bool"===n.dtype&&(n=n.toInt()),"bool"===r.dtype&&(r=r.toInt()),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.minimum(n,r)},{$a:n,$b:r},function(t){return{$a:function(){return t.mul(n.lessEqual(r).toFloat())},$b:function(){return t.mul(n.greater(r).toFloat())}}})},t.minimumStrict=function(t,e){return h(t.shape,e.shape,"Error in minimumStrict: "),t.minimum(e)},t.maximum=function(t,e){var n=Y(t,"a","maximum"),r=Y(e,"b","maximum");return J(n,r),"bool"===n.dtype&&(n=n.toInt()),"bool"===r.dtype&&(r=r.toInt()),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.maximum(n,r)},{$a:n,$b:r},function(t){return{$a:function(){return t.mul(n.greaterEqual(r).toFloat())},$b:function(){return t.mul(n.less(r).toFloat())}}})},t.maximumStrict=function(t,e){return h(t.shape,e.shape,"Error in minimumStrict: "),t.maximum(e)},t.squaredDifference=function(t,e){var n=Y(t,"a","squaredDifference"),r=Y(e,"b","squaredDifference");return J(n,r),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.squaredDifference(n,r)},{$a:n,$b:r},function(t){var e=tt.scalar(2);return{$a:function(){return t.mul(n.sub(r).mul(e))},$b:function(){return t.mul(r.sub(n).mul(e))}}})},t.squaredDifferenceStrict=function(t,e){return h(t.shape,e.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(e)},t.atan2=function(e,n){var r=Y(e,"a","atan2"),i=Y(n,"b","atan2");J(r,i);var o=Xt(r.shape,i.shape);return bt.engine.runKernel(function(t){return t.atan2(r,i)},{$a:r,$b:i},function(e){return{$a:function(){var n=t.add(r.square(),i.square()),a=e.mul(i.div(n)),s=Kt(r.shape,o);return s.length>0&&(a=a.sum(s)),a.reshape(r.shape)},$b:function(){var n=t.add(r.square(),i.square()),a=Jt.neg(e.mul(r.div(n))),s=Kt(i.shape,o);return s.length>0&&(a=a.sum(s)),a.reshape(i.shape)}}})},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"add",null),r([Mt],t,"addStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"sub",null),r([Mt],t,"subStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"pow",null),r([Mt],t,"powStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"mul",null),r([Mt],t,"mulStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"div",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"floorDiv",null),r([Mt],t,"divStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"mod",null),r([Mt],t,"modStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"minimum",null),r([Mt],t,"minimumStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"maximum",null),r([Mt],t,"maximumStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"squaredDifference",null),r([Mt],t,"squaredDifferenceStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"atan2",null),t}(),te=function(){function t(){}return t.notEqual=function(t,e){var n=Y(t,"a","notEqual"),r=Y(e,"b","notEqual");return J(n,r),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.notEqual(n,r)},{$a:n,$b:r})},t.notEqualStrict=function(t,e){var n=Y(t,"a","notEqualStrict"),r=Y(e,"b","notEqualStrict");return h(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)},t.less=function(t,e){var n=Y(t,"a","less"),r=Y(e,"b","less");return J(n,r),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.less(n,r)},{$a:n,$b:r})},t.lessStrict=function(t,e){var n=Y(t,"a","lessStrict"),r=Y(e,"b","lessStrict");return h(n.shape,r.shape,"Error in lessStrict: "),n.less(r)},t.equal=function(t,e){var n=Y(t,"a","equal"),r=Y(e,"b","equal");return J(n,r),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.equal(n,r)},{$a:n,$b:r})},t.equalStrict=function(t,e){var n=Y(t,"a","equalStrict"),r=Y(e,"b","equalStrict");return h(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)},t.lessEqual=function(t,e){var n=Y(t,"a","lessEqual"),r=Y(e,"b","lessEqual");return J(n,r),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.lessEqual(n,r)},{$a:n,$b:r})},t.lessEqualStrict=function(t,e){var n=Y(t,"a","lessEqualStrict"),r=Y(e,"b","lessEqualStrict");return h(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)},t.greater=function(t,e){var n=Y(t,"a","greater"),r=Y(e,"b","greater");return J(n,r),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.greater(n,r)},{$a:n,$b:r})},t.greaterStrict=function(t,e){var n=Y(t,"a","greaterStrict"),r=Y(e,"b","greaterStrict");return h(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)},t.greaterEqual=function(t,e){var n=Y(t,"a","greaterEqual"),r=Y(e,"b","greaterEqual");return J(n,r),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.greaterEqual(n,r)},{$a:n,$b:r})},t.greaterEqualStrict=function(t,e){var n=Y(t,"a","greaterEqualStrict"),r=Y(e,"b","greaterEqualStrict");return h(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"notEqual",null),r([Mt],t,"notEqualStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"less",null),r([Mt],t,"lessStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"equal",null),r([Mt],t,"equalStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"lessEqual",null),r([Mt],t,"lessEqualStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"greater",null),r([Mt],t,"greaterStrict",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"greaterEqual",null),r([Mt],t,"greaterEqualStrict",null),t}();function ee(t,e,n,r,i,o){void 0===o&&(o="channelsLast");var a,s=re(e),u=s[0],l=s[1];if("channelsLast"===o)a=[u,l,t[3],t[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);a=[u,l,t[1],t[1]]}return ne(t,a,n,1,r,i,!1,o)}function ne(t,e,n,r,i,o,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],h=u[1],p=u[2],f=u[3];if("channelsLast"===s)l=t[0],h=t[1],p=t[2],f=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=t[0],f=t[1],h=t[2],p=t[3]}var d,g=e[0],v=e[1],y=e[3],b=re(n),w=b[0],x=b[1],S=re(r),E=S[0],k=S[1],C=function(t,e,n,r,i,o,a,s){var u,l,h;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var p=function(t,e,n,r,i,o){null==i&&(i=function(t,e,n,r){void 0===r&&(r=1);var i=ie(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}(t,e,r));var a=t[0],s=t[1],u=oe((a-e+2*i)/r+1,o);c(m(u),"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters");var l=oe((s-e+2*i)/r+1,o);return c(m(l),"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"),[u,l,n]}([e,n,1],o,1,r,t,s);l=p[0],h=p[1]}else if("same"===t){var f=((l=Math.ceil(e/r))-1)*r+o-e,d=((h=Math.ceil(n/i))-1)*i+a-n,g=Math.floor(f/2),v=f-g,y=Math.floor(d/2);u={top:g,bottom:v,left:y,right:d-y,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),h=Math.ceil((n-a+1)/i)}return{padInfo:u,outHeight:l,outWidth:h}}(i,h,p,w,x,ie(g,E),ie(v,k),o),R=C.padInfo,I=C.outHeight,A=C.outWidth,N=a?y*f:y;return"channelsFirst"===s?d=[l,N,I,A]:"channelsLast"===s&&(d=[l,I,A,N]),{batchSize:l,dataFormat:s,inHeight:h,inWidth:p,inChannels:f,outHeight:I,outWidth:A,outChannels:N,padInfo:R,strideHeight:w,strideWidth:x,filterHeight:g,filterWidth:v,dilationHeight:E,dilationWidth:k,inShape:t,outShape:d,filterShape:e}}function re(t){return"number"==typeof t?[t,t]:t}function ie(t,e){return e<=1?t:t+(t-1)*(e-1)}function oe(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}var ae=function(){function t(){}return t.conv1d=function(e,n,r,i,o,a,s){void 0===o&&(o="NWC"),void 0===a&&(a=1);var u=Y(e,"x","conv1d"),l=Y(n,"filter","conv1d"),h=u,p=!1;2===u.rank&&(p=!0,h=u.as3D(1,u.shape[0],u.shape[1])),c(3===h.rank,"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."),c(3===l.rank,"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."),null!=s&&c(m(i),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."),c(h.shape[2]===l.shape[1],"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+l.shape[1]+"."),c(ue(r,a),"Error in conv1D: Either stride or dilation must be 1. Got stride "+r+" and dilation '"+a+"'"),c("NWC"===o,"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported.");var f=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]),d=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),g=[1,r],v=[1,a],y=t.conv2d(d,f,g,i,"NHWC",v,s);return p?y.as2D(y.shape[2],y.shape[3]):y.as3D(y.shape[0],y.shape[2],y.shape[3])},t.conv2d=function(e,n,r,i,o,a,s){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var u=Y(e,"x","conv2d"),l=Y(n,"filter","conv2d"),h=u,p=!1;3===u.rank&&(p=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),c(4===h.rank,"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."),c(4===l.rank,"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."),null!=s&&c(m(i),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."),c(h.shape[3]===l.shape[2],"Error in conv2d: depth of input ("+h.shape[3]+") must match input depth for filter "+l.shape[2]+"."),c(ue(r,a),"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"),c("NHWC"===o,"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported.");var f=ne(h.shape,l.shape,r,a,i,s),d=bt.engine.runKernel(function(t){return t.conv2d(h,l,f)},{x:h,$filter:l},function(e){return c(se(a),"Error in gradient of conv2D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+a+"'"),{x:function(){return t.conv2dDerInput(h.shape,e,l,r,i)},$filter:function(){return t.conv2dDerFilter(h,e,l.shape,r,i)}}});return p?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d},t.conv2dDerInput=function(t,e,n,r,i,o){c(t.length===e.rank,"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match");var a=t,s=e,u=!1;3===e.rank&&(u=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,t[0],t[1],t[2]]);var l=a[3],h=s.shape[3];c(4===a.length,"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."),c(4===s.rank,"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank),c(4===n.rank,"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank),c(l===n.shape[2],"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."),c(h===n.shape[3],"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."),null!=o&&c(m(i),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+".");var p=ne(a,n.shape,r,1,i,o),f=bt.engine.runKernel(function(t){return t.conv2dDerInput(s,n,p)},{dy4D:s});return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f},t.conv2dDerFilter=function(t,e,n,r,i,o){var a=t;3===t.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var s=e;3===s.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),c(4===a.rank,"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."),c(4===s.rank,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."),c(4===n.length,"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."),c(a.shape[3]===n[2],"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+n[2]+"."),c(s.shape[3]===n[3],"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+n[3]+")."),null!=o&&c(m(i),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+".");var u=ne(a.shape,n,r,1,i,o);return bt.engine.runKernel(function(t){return t.conv2dDerFilter(a,s,u)},{x4D:a,dy4D:s})},t.conv2dTranspose=function(e,n,r,i,o,a){var s=Y(e,"x","conv2dTranspose"),u=Y(n,"filter","conv2dTranspose");return t.conv2dDerInput(r,s,u,i,o,a)},t.depthwiseConv2d=function(t,e,n,r,i,o,a){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var s=Y(t,"x","depthwiseConv2d"),u=Y(e,"filter","depthwiseConv2d"),l=s,h=!1;3===s.rank&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),c(4===l.rank,"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."),c(4===u.rank,"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."),c(l.shape[3]===u.shape[2],"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."),null==o&&(o=[1,1]),c(ue(n,o),"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"),null!=a&&c(m(r),"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+".");var p=ne(l.shape,u.shape,n,o,r,a,!0),f=bt.engine.runKernel(function(t){return t.depthwiseConv2D(l,u,p)},{x:l,$filter:u},function(t){return c(se(o),"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"),{x:function(){return function(t,e,n,r){var i=e,o=!1;3===e.rank&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=bt.engine.runKernel(function(t){return t.depthwiseConv2DDerInput(i,n,r)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}(l.shape,t,u,p)},$filter:function(){return function(t,e,n,r){var i=t;3===t.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=e;return 3===o.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),bt.engine.runKernel(function(t){return t.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}(l,t,u.shape,p)}}});return h?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f},t.separableConv2d=function(e,n,r,i,o,a,s){void 0===a&&(a=[1,1]),void 0===s&&(s="NHWC");var u=Y(e,"x","separableConv2d"),l=Y(n,"depthwiseFilter","separableConv2d"),h=Y(r,"pointwiseFilter","separableConv2d"),p=u,f=!1;if(3===u.rank&&(f=!0,p=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");c(4===p.rank,"Error in separableConv2d: input must be rank 4, but got rank "+p.rank+"."),c(4===l.rank,"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+l.rank+"."),c(4===h.rank,"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+l.rank+"."),c(1===h.shape[0],"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."),c(1===h.shape[1],"Error in separableConv2d: the second dimension of pointwise filter  must be 1, but got "+h.shape[1]+".");var d=l.shape[2],g=l.shape[3];c(h.shape[2]===d*g,"Error in separableConv2d: the third dimension of pointwise filter must be "+d*g+", but got "+h.shape[2]+".");var v=t.depthwiseConv2d(p,l,i,o,s,a),m=t.conv2d(v,h,1,"valid",s);return f?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"conv1d",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"conv2d",null),r([Mt],t,"conv2dDerInput",null),r([Mt],t,"conv2dDerFilter",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"conv2dTranspose",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"depthwiseConv2d",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"separableConv2d",null),t}();function se(t){var e=function(t){return"number"==typeof t?[t,t]:t}(t),n=e[0],r=e[1];return 1===n&&1===r}function ue(t,e){return se(t)||se(e)}var le=function(){function t(){}return t.resizeBilinear=function(t,e,n){void 0===n&&(n=!1);var r=Y(t,"images","resizeBilinear");c(3===r.rank||4===r.rank,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."),c(2===e.length,"Error in resizeBilinear: new shape must 2D, but got shape "+e+".");var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=bt.engine.runKernel(function(t,e){return t.resizeBilinear(i,a,s,n)},{batchImages:i},function(t,e){return{batchImages:function(){return bt.engine.runKernel(function(e){return e.resizeBilinearBackprop(t,i,n)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u},t.resizeNearestNeighbor=function(t,e,n){void 0===n&&(n=!1);var r=Y(t,"images","resizeNearestNeighbor");c(3===r.rank||4===r.rank,"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."),c(2===e.length,"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."),c("float32"===r.dtype||"int32"===r.dtype,"`images` must have `int32` or `float32` as dtype");var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=bt.engine.runKernel(function(t,e){return t.resizeNearestNeighbor(i,a,s,n)},{batchImages:i},function(t,e){return{batchImages:function(){return bt.engine.runKernel(function(e){return e.resizeNearestNeighborBackprop(t,i,n)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"resizeBilinear",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"resizeNearestNeighbor",null),t}(),ce=function(){function t(){}return t.gradScope=function(t,e){return bt.engine.tidy(t,e,!0)},t.grad=function(t){return c(D(t),"The f passed in grad(f) must be a function"),function(e,n){return c(e instanceof $,"The x passed in grad(f)(x) must be a tensor"),c(null==n||n instanceof $,"The dy passed in grad(f)(x, dy) must be a tensor"),bt.engine.tidy(function(){var r=bt.engine.gradients(function(){return t(e)},[e],n),i=r.value,o=r.grads;return null!=n&&h(i.shape,n.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),he(o),o[0]})}},t.grads=function(t){return c(D(t),"The f passed in grads(f) must be a function"),function(e,n){return c(Array.isArray(e)&&e.every(function(t){return t instanceof $}),"The args passed in grads(f)(args) must be an array of tensors"),c(null==n||n instanceof $,"The dy passed in grads(f)(args, dy) must be a tensor"),bt.engine.tidy(function(){var r=bt.engine.gradients(function(){return t.apply(void 0,e)},e,n),i=r.value,o=r.grads;return null!=n&&h(i.shape,n.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),he(o),o})}},t.valueAndGrad=function(t){return c(D(t),"The f passed in valueAndGrad(f) must be a function"),function(e,n){c(e instanceof $,"The x passed in valueAndGrad(f)(x) must be a tensor"),c(null==n||n instanceof $,"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");var r=bt.engine.gradients(function(){return t(e)},[e],n),i=r.grads,o=r.value;return he(i),{grad:i[0],value:o}}},t.valueAndGrads=function(t){return c(D(t),"The f passed in valueAndGrads(f) must be a function"),function(e,n){c(Array.isArray(e)&&e.every(function(t){return t instanceof $}),"The args passed in valueAndGrads(f)(args) must be array of tensors"),c(null==n||n instanceof $,"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");var r=bt.engine.gradients(function(){return t.apply(void 0,e)},e,n);return null!=n&&h(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),he(r.grads),r}},t.variableGrads=function(t,e){if(c(D(t),"The f passed in variableGrads(f) must be a function"),c(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof K}),"The varList passed in variableGrads(f, varList) must be an array of variables"),null==e)for(var n in e=[],bt.engine.registeredVariables)e.push(bt.engine.registeredVariables[n]);var r=e.length;c((e=e.filter(function(t){return t.trainable})).length>0,"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable.");var i=bt.engine.gradients(t,e,null,!0),o=i.value,a=i.grads;c(a.some(function(t){return null!=t}),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),c(0===o.rank,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+o.rank+" tensor");var s={};return e.forEach(function(t,e){null!=a[e]&&(s[t.name]=a[e])}),{value:o,grads:s}},t.customGrad=function(t){return bt.engine.customGrad(t)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"grad",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"grads",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"valueAndGrad",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"valueAndGrads",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"variableGrads",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"customGrad",null),t}();function he(t){if(t.filter(function(t){return null==t}).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var pe=dt.tidy,fe=dt.keep,de=dt.dispose,ge=dt.time,ve=ce.grad,me=ce.valueAndGrad,ye=ce.grads,be=ce.valueAndGrads,we=ce.variableGrads,xe=ce.customGrad,Se=function(){function t(){}return t.norm=function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||r instanceof Array&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(tt.scalar(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(r instanceof Array&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=Y(t,"x","norm"),e,n),o=i.shape;if(r){var a=kt(n,t.shape);o=Et(i.shape,a)}return i.reshape(o)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"norm",null),t}();var Ee=function(){function t(){}return t.logSumExp=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Y(t,"x","logSumExp"),i=kt(e,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(n){var u=Et(s.shape,i);return s.reshape(u)}return s},t.sum=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Y(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=kt(e,r.shape);return xe(function(t){var e=Rt(i,t.rank),r=i,o=t;null!=e&&(o=t.transpose(e),r=At(r.length,t.rank));var a=bt.engine.runKernel(function(t){return t.sum(o,r)},{permutedX:o});if(n){var s=Et(a.shape,i);a=a.reshape(s)}return{value:a,gradFunc:function(e){var n=t.shape.slice();return i.forEach(function(t){n[t]=1}),e.reshape(n).mul(tt.ones(t.shape,"float32"))}}})(r)},t.mean=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Y(t,"x","mean"),i=kt(e,r.shape),o=g(St(r.shape,i)[1]);return xe(function(t){var r=tt.scalar(o);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return i.forEach(function(t){n[t]=1}),e.reshape(n).mul(tt.ones(t.shape,"float32")).div(r)}}})(r)},t.min=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Y(t,"x","min"),i=kt(e,r.shape),o=i,a=Rt(o,r.rank);null!=a&&(r=r.transpose(a),o=At(o.length,r.rank));var s=bt.engine.runKernel(function(t){return t.min(r,o)},{$x:r});if(n){var u=Et(s.shape,i);return s.reshape(u)}return s},t.max=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Y(t,"x","max"),i=kt(e,r.shape),o=i,a=Rt(o,r.rank);null!=a&&(r=r.transpose(a),o=At(o.length,r.rank));var s=bt.engine.runKernel(function(t){return t.max(r,o)},{$x:r});if(n){var u=Et(s.shape,i);return s.reshape(u)}return s},t.argMin=function(t,e){void 0===e&&(e=0);var n=Y(t,"x","argMin");null==e&&(e=0);var r=kt(e,n.shape),i=Rt(r,n.rank);return null!=i&&(n=n.transpose(i),r=At(r.length,n.rank)),bt.engine.runKernel(function(t){return t.argMin(n,r[0])},{$x:n})},t.argMax=function(t,e){void 0===e&&(e=0);var n=Y(t,"x","argMax");null==e&&(e=0);var r=kt(e,n.shape),i=Rt(r,n.rank);return null!=i&&(n=n.transpose(i),r=At(r.length,n.rank)),bt.engine.runKernel(function(t){return t.argMax(n,r[0])},{$x:n})},t.all=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Y(t,"x","all","bool");c("bool"===r.dtype,"Error Tensor must be of type bool. Got: "+r.dtype);var i=kt(e,r.shape),o=i,a=Rt(o,r.rank);null!=a&&(r=r.transpose(a),o=At(o.length,r.rank));var s=bt.engine.runKernel(function(t){return t.all(r,o)},{$x:r});if(n){var u=Et(s.shape,i);return s.reshape(u)}return s},t.any=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Y(t,"x","any","bool");c("bool"===r.dtype,"Error Tensor must be of type bool. Got: "+r.dtype);var i=kt(e,r.shape),o=i,a=Rt(o,r.rank);null!=a&&(r=r.transpose(a),o=At(o.length,r.rank));var s=bt.engine.runKernel(function(t){return t.any(r,o)},{$x:r});if(n){var u=Et(s.shape,i);return s.reshape(u)}return s},t.moments=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=kt(e,(t=Y(t,"x","moments")).shape),i=t.mean(r,n),o=i.shape;return n||(o=Et(i.shape,r)),{mean:i,variance:t.toFloat().sub(i.reshape(o)).square().mean(r,n)}},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"logSumExp",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"sum",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"mean",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"min",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"max",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"argMin",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"argMax",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"all",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"any",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"moments",null),t}(),ke=function(){function t(){}return t.gramSchmidt=function(t){var e;if(Array.isArray(t)){e=!1,c(null!=t&&t.length>0,"Gram-Schmidt process: input must not be null, undefined, or empty");for(var n=t[0].shape[0],r=1;r<t.length;++r)c(t[r].shape[0]===n,"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[r].shape[0]+" vs. "+n+")")}else e=!0,t=Ht.split(t,t.shape[0],0).map(function(t){return Ht.squeeze(t,[0])});c(t.length<=t[0].shape[0],"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+").");var i=[],o=t,a=function(t){i.push(bt.engine.tidy(function(){var e=o[t];if(t>0)for(var n=0;n<t;++n){var r=Ee.sum(i[n].mulStrict(e)).mul(i[n]);e=e.sub(r)}return e.div(Se.norm(e,"euclidean"))}))};for(r=0;r<t.length;++r)a(r);return e?Ht.stack(i,0):i},t.qr=function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return Ce(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(t,e){return t*e}),r=[],i=[];return Ht.unstack(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0).forEach(function(t){var n=Ce(t,e),o=n[0],a=n[1];r.push(o),i.push(a)}),[Ht.stack(r,0).reshape(t.shape),Ht.stack(i,0).reshape(t.shape)]},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"gramSchmidt",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"qr",null),t}();function Ce(t,e){return void 0===e&&(e=!1),bt.engine.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],i=Ht.eye(n),o=t.clone(),a=tt.tensor2d([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,l=function(t){var e,u=o,l=s,c=i;e=bt.engine.tidy(function(){var e=o.slice([t,t],[n-t,1]),u=e.norm(),l=o.slice([t,t],[1,1]),c=l.sign().neg(),h=l.sub(c.mul(u)),p=e.div(h);s=1===p.shape[0]?a.clone():a.concat(p.slice([1,0],[p.shape[0]-1,p.shape[1]]),0);var f=c.matMul(h).div(u).neg(),d=o.slice([t,0],[n-t,r]),g=f.mul(s);o=0===t?d.sub(g.matMul(s.transpose().matMul(d))):o.slice([0,0],[t,r]).concat(d.sub(g.matMul(s.transpose().matMul(d))),0);var v=i.slice([0,t],[n,i.shape[1]-t]);return i=0===t?v.sub(v.matMul(s).matMul(g.transpose())):i.slice([0,0],[n,t]).concat(v.sub(v.matMul(s).matMul(g.transpose())),1),[s,o,i]}),s=e[0],o=e[1],i=e[2],de([u,l,c])},c=0;c<u;++c)l(c);return!e&&n>r&&(i=i.slice([0,0],[n,r]),o=o.slice([0,0],[r,r])),[i,o]})}var Re=function(){function t(){}return t.logicalNot=function(t){var e=Y(t,"x","logicalNot","bool");return c("bool"===e.dtype,"Error Array must be of type bool."),bt.engine.runKernel(function(t){return t.logicalNot(e)},{$x:e})},t.logicalAnd=function(t,e){var n=Y(t,"a","logicalAnd","bool"),r=Y(e,"b","logicalAnd","bool");return c("bool"===n.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.logicalAnd(n,r)},{$a:n,$b:r})},t.logicalOr=function(t,e){var n=Y(t,"a","logicalOr","bool"),r=Y(e,"b","logicalOr","bool");return c("bool"===n.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),Xt(n.shape,r.shape),bt.engine.runKernel(function(t){return t.logicalOr(n,r)},{$a:n,$b:r})},t.logicalXor=function(e,n){var r=Y(e,"a","logicalXor","bool"),i=Y(n,"b","logicalXor","bool");return c("bool"===r.dtype&&"bool"===i.dtype,"Error Array must be of type bool."),Xt(r.shape,i.shape),t.logicalOr(e,n).logicalAnd(t.logicalAnd(e,n).logicalNot())},t.where=function(t,e,n){var r=Y(e,"a","where"),i=Y(n,"b","where"),o=Y(t,"condition","where","bool");c("bool"===o.dtype,"Error Condition must be of type bool."),h(r.shape,i.shape,"Error in where: "),1===o.rank?c(o.shape[0]===r.shape[0],"The first dimension of `a` must match the size of `condition`."):h(o.shape,i.shape,"Error in where: ");var a=Tt(r.dtype,i.dtype);return bt.engine.runKernel(function(t){return t.where(o,r,i,a)},{$condition:o,$a:r,$b:i},function(t){return{$condition:function(){return tt.zerosLike(o)},$a:function(){return t.mul(o.cast(r.dtype))},$b:function(){return t.mul(o.logicalNot().cast(i.dtype))}}})},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"logicalNot",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"logicalAnd",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"logicalOr",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"logicalXor",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"where",null),t}();!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(t.Reduction||(t.Reduction={}));var Ie=function(){function e(){}return e.computeWeightedLoss=function(e,n,r){void 0===r&&(r=t.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=Y(e,"losses","computeWeightedLoss"),o=null;null!=n&&(o=Y(n,"weights","computeWeightedLoss"));var a=null==o?i:i.mul(o);if(r===t.Reduction.NONE)return a;if(r===t.Reduction.SUM)return a.sum();if(r===t.Reduction.MEAN)return null==o?a.mean():a.sum().div(o.sum());if(r===t.Reduction.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(tt.scalar(i.size));var s=o.mul(tt.ones(i.shape)).notEqual(tt.scalar(0)).sum().toFloat();return a.sum().div(s)}throw Error("Unknown reduction: "+r)},e.absoluteDifference=function(n,r,i,o){void 0===o&&(o=t.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=Y(n,"labels","absoluteDifference"),s=Y(r,"predictions","absoluteDifference"),u=null;null!=i&&(u=Y(i,"weights","absoluteDifference")),h(a.shape,s.shape,"Error in absoluteDifference: ");var l=a.sub(s).abs();return e.computeWeightedLoss(l,u,o)},e.meanSquaredError=function(n,r,i,o){void 0===o&&(o=t.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=Y(n,"labels","meanSquaredError"),s=Y(r,"predictions","meanSquaredError"),u=null;null!=i&&(u=Y(i,"weights","meanSquaredError")),h(a.shape,s.shape,"Error in meanSquaredError: ");var l=a.squaredDifference(s);return e.computeWeightedLoss(l,u,o)},e.cosineDistance=function(n,r,i,o,a){void 0===a&&(a=t.Reduction.SUM_BY_NONZERO_WEIGHTS);var s=Y(n,"labels","cosineDistance"),u=Y(r,"predictions","cosineDistance"),l=null;null!=o&&(l=Y(o,"weights","cosineDistance")),h(s.shape,u.shape,"Error in cosineDistance: ");var c=tt.scalar(1).sub(s.mul(u).sum(i,!0));return e.computeWeightedLoss(c,l,a)},e.hingeLoss=function(n,r,i,o){void 0===o&&(o=t.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=Y(n,"labels","hingeLoss"),s=Y(r,"predictions","hingeLoss"),u=null;null!=i&&(u=Y(i,"weights","hingeLoss")),h(a.shape,s.shape,"Error in hingeLoss: ");var l=tt.scalar(1);a=tt.scalar(2).mul(a).sub(l);var c=l.sub(a.mul(s)).relu();return e.computeWeightedLoss(c,u,o)},e.logLoss=function(n,r,i,o,a){void 0===o&&(o=1e-7),void 0===a&&(a=t.Reduction.SUM_BY_NONZERO_WEIGHTS);var s=Y(n,"labels","logLoss"),u=Y(r,"predictions","logLoss"),l=null;null!=i&&(l=Y(i,"weights","logLoss")),h(s.shape,u.shape,"Error in logLoss: ");var c=tt.scalar(1),p=tt.scalar(o),f=s.mul(u.add(p).log()).neg().sub(c.sub(s).mul(c.sub(u).add(p).log()));return e.computeWeightedLoss(f,l,a)},e.huberLoss=function(n,r,i,o,a){void 0===o&&(o=1),void 0===a&&(a=t.Reduction.SUM_BY_NONZERO_WEIGHTS);var s=Y(n,"labels","huberLoss"),u=Y(r,"predictions","huberLoss"),l=null;null!=i&&(l=Y(i,"weights","huberLoss")),h(s.shape,u.shape,"Error in huberLoss: ");var c=tt.scalar(o),p=u.sub(s).abs(),f=Qt.minimum(p,c),d=p.sub(f),g=tt.scalar(.5).mul(f.square()).add(c.mul(d));return e.computeWeightedLoss(g,l,a)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],e,"computeWeightedLoss",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],e,"absoluteDifference",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],e,"meanSquaredError",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],e,"cosineDistance",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],e,"hingeLoss",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],e,"logLoss",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],e,"huberLoss",null),e}(),Ae=function(){function t(){}return t.localResponseNormalization=function(t,e,n,r,i){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var o=Y(t,"x","localResponseNormalization");c(4===o.rank||3===o.rank,"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+o.rank+"."),c(m(e),"Error in localResponseNormalization: depthRadius must be an integer\n                     but got depthRadius "+e+".");var a=o,s=!1;3===o.rank&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=bt.engine.runKernel(function(t){return t.localResponseNormalization4D(a,e,n,r,i)},{x4D:a});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"localResponseNormalization",null),t}(),Ne=function(){function t(){}return t.multiRNNCell=function(t,e,n,r){for(var i=Y(e,"data","multiRNNCell"),o=Z(n,"c","multiRNNCell"),a=Z(r,"h","multiRNNCell"),s=i,u=[],l=0;l<t.length;l++){var c=t[l](s,o[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],p=[];for(l=0;l<u.length;l+=2)h.push(u[l]),p.push(u[l+1]);return[h,p]},t.basicLSTMCell=function(t,e,n,r,i,o){var a=Y(t,"forgetBias","basicLSTMCell"),s=Y(e,"lstmKernel","basicLSTMCell"),u=Y(n,"lstmBias","basicLSTMCell"),l=Y(r,"data","basicLSTMCell"),c=Y(i,"c","basicLSTMCell"),h=Y(o,"h","basicLSTMCell"),p=l.concat(h,1).matMul(s).add(u),f=p.shape[0],d=p.shape[1]/4,g=[f,d],v=p.slice([0,0],g),m=p.slice([0,d],g),y=p.slice([0,2*d],g),b=p.slice([0,3*d],g),w=v.sigmoid().mulStrict(m.tanh()).addStrict(c.mulStrict(a.add(y).sigmoid()));return[w,w.tanh().mulStrict(b.sigmoid())]},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"multiRNNCell",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"basicLSTMCell",null),t}(),Te=function(){function t(){}return t.matMul=function(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1);var i=Y(t,"a","matMul"),o=Y(e,"b","matMul"),a=n?i.shape[0]:i.shape[1],s=r?o.shape[1]:o.shape[0];return c(2===i.rank&&2===o.rank,"Error in matMul: inputs must be rank 2, got ranks "+i.rank+" and "+o.rank+"."),c(a===s,"Error in matMul: inner shapes ("+a+") and ("+s+") of Tensors with shapes "+i.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."),bt.engine.runKernel(function(t){return t.matMul(i,o,n,r)},{$a:i,$b:o},function(t){return n||r?!n&&r?{$a:function(){return t.matMul(o.toFloat(),!1,!1)},$b:function(){return t.matMul(i.toFloat(),!0,!1)}}:n&&!r?{$a:function(){return o.toFloat().matMul(t,!1,!0)},$b:function(){return i.toFloat().matMul(t,!1,!1)}}:{$a:function(){return o.toFloat().matMul(t,!0,!0)},$b:function(){return t.matMul(i.toFloat(),!0,!0)}}:{$a:function(){return t.matMul(o.toFloat(),!1,!0)},$b:function(){return i.toFloat().matMul(t,!0,!1)}}})},t.vectorTimesMatrix=function(t,e){return c(1===t.rank,"Error in vectorTimesMatrix: first input must be rank 1, but got rank "+t.rank+"."),c(2===e.rank,"Error in vectorTimesMatrix: second input must be rank 2, but got rank "+e.rank+"."),c(t.size===e.shape[0],"Error in vectorTimesMatrix: size of vector ("+t.size+") must match first dimension of matrix ("+e.shape[0]+")"),t.as2D(1,-1).matMul(e).as1D()},t.matrixTimesVector=function(t,e){return c(1===e.rank,"Error in matrixTimesVector: second input must rank 1, but got rank "+e.rank+"."),c(2===t.rank,"Error in matrixTimesVector: first input must be a rank 2, but got rank "+t.rank+"."),c(e.size===t.shape[1],"Error in matrixTimesVector: size of first rank 1 input "+e.size+" must match inner dimension of second rank 2 input, but got shape "+t.shape+"."),t.matMul(e.as2D(-1,1)).as1D()},t.dotProduct=function(t,e){return c(1===t.rank&&1===e.rank,"Error in dotProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+e.rank+"."),c(t.size===e.size,"Error in dotProduct: size of inputs ("+t.size+") and ("+e.size+") must match."),t.as2D(1,-1).matMul(e.as2D(-1,1)).asScalar()},t.outerProduct=function(t,e){var n=Y(t,"v1","outerProduct"),r=Y(e,"v2","outerProduct");return c(1===n.rank&&1===r.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."),n.as2D(-1,1).matMul(r.as2D(1,-1))},t.dot=function(t,e){var n=Y(t,"t1","dot"),r=Y(e,"t2","dot");c(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+".");var i=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];return c(i===o,"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"matMul",null),r([Mt],t,"vectorTimesMatrix",null),r([Mt],t,"matrixTimesVector",null),r([Mt],t,"dotProduct",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"outerProduct",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"dot",null),t}(),De=function(){function t(){}return t.movingAverage=function(t,e,n,r,i){void 0===i&&(i=!0);var o=Y(t,"v","movingAverage"),a=Y(e,"x","movingAverage"),s=Y(n,"decay","movingAverage");J(o,a),c(v(o.shape,a.shape),"Shape mismatch in v and x");var u=tt.scalar(1),l=u.sub(s),h=a.sub(o).mul(l);if(i){c(null!=r,"When using zeroDebias: true, step is required.");var p=Y(r,"step","movingAverage");h=h.div(u.sub(Qt.pow(s,p)))}return o.add(h)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"movingAverage",null),t}(),ze=function(){function t(){}return t.maxPool=function(e,n,r,i,o){var a=Y(e,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),c(4===s.rank,"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."),null!=o&&c(m(i),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+".");var l=ee(s.shape,n,r,i,o),h=bt.engine.runKernel(function(t,e){return e(t.maxPool(s,l))},{x:s},function(e,o){var a=o[0];return{x:function(){return t.maxPoolBackprop(e,s,a,n,r,i)}}});return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h},t.maxPoolBackprop=function(t,e,n,r,i,o,a){var s=Y(t,"dy","maxPoolBackprop"),u=Y(e,"input","maxPoolBackprop"),l=Y(n,"output","maxPoolBackprop");c(u.rank===s.rank,"Rank of input ("+u.rank+") does not match rank of dy ("+s.rank+")"),c(4===s.rank,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."),c(4===u.rank,"Error in maxPoolBackprop: input must be rank 4 but got rank "+u.rank+"."),null!=a&&c(m(o),"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+".");var h=ee(u.shape,r,i,o,a);return bt.engine.runKernel(function(t){return t.maxPoolBackprop(s,u,l,h)},{$dy:s,$input:u})},t.avgPool=function(e,n,r,i,o){var a=Y(e,"x","avgPool");c("float32"===a.dtype,"The input dtype to avgPool must be float32");var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),c(4===s.rank,"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."),null!=o&&c(m(i),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+".");var l=ee(s.shape,n,r,i),h=bt.engine.runKernel(function(t){return t.avgPool(s,l)},{x:s},function(e){return{x:function(){return t.avgPoolBackprop(e,s,n,r,i)}}});return h=h.cast(a.dtype),u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h},t.avgPoolBackprop=function(t,e,n,r,i){var o=Y(t,"dy","avgPoolBackprop"),a=Y(e,"input","avgPoolBackprop");c(a.rank===o.rank,"Rank of input ("+a.rank+") does not match rank of dy ("+o.rank+")");var s=a,u=o,l=!1;3===a.rank&&(l=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]),u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),c(4===u.rank,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."),c(4===s.rank,"Error in avgPoolBackprop: input must be rank 4 but got rank "+s.rank+".");var h=ee(s.shape,n,r,i),p=bt.engine.runKernel(function(t){return t.avgPoolBackprop(u,s,h)},{dy4D:u,input4D:s});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"maxPool",null),r([Mt],t,"maxPoolBackprop",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"avgPool",null),r([Mt],t,"avgPoolBackprop",null),t}(),Me=function(){function t(){}return t.relu=function(t){var e=Y(t,"x","relu");return"bool"===e.dtype?e.toInt():bt.engine.runKernel(function(t){return t.relu(e)},{$x:e},function(t){var n=e.step();return{$x:function(){return t.mulStrict(n.toFloat())}}})},t.elu=function(t){var e=Y(t,"x","elu");return bt.engine.runKernel(function(t,n){return n(t.elu(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return bt.engine.runKernel(function(e){return e.eluDer(t,n)},{dy:t,y:n})}}})},t.selu=function(t){var e=Y(t,"x","selu");return bt.engine.runKernel(function(t){return t.selu(e)},{$x:e},function(t){return{$x:function(){var n=e.greater(tt.scalar(0)),r=tt.scalar(1.7580993408473768),i=tt.scalar(1.0507009873554805),o=t.mul(i),a=t.mul(r).mul(e.toFloat().exp());return Re.where(n,o,a)}}})},t.leakyRelu=function(t,e){void 0===e&&(e=.2);var n=Y(t,"x","leakyRelu");return Qt.maximum(tt.scalar(e).mul(n),n)},t.prelu=function(t,e){var n=Y(t,"x","prelu"),r=Y(e,"alpha","prelu"),i=tt.scalar(0);return Qt.maximum(i,n).add(r.mul(Qt.minimum(i,n)))},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"relu",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"elu",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"selu",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"leakyRelu",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"prelu",null),t}(),Oe=function(){function t(){}return t.reverse1d=function(e){var n=Y(e,"x","reverse");return c(1===n.rank,"Error in reverse1D: x must be rank 1 but got\n             rank "+n.rank+"."),t.reverse(n,0)},t.reverse2d=function(e,n){var r=Y(e,"x","reverse");return c(2===r.rank,"Error in reverse2D: x must be rank 2 but got\n             rank "+r.rank+"."),t.reverse(r,n)},t.reverse3d=function(e,n){var r=Y(e,"x","reverse");return c(3===r.rank,"Error in reverse3D: x must be rank 3 but got\n             rank "+r.rank+"."),t.reverse(r,n)},t.reverse4d=function(e,n){var r=Y(e,"x","reverse");return c(4===r.rank,"Error in reverse4D: x must be rank 4 but got\n             rank "+r.rank+"."),t.reverse(r,n)},t.reverse=function(t,e){var n=Y(t,"x","reverse");if(0===n.rank)return n.clone();var r=kt(e,n.shape);return bt.engine.runKernel(function(t){return t.reverse(n,r)},{$x:n},function(t){return{$x:function(){return t.reverse(r)}}}).reshapeAs(n)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"reverse",null),t}(),Le=function(){function t(){}return t.unsortedSegmentSum=function(t,e,n){var r=Y(t,"x","unsortedSegmentSum"),i=Y(e,"segmentIds","unsortedSegmentSum","int32");return c("int32"===i.dtype,"segmentIds must be of dtype `int32`"),c(m(n),"numSegments must be of dtype int"),bt.engine.runKernel(function(t){return t.unsortedSegmentSum(r,i,n)},{$x:r},function(t){return{$x:function(){return function(t,e){for(var n=Qt.maximum(e,tt.zerosLike(e)),r=Le.gather(t,n),i=te.greaterEqual(e,tt.scalar(0,"int32")),o=r.rank-i.rank,a=0;a<o;++a)i=Ht.expandDims(i,a+1);i=Re.logicalAnd(i,tt.ones(r.shape,"bool"));var s=tt.zerosLike(r);return Re.where(i,r,s)}(t,i)}}})},t.gather=function(e,n,r){void 0===r&&(r=0);var i=Y(e,"x","gather"),o=Y(n,"indices","gather","int32");return c("int32"===o.dtype,"Indices must be of dtype `int32`"),r=kt(r,i.shape)[0],bt.engine.runKernel(function(t){return t.gather(i,o,r)},{$x:i},function(e){return{$x:function(){if(0===r)return t.unsortedSegmentSum(e,o,i.shape[r]);var n=i.shape,a=o.size,s=n.slice(0,r),u=s.length,l=n.slice(r,n.length).slice(1),c=l.length,h=Fe(0,u),p=Fe(u+1,u+1+c),f=_e([s,[a],l]),d=e.reshape(f),g=o.reshape([a]),v=_e([[u],h,p]),m=d.transpose(v),y=t.unsortedSegmentSum(m,g,i.shape[r]),b=It(v);return y.transpose(b)}}})},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"unsortedSegmentSum",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"gather",null),t}();function Fe(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function _e(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var Be=function(){function t(){}return t.sigmoidCrossEntropyWithLogits=function(t,e){var n=Y(t,"labels","sigmoidCrossEntropyWithLogits"),r=Y(e,"logits","sigmoidCrossEntropyWithLogits");h(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),o=r.mul(n),a=r.abs().neg().exp().log1p();return i.sub(o).add(a)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"sigmoidCrossEntropyWithLogits",null),t}();function Pe(t,e,n,r,i,o){void 0===i&&(i=0),void 0===o&&(o=0);for(var a=[],s=[],u=0;u<t.length;u++)a[u]=Ue(i,e,r,t,u),s[u]=We(o,n,r,t,u);var l=new Array(t.length).fill(0);return l=l.map(function(t,e){for(var n=0,i=a[e];!(r[e]>0?i>=s[e]:i<=s[e]);i+=r[e])n+=1;return n}),[a,l]}function Ue(t,e,n,r,i){var o=e[i];t&1<<i&&(o=n[i]>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),u(0,o,a-1)}function We(t,e,n,r,i){var o=e[i];t&1<<i&&(o=n[i]>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),n[i]>0?u(0,o,a):u(-1,o,a-1)}var Ve=function(){function t(){}return t.slice1d=function(e,n,r){var i=Y(e,"x","slice1d");return c(1===i.rank,"slice1d expects a rank-1 tensor, but got a rank-"+i.rank+" tensor"),t.slice(i,[n],[r])},t.slice2d=function(e,n,r){var i=Y(e,"x","slice2d");return c(2===i.rank,"slice1d expects a rank-2 tensor, but got a rank-"+i.rank+" tensor"),t.slice(i,n,r)},t.slice3d=function(e,n,r){var i=Y(e,"x","slice3d");return c(3===i.rank,"slice1d expects a rank-3 tensor, but got a rank-"+i.rank+" tensor"),t.slice(i,n,r)},t.slice4d=function(e,n,r){var i=Y(e,"x","slice4d");return c(4===i.rank,"slice1d expects a rank-4 tensor, but got a rank-"+i.rank+" tensor"),t.slice(i,n,r)},t.slice=function(t,e,n){var r,i,o=Y(t,"x","slice");if(0===o.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof e?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e,i=(i=null==n?new Array(o.rank).fill(-1):"number"==typeof n?[n].concat(new Array(o.rank-1).fill(-1)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(-1)):n).map(function(t,e){return t>=0?t:(c(-1===t,"Bad value in size"),o.shape[e]-r[e])}),function(t,e,n){c(t.rank===e.length,"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."),c(t.rank===n.length,"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+").");for(var r=0;r<t.rank;++r)c(e[r]+n[r]<=t.shape[r],"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")")}(o,r,i);var a=o.shape;return bt.engine.runKernel(function(t){return t.slice(o,r,i)},{$x:o},function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],a[n]-r[n]-i[n]]);return{$x:function(){return t.pad(e)}}})},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"slice",null),t}(),qe=function(){function t(){}return t.softmax=function(t,e){void 0===e&&(e=-1);var n=Y(t,"logits","softmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return xe(function(t){var n=t.logSumExp([e],!0),r=t.toFloat().sub(n).exp();return{value:r,gradFunc:function(t){var n=t.mul(r);return n.sub(n.sum([e],!0).mul(r))}}})(n)},t.softmaxCrossEntropy=function(t,e,n){void 0===n&&(n=-1);var r=Y(t,"labels","softmaxCrossEntropy"),i=Y(e,"logits","softmaxCrossEntropy");if(h(r.shape,i.shape,"Error in softmaxCrossEntropy: "),-1===n&&(n=i.rank-1),n!==i.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+i.rank+" and dim was "+n);return xe(function(t,e){var r=e.softmax(n);return{value:tt.scalar(1e-5).add(r).log().mul(t).neg().sum([n]),gradFunc:function(e){var i=Et(e.shape,[n]);return[e.reshape(i).mul(t.toFloat().sub(r)),e.reshape(i).mul(r.sub(t.toFloat()))]}}})(r,i)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"softmax",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"softmaxCrossEntropy",null),t}(),Ge=function(){function t(){}return t.stridedSlice=function(t,e,n,r,i,o){void 0===i&&(i=0),void 0===o&&(o=0);var a=Y(t,"x","stridedSlice");return bt.engine.runKernel(function(t){return t.stridedSlice(a,e,n,r,i,o)},{$x:a})},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"stridedSlice",null),t}(),je=function(){function t(){}return t.transpose=function(t,e){var n=Y(t,"x","transpose");return null==e&&(e=n.shape.map(function(t,e){return e}).reverse()),c(n.rank===e.length,"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."),e.forEach(function(t){c(t>=0&&t<n.rank,"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e)}),n.rank<=1?n.clone():bt.engine.runKernel(function(t){return t.transpose(n,e)},{$x:n},function(t){var n=It(e);return{$x:function(){return t.transpose(n)}}})},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Mt],t,"transpose",null),t}(),He=Yt.batchNormalization,$e=Yt.batchNormalization2d,Ke=Yt.batchNormalization3d,Xe=Yt.batchNormalization4d,Je=Ot.concat,Ye=Ot.concat1d,Ze=Ot.concat2d,Qe=Ot.concat3d,tn=Ot.concat4d,en=ae.conv1d,nn=ae.conv2d,rn=ae.conv2dTranspose,on=ae.depthwiseConv2d,an=ae.separableConv2d,sn=Te.matMul,un=Te.matrixTimesVector,ln=Te.outerProduct,cn=Te.vectorTimesMatrix,hn=Te.dot,pn=ze.avgPool,fn=ze.maxPool,dn=je.transpose,gn=Oe.reverse,vn=Oe.reverse1d,mn=Oe.reverse2d,yn=Oe.reverse3d,bn=Oe.reverse4d,wn=Ve.slice,xn=Ve.slice1d,Sn=Ve.slice2d,En=Ve.slice3d,kn=Ve.slice4d,Cn=Ge.stridedSlice,Rn=Ee.argMax,In=Ee.argMin,An=Ee.logSumExp,Nn=Ee.max,Tn=Ee.mean,Dn=Ee.min,zn=Ee.all,Mn=Ee.any,On=Ee.moments,Ln=Ee.sum,Fn=te.equal,_n=te.equalStrict,Bn=te.greater,Pn=te.greaterStrict,Un=te.greaterEqual,Wn=te.greaterEqualStrict,Vn=te.less,qn=te.lessStrict,Gn=te.lessEqual,jn=te.lessEqualStrict,Hn=te.notEqual,$n=te.notEqualStrict,Kn=Re.logicalNot,Xn=Re.logicalAnd,Jn=Re.logicalOr,Yn=Re.logicalXor,Zn=Re.where,Qn=Jt.abs,tr=Jt.acos,er=Jt.acosh,nr=Jt.asin,rr=Jt.asinh,ir=Jt.atan,or=Jt.atanh,ar=Jt.ceil,sr=Jt.clipByValue,ur=Jt.cos,lr=Jt.cosh,cr=Me.elu,hr=Jt.exp,pr=Jt.expm1,fr=Jt.floor,dr=Jt.sign,gr=Me.leakyRelu,vr=Jt.log,mr=Jt.log1p,yr=Jt.logSigmoid,br=Jt.neg,wr=Me.prelu,xr=Me.relu,Sr=Jt.reciprocal,Er=Jt.round,kr=Me.selu,Cr=Jt.sigmoid,Rr=Jt.sin,Ir=Jt.sinh,Ar=Jt.softplus,Nr=Jt.sqrt,Tr=Jt.rsqrt,Dr=Jt.square,zr=Jt.step,Mr=Jt.tan,Or=Jt.tanh,Lr=Jt.erf,Fr=Qt.add,_r=Qt.addStrict,Br=Qt.atan2,Pr=Qt.div,Ur=Qt.floorDiv,Wr=Qt.divStrict,Vr=Qt.maximum,qr=Qt.maximumStrict,Gr=Qt.minimum,jr=Qt.minimumStrict,Hr=Qt.mod,$r=Qt.modStrict,Kr=Qt.mul,Xr=Qt.mulStrict,Jr=Qt.pow,Yr=Qt.powStrict,Zr=Qt.sub,Qr=Qt.subStrict,ti=Qt.squaredDifference,ei=Qt.squaredDifferenceStrict,ni=Se.norm,ri=Ht.cast,ii=Ht.clone,oi=Ht.fromPixels,ai=Ht.toPixels,si=tt.ones,ui=tt.onesLike,li=tt.zeros,ci=tt.zerosLike,hi=Ht.eye,pi=Ht.rand,fi=Ht.randomNormal,di=Ht.truncatedNormal,gi=Ht.randomUniform,vi=Ht.multinomial,mi=Ht.reshape,yi=Ht.squeeze,bi=Ht.tile,wi=Le.gather,xi=Ht.oneHot,Si=tt.linspace,Ei=tt.range,ki=Ht.buffer,Ci=tt.fill,Ri=tt.tensor,Ii=tt.scalar,Ai=tt.tensor1d,Ni=tt.tensor2d,Ti=tt.tensor3d,Di=tt.tensor4d,zi=tt.tensor5d,Mi=tt.tensor6d,Oi=Ht.print,Li=Ht.expandDims,Fi=Ht.stack,_i=Ht.unstack,Bi=Ht.split,Pi=Ht.cumsum,Ui=Ht.pad,Wi=Ht.pad1d,Vi=Ht.pad2d,qi=Ht.pad3d,Gi=Ht.pad4d,ji=Le.unsortedSegmentSum,Hi=De.movingAverage,$i=Ne.basicLSTMCell,Ki=Ne.multiRNNCell,Xi=qe.softmax,Ji=Be.sigmoidCrossEntropyWithLogits,Yi=Ae.localResponseNormalization,Zi=ke,Qi={absoluteDifference:Ie.absoluteDifference,computeWeightedLoss:Ie.computeWeightedLoss,cosineDistance:Ie.cosineDistance,hingeLoss:Ie.hingeLoss,huberLoss:Ie.huberLoss,logLoss:Ie.logLoss,meanSquaredError:Ie.meanSquaredError,softmaxCrossEntropy:qe.softmaxCrossEntropy},to={resizeBilinear:le.resizeBilinear,resizeNearestNeighbor:le.resizeNearestNeighbor},eo=Object.freeze({batchNormalization:He,batchNormalization2d:$e,batchNormalization3d:Ke,batchNormalization4d:Xe,concat:Je,concat1d:Ye,concat2d:Ze,concat3d:Qe,concat4d:tn,conv1d:en,conv2d:nn,conv2dTranspose:rn,depthwiseConv2d:on,separableConv2d:an,matMul:sn,matrixTimesVector:un,outerProduct:ln,vectorTimesMatrix:cn,dot:hn,avgPool:pn,maxPool:fn,transpose:dn,reverse:gn,reverse1d:vn,reverse2d:mn,reverse3d:yn,reverse4d:bn,slice:wn,slice1d:xn,slice2d:Sn,slice3d:En,slice4d:kn,stridedSlice:Cn,argMax:Rn,argMin:In,logSumExp:An,max:Nn,mean:Tn,min:Dn,all:zn,any:Mn,moments:On,sum:Ln,equal:Fn,equalStrict:_n,greater:Bn,greaterStrict:Pn,greaterEqual:Un,greaterEqualStrict:Wn,less:Vn,lessStrict:qn,lessEqual:Gn,lessEqualStrict:jn,notEqual:Hn,notEqualStrict:$n,logicalNot:Kn,logicalAnd:Xn,logicalOr:Jn,logicalXor:Yn,where:Zn,abs:Qn,acos:tr,acosh:er,asin:nr,asinh:rr,atan:ir,atanh:or,ceil:ar,clipByValue:sr,cos:ur,cosh:lr,elu:cr,exp:hr,expm1:pr,floor:fr,sign:dr,leakyRelu:gr,log:vr,log1p:mr,logSigmoid:yr,neg:br,prelu:wr,relu:xr,reciprocal:Sr,round:Er,selu:kr,sigmoid:Cr,sin:Rr,sinh:Ir,softplus:Ar,sqrt:Nr,rsqrt:Tr,square:Dr,step:zr,tan:Mr,tanh:Or,erf:Lr,add:Fr,addStrict:_r,atan2:Br,div:Pr,floorDiv:Ur,divStrict:Wr,maximum:Vr,maximumStrict:qr,minimum:Gr,minimumStrict:jr,mod:Hr,modStrict:$r,mul:Kr,mulStrict:Xr,pow:Jr,powStrict:Yr,sub:Zr,subStrict:Qr,squaredDifference:ti,squaredDifferenceStrict:ei,norm:ni,cast:ri,clone:ii,fromPixels:oi,toPixels:ai,ones:si,onesLike:ui,zeros:li,zerosLike:ci,eye:hi,rand:pi,randomNormal:fi,truncatedNormal:di,randomUniform:gi,multinomial:vi,reshape:mi,squeeze:yi,tile:bi,gather:wi,oneHot:xi,linspace:Si,range:Ei,buffer:ki,fill:Ci,tensor:Ri,scalar:Ii,tensor1d:Ai,tensor2d:Ni,tensor3d:Ti,tensor4d:Di,tensor5d:zi,tensor6d:Mi,print:Oi,expandDims:Li,stack:Fi,unstack:_i,split:Bi,cumsum:Pi,pad:Ui,pad1d:Wi,pad2d:Vi,pad3d:qi,pad4d:Gi,unsortedSegmentSum:ji,movingAverage:Hi,basicLSTMCell:$i,multiRNNCell:Ki,softmax:Xi,sigmoidCrossEntropyWithLogits:Ji,localResponseNormalization:Yi,linalg:Zi,losses:Qi,image:to,operation:Mt}),no=30;function ro(t){return t<=no?t:z(t,Math.floor(Math.sqrt(t)))}function io(t,e,n){if(!I(t.dtype,e))return $.make(t.shape,{dataId:t.dataId},e);if("int32"===e)return n.int(t);if("bool"===e)return n.notEqual(t,tt.scalar(0,t.dtype));throw new Error("Error in Cast: unknown dtype argument ("+e+")")}function oo(t,e){return $.make(e,{dataId:t.dataId},t.dtype)}var ao=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,i=t.batchSize,o=t.inSize,a=Math.ceil(o/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s="max"===e?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = 0;\n        float bestValue = getA(batch, inOffset);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "},so=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,s=1/(e*n);this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n      const float avgMultiplier = float("+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uo=function(t,e,n,r,i,o){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],Xt(t,e),Xt(t,n);var a="0.0";null!=r&&(Xt(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=i&&(Xt(t,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput((x - mean) * inv + offset);\n      }\n    "},lo=function(){function t(t,e,n){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=Xt(e,n),this.userCode="\n      uniform float NAN;\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(){var t=this;return function(e,n){null==t.startLoc&&(t.startLoc=e.getUniformLocationNoThrow(n,"NAN"),null==t.startLoc)||e.gl.uniform1f(t.startLoc,NaN)}},t}(),co=function(t,e,n){this.variableNames=["A"],this.outputShape=t;var r=e.toFixed(20),i=n.toFixed(20);this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, "+r+", "+i+"));\n      }\n    "},ho=function(t,e){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=zt(t,e,1),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        float value = 0.0;\n        if (yC < "+t[1]+") {\n          value = getA(yR, yC);\n        } else {\n          yC -= "+t[1]+";\n          value = getB(yR, yC);\n        }\n\n        setOutput(value);\n      }\n    "},po=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},fo=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},go=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+o+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vo=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},mo=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.top,n=t.padInfo.left,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,s=t.filterHeight,u=t.filterWidth,l=4*Math.floor(t.inChannels/4),c=t.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+i+");\n      const ivec2 pads = ivec2("+e+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+o+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+a+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+l+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===c)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+l+") *\n                getW(wR, wC, "+l+", d2);\n            } else if ("+(2===c)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===c)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1),\n                getX(batch, xR, xC, "+l+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2),\n                getW(wR, wC, "+l+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},yo=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.inHeight,n=t.inWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.strideHeight,a=t.strideWidth,s=t.dilationHeight,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,h=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+r+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+h+";\n        int q = d2 - d1 * "+h+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+s+";\n\n          if (xR < 0 || xR >= "+e+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+n+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};function bo(t,e,n,r){var i=t.map(function(t){var e=g(t.shapeInfo.logicalShape);return t.shapeInfo.isUniform?"uniform float "+t.name+(e>1?"["+e+"]":"")+";":"uniform sampler2D "+t.name+";"});i=i.join("\n");var o=t.map(function(t){return function(t,e,n){var r=function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1)+"Flat",r=g(t.shapeInfo.logicalShape);if(t.shapeInfo.isUniform)return 1===r?"float "+n+"(int index) {return "+e+";}":"\n      float "+n+"(int index) {\n        for (int i = 0; i < "+r+"; i++) {\n          if (i == index) {\n            return "+e+"[i];\n          }\n        }\n      }\n    ";var i=t.shapeInfo.texShape,o=i[0],a=i[1];return 1===a&&1===o?"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ":1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = UVfrom1D("+o+", "+a+", index);\n      return sampleTexture("+e+", uv);\n    }\n  "}(t);return r+=wo(t),(n||v(t.shapeInfo.logicalShape,e.logicalShape))&&(r+=function(t,e,n){var r=t.name,i=r.charAt(0).toUpperCase()+r.slice(1),o="get"+i+"AtOutCoords",a=$t(t.shapeInfo.logicalShape,e.logicalShape),s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length,l=n&&(u>s||a.length>0),c=function(t){for(var e=0;e<t.length;e++)if(t[e]!==e)return!1;return!0}(a),h=t.shapeInfo.isUniform;if(l&&!c)return function(t,e,n,r){var i=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a="int";2===o?a="ivec2":3===o?a="ivec3":4===o&&(a="ivec4");var s=$t(t.shapeInfo.logicalShape,e.logicalShape),u=o-i;return"\n    float "+r+"() {\n      "+a+" coords = getOutputCoords();\n      "+(0===i?"":o<2&&s.length>=1?"coords = 0;":s.map(function(t){return"coords["+(t+u)+"] = 0;"}).join("\n"))+"\n      return get"+n+"("+(o<2&&i>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords["+(e+u)+"]"}).join(", "))+");\n    }\n  "}(t,e,i,o);var p=g(t.shapeInfo.logicalShape),f="";l&&c&&(f="\n        int mainPart = index / "+p+";\n        index -= mainPart * "+p+";\n      ");var d=e.texShape;if(h)return 1===p?"float "+o+"() {return "+r+";}":"\n      float "+o+"() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                              vec2("+d[0]+", "+d[1]+"));\n        int index = resTexRC.x * "+d[1]+" + resTexRC.y;\n        "+f+"\n        return get"+i+"Flat(index);\n      }\n    ";var m=t.shapeInfo.texShape;return v(m,d)?"\n      float "+o+"() {\n        return sampleTexture("+r+", resultUV);\n      }\n    ":"\n    float "+o+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+d[0]+", "+d[1]+"));\n      int index = resTexRC.x * "+d[1]+" + resTexRC.y;\n      "+f+"\n      int texR = index / "+m[1]+";\n      int texC = index - texR * "+m[1]+";\n      vec2 uv = (vec2(texC, texR) + halfCR) /\n                 vec2("+m[1]+".0, "+m[0]+".0);\n\n      return sampleTexture("+r+", uv);\n    }\n  "}(t,e,n)),r}(t,e,r)}).join("\n"),a=e.texShape,s=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return v(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return function(t,e){var n=t[1]*t[2],r=t[2];return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+n+";\n      index -= r * "+n+";\n      int c = index / "+r+";\n      int d = index - c * "+r+";\n      return ivec3(r, c, d);\n    }\n  "}(t,e);case 4:return function(t,e){var n=t[3],r=t[2]*n,i=t[1]*r;return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      int r = index / "+i+";\n      index -= r * "+i+";\n\n      int c = index / "+r+";\n      index -= c * "+r+";\n\n      int d = index / "+n+";\n      int d2 = index - d * "+n+";\n\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=t[4],r=t[3]*n,i=t[2]*r,o=t[1]*i;return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      int r = index / "+o+";\n      index -= r * "+o+";\n\n      int c = index / "+i+";\n      index -= c * "+i+";\n\n      int d = index / "+r+";\n      index -= d * "+r+";\n\n      int d2 = index  / "+n+";\n      int d3 = index - d2 * "+n+";\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=t[5],r=t[4]*n,i=t[3]*r,o=t[2]*i,a=t[1]*o;return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      int r = index / "+a+";\n      index -= r * "+a+";\n\n      int c = index / "+o+";\n      index -= c * "+o+";\n\n      int d = index / "+i+";\n      index -= d * "+i+";\n\n      int d2 = index / "+r+";\n      index -= d2 * "+r+";\n\n      int d3 = index / "+n+";\n      int d4 = index - d3 * "+n+";\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}}(e.logicalShape,a);return[Eo,xo,So,i,s,o,n].join("\n")}function wo(t){var e=t.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);return t.shapeInfo.isUniform?"float "+n+"() {return "+e+";}":"\n    float "+n+"() {\n      return sampleTexture("+e+", halfCR);\n    }\n  "}(t);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);return"\n    float "+n+"(int index) {\n      return "+n+"Flat(index);\n    }\n  "}(t);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape;if(null!=i&&v(e,i)){var o=i[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+o+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var a=k(e),s=a.newShape,u=a.keptDims,l=s;if(l.length<e.length)return"\n      "+wo(Co(t,l))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+Ro(["row","col"],u)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = row * "+e[1]+" + col;\n        return "+r+"Flat(index);\n      }\n    ";var c=i[0],h=i[1];return 1===h?"\n    float "+r+"(int row, int col) {\n      int index = row * "+e[1]+" + col;\n      vec2 uv = vec2(0.5, (float(index) + 0.5) / "+c+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===c?"\n    float "+r+"(int row, int col) {\n      int index = row * "+e[1]+" + col;\n      vec2 uv = vec2((float(index) + 0.5) / "+h+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    vec2 uv = UVfrom2D("+c+", "+h+", "+e[1]+", row, col);\n    return sampleTexture("+n+", uv);\n  }\n"}(t);case 3:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[1]*e[2],o=e[2],a=k(e),s=a.newShape,u=a.keptDims,l=s;if(l.length<e.length)return"\n        "+wo(Co(t,l))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+Ro(["row","col","depth"],u)+");\n        }\n      ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = row * "+i+" + col * "+o+" + depth;\n        return "+r+"Flat(index);\n      }\n    ";var c=t.shapeInfo.texShape,h=c[0],p=c[1];return p===i?"\n        float "+r+"(int row, int col, int depth) {\n          int texR = row;\n          int texC = col * "+o+" + depth;\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+p+".0, "+h+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":p===o?"\n    float "+r+"(int row, int col, int depth) {\n      int texR = row * "+e[1]+" + col;\n      int texC = depth;\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+p+".0, "+h+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        vec2 uv = UVfrom3D(\n            "+h+", "+p+", "+i+", "+o+", row, col, depth);\n        return sampleTexture("+n+", uv);\n      }\n  "}(t);case 4:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[3],o=e[2]*i,a=e[1]*o,s=k(e),u=s.newShape,l=s.keptDims;if(u.length<e.length)return"\n      "+wo(Co(t,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+Ro(["row","col","depth","depth2"],l)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = row * "+a+" + col * "+o+" +\n            depth * "+i+" + depth2;\n        return "+r+"Flat(index);\n      }\n    ";var c=t.shapeInfo.texShape,h=c[0],p=c[1];return p===a?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int texR = row;\n        int texC = col * "+o+" + depth * "+i+" + depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===i?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int texR = row * "+e[1]*e[2]+" + col * "+e[2]+" + depth;\n        int texC = depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      vec2 uv = UVfrom4D("+h+", "+p+", "+a+", "+o+",\n          "+i+", row, col, depth, depth2);\n      return sampleTexture("+n+", uv);\n    }\n  "}(t);case 5:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],o=e[3]*i,a=e[2]*o,s=e[1]*a,u=k(e),l=u.newShape,c=u.keptDims;if(l.length<e.length)return"\n      "+wo(Co(t,l))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+Ro(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int index = row * "+s+" + col * "+a+" +\n            depth * "+o+" + depth2 * "+i+" + depth3;\n        return "+r+"Flat(index);\n      }\n    ";var h=t.shapeInfo.texShape,p=h[0],f=h[1];return f===s?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        int texC = col * "+a+" + depth * "+o+" +\n                   depth2 * "+i+" + depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":f===i?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row * "+e[1]*e[2]+" + col * "+e[2]+" +\n                   depth * "+e[3]+" + depth2;\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      vec2 uv = UVfrom5D("+p+", "+f+", "+s+", "+a+",\n          "+o+", "+i+", row, col, depth, depth2, depth3);\n      return sampleTexture("+n+", uv);\n    }\n  "}(t);case 6:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[5],o=e[4]*i,a=e[3]*o,s=e[2]*a,u=e[1]*s,l=k(e),c=l.newShape,h=l.keptDims;if(c.length<e.length)return"\n      "+wo(Co(t,c))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+Ro(["row","col","depth","depth2","depth3","depth4"],h)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = row * "+u+" + col * "+s+" +\n            depth * "+a+" + depth2 * "+o+" + depth3 * "+o+"\n            + depth4\n        return "+r+"Flat(index);\n      }\n    ";var p=t.shapeInfo.texShape,f=p[0],d=p[1];return d===u?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        int texC = col * "+s+" + depth * "+a+" + depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":d===i?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row * "+e[1]*e[2]+" + col * "+e[2]+" + depth;\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      vec2 uv = UVfrom6D("+f+", "+d+", "+u+", "+s+",\n          "+a+", "+o+", "+i+"\n          ,row, col, depth, depth2, depth3, depth4);\n      return sampleTexture("+n+", uv);\n    }\n  "}(t);default:throw new Error(e.length+"-D input sampling is not yet supported")}}var xo="\n  float sampleTexture(sampler2D textureSampler, vec2 uv) {\n    return texture2D(textureSampler, uv).r;\n  }\n",So="\n  void setOutput(float val) {\n    gl_FragColor = vec4(val, 0, 0, 0);\n  }\n",Eo="\n  precision highp float;\n  precision highp int;\n  varying vec2 resultUV;\n  const vec2 halfCR = vec2(0.5, 0.5);\n\n  struct ivec5\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n  };\n\n  struct ivec6\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n    int v;\n  };\n\n  bool isNaN(float val) {\n    return (val < 0.0 || 0.0 < val || val == 0.0) ? false : true;\n  }\n\n  bool hasNaN(vec4 values) {\n    vec4 v1 = values * values;\n    vec4 v2 = values * values;\n    return any(notEqual(v1, v2));\n  }\n\n  float getNaN(vec4 values) {\n    return dot(vec4(1), values);\n  }\n\n  int round(float value) {\n    return int(floor(value + 0.5));\n  }\n\n  int imod(int x, int y) {\n    return x - y * (x / y);\n  }\n\n  //Based on the work of Dave Hoskins\n  //https://www.shadertoy.com/view/4djSRW\n  #define HASHSCALE1 443.8975\n  float random(float seed){\n    vec2 p = resultUV * seed;\n    vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n  }\n\n  \nvec2 UVfrom1D(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {\n  int index = row * numC + col;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom3D(int texNumR, int texNumC, int stride0,\n    int stride1, int row, int col, int depth) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom4D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int row, int col, int depth,\n    int depth2) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom5D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int row, int col, int depth,\n    int depth2, int depth3) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 +\n              depth * stride2 + depth2 * stride3 + depth3;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom6D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int stride4,\n    int row, int col, int depth, int depth2, int depth3, int depth4) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2 *\n    stride3 + depth3 * stride4 + depth4;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n";function ko(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Co(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Ro(t,e){return e.map(function(e){return t[e]}).join(", ")}var Io=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=t[t.length-1],o=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+ko(r)+" coords = getOutputCoords();\n        int end = "+Ao(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+Ao(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===t)return""+e;if(2===t)return e+".x, "+e+".y";if(3===t)return e+".x, "+e+".y, "+e+".z";if(4===t)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Ao(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var No,To,Do=function(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isNaN(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        gl_FragColor = encode_float(x);\n      }\n    "},zo=function(t){this.variableNames=["A"];var e=t[0],n=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+n+".0, "+e+".0);\n\n        vec4 values = texture2D(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Mo=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var i=ko(this.rank),o=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=0;o<t.length;o++)o===e?i.push("int(getIndices("+r[o]+"))"):i.push(""+r[o]);return i.join()}(t,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "};function Oo(t,e){return[e,t]}function Lo(t,e){return t*e}function Fo(t,e,n){var r=function(t,e){if(t%e!=0)throw new Error("unpackedSize ("+t+") must be a multiple of "+e);return t/e}(t.length,n);if(e.length<r)throw new Error("matrix length ("+e.length+") must be >= "+r);for(var i=0,o=0;o<t.length;o+=n)e[i++]=t[o]}function _o(t,e){return[Math.ceil(e/2),Math.ceil(t/2)]}function Bo(t,e){var n=_o(t,e);return n[0]*n[1]*4}!function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(No||(No={})),function(t){t[t.FLOAT16=0]="FLOAT16",t[t.FLOAT32=1]="FLOAT32",t[t.UNSIGNED_BYTE=2]="UNSIGNED_BYTE"}(To||(To={}));var Po=null;function Uo(t){var e=document.createElement("canvas");return e.width=1,e.height=1,Wo(e,t)}function Wo(t,e){var n,r=bt.get("WEBGL_VERSION");if(2===r?n=t.getContext("webgl2",e):1===r&&(n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)),0===r||null==n)throw new Error("This browser does not support WebGL.");return n}function Vo(t,e){var n=e();return jo(t),n}var qo=!1;function Go(t){qo=t}function jo(t){if(qo){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Ho(t,e))}}function Ho(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function $o(t,e){return va(t,function(){return t.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function Ko(t,e){var n=va(t,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Vo(t,function(){return t.shaderSource(n,e)}),Vo(t,function(){return t.compileShader(n)}),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function Xo(t,e){var n=va(t,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Vo(t,function(){return t.shaderSource(n,e)}),Vo(t,function(){return t.compileShader(n)}),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw function(t,e){var n=Jo.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],i=t.split("\n"),o=i.length.toString().length+2,a=i.map(function(t,e){return w((e+1).toString(),o)+t}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var l=a.slice(0,r-1),c=a.slice(r-1,r),h=a.slice(r);console.log(l.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+w(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var Jo=/ERROR: [0-9]+:([0-9]+):/g;function Yo(t){return va(t,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function Zo(t,e){if(Vo(t,function(){return t.linkProgram(e)}),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Qo(t,e){if(Vo(t,function(){return t.validateProgram(e)}),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function ta(t,e){var n=va(t,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Vo(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)}),Vo(t,function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}),n}function ea(t,e){var n=va(t,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Vo(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)}),Vo(t,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}),n}function na(t){return null!=Po?Po:Po=Vo(t,function(){return t.getParameter(t.MAX_TEXTURE_SIZE)})}function ra(){return 2===bt.get("WEBGL_VERSION")?1:4}function ia(t){return va(t,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function oa(t,e,n){var r=na(t);if(e<=0||n<=0){var i="["+e+"x"+n+"]";throw new Error("Requested texture size "+i+" is invalid.")}if(e>r||n>r)throw i="["+e+"x"+n+"]",new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU ["+r+"x"+r+"].")}function aa(t){return va(t,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function sa(t,e,n,r,i,o,a){var s=t.getAttribLocation(e,n);return-1!==s&&(Vo(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Vo(t,function(){return t.vertexAttribPointer(s,i,t.FLOAT,!1,o,a)}),Vo(t,function(){return t.enableVertexAttribArray(s)}),!0)}function ua(t,e,n){ma(t,n),Vo(t,function(){return t.activeTexture(t.TEXTURE0+n)}),Vo(t,function(){return t.bindTexture(t.TEXTURE_2D,e)})}function la(t,e,n){return va(t,function(){return t.getUniformLocation(e,n)},'uniform "'+n+'" not present in program.')}function ca(t,e,n){return t.getUniformLocation(e,n)}function ha(t,e,n,r,i){Vo(t,function(){return ua(t,n,i)}),Vo(t,function(){return t.uniform1i(r,i)})}function pa(t,e,n){Vo(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),Vo(t,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)})}function fa(t,e){Vo(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)}),Vo(t,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function da(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+ga(t,e))}function ga(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function va(t,e,n){var r=Vo(t,function(){return e()});if(null==r)throw new Error(n);return r}function ma(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function ya(t,e){2!==e.length&&(e=k(e).newShape);var n=na(t),r=g(e);return e.length<=1&&r<=n?[r,1]:2===e.length&&e[0]<=n&&e[1]<=n?e:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?[e[0],e[1]*e[2]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n?[e[0],e[1]*e[2]*e[3]]:b(r)}var ba=Object.freeze({createWebGLRenderingContext:Uo,createWebGLRenderingContextFromCanvas:Wo,callAndCheck:Vo,enableDebugWebGLErrorChecking:Go,checkWebGLError:jo,getWebGLErrorMessage:Ho,getExtensionOrThrow:$o,createVertexShader:Ko,createFragmentShader:Xo,createProgram:Yo,linkProgram:Zo,validateProgram:Qo,createStaticVertexBuffer:ta,createStaticIndexBuffer:ea,queryMaxTextureSize:na,getNumChannels:ra,createTexture:ia,validateTextureSize:oa,createFramebuffer:aa,bindVertexBufferToProgramAttribute:sa,bindTextureUnit:ua,unbindTextureUnit:function(t,e){ma(t,e),Vo(t,function(){return t.activeTexture(t.TEXTURE0+e)}),Vo(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:la,getProgramUniformLocation:ca,bindTextureToProgramUniformSampler:ha,bindCanvasToFramebuffer:function(t){Vo(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Vo(t,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),Vo(t,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:pa,unbindColorTextureFromFramebuffer:fa,validateFramebuffer:da,getFramebufferErrorMessage:ga,getTextureShapeFromLogicalShape:ya});function wa(){return{alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0}}function xa(t){var e,n={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};return Vo(e=null!=t?Wo(t,n):Uo(n),function(){return e.disable(e.DEPTH_TEST)}),Vo(e,function(){return e.disable(e.STENCIL_TEST)}),Vo(e,function(){return e.disable(e.BLEND)}),Vo(e,function(){return e.disable(e.DITHER)}),Vo(e,function(){return e.disable(e.POLYGON_OFFSET_FILL)}),Vo(e,function(){return e.disable(e.SAMPLE_COVERAGE)}),Vo(e,function(){return e.enable(e.SCISSOR_TEST)}),Vo(e,function(){return e.enable(e.CULL_FACE)}),Vo(e,function(){return e.cullFace(e.BACK)}),e}function Sa(t){return Ko(t,"\n    precision highp float;\n    attribute vec3 clipSpacePos;\n    attribute vec2 uv;\n    varying vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Ea(t){return ta(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function ka(t){return ea(t,new Uint16Array([0,1,2,2,1,3]))}function Ca(t,e){var n,r,i,o,a,s,u,l=t;return 2===bt.get("WEBGL_VERSION")?(n=l.R32F,r=l.R16F,i=l.RGBA32F,o=l.RED,a=4,s=1,u=l.HALF_FLOAT):(n=t.RGBA,r=t.RGBA,i=l.RGBA,o=t.RGBA,a=4,s=4,u=null!=e?e.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:s,textureTypeHalfFloat:u}}function Ra(t,e,n,r,i,o){oa(t,e,n);var a=ia(t),s=t.TEXTURE_2D;return Vo(t,function(){return t.bindTexture(s,a)}),Vo(t,function(){return t.texParameteri(s,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),Vo(t,function(){return t.texParameteri(s,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),Vo(t,function(){return t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST)}),Vo(t,function(){return t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST)}),Vo(t,function(){return t.texImage2D(s,0,r,e,n,0,i,o,null)}),Vo(t,function(){return t.bindTexture(t.TEXTURE_2D,null)}),a}function Ia(t,e,n,r){var i=Oo(e,n);return Ra(t,i[0],i[1],r.internalFormatFloat,r.textureFormatFloat,t.FLOAT)}function Aa(t,e,n,r){var i=Oo(e,n);return Ra(t,i[0],i[1],r.internalFormatFloat,r.textureFormatFloat,r.textureTypeHalfFloat)}function Na(t,e,n,r){var i=Oo(e,n);return Ra(t,i[0],i[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function Ta(t,e,n,r){var i=_o(e,n);return Ra(t,i[0],i[1],r.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function Da(t,e,n){return Vo(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)}),sa(t,e,"clipSpacePos",n,3,20,0)&&sa(t,e,"uv",n,2,20,12)}function za(t,e,n){Vo(t,function(){return t.bindTexture(t.TEXTURE_2D,e)}),Vo(t,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}),Vo(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Ma(t,e,n,r,i,o){oa(t,n,r),Vo(t,function(){return t.bindTexture(t.TEXTURE_2D,e)}),Vo(t,function(){return t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,o,t.FLOAT,i)}),Vo(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Oa(t,e,n,r,i,o,a){var s,u=Oo(n,r),l=u[0],c=u[1];1===a.defaultNumChannels?s=i:function(t,e,n){var r=Lo(t.length,n);if(e.length<r)throw new Error("unpackedArray length ("+e.length+") must be >= "+r);for(var i=0,o=0;o<t.length;++o)e[i]=t[o],i+=n}(i,s=new Float32Array(Lo(i.length,o)),o),Ma(t,e,l,c,s,a.textureFormatFloat)}function La(t,e,n,r,i,o){var a=_o(n,r),s=a[0],u=a[1],l=new Float32Array(Bo(n,r));(function(t,e,n,r){var i=Bo(e,n);if(r.length<i)throw new Error("packedRGBA length ("+r.length+") must be >= "+i);for(var o=_o(e,n),a=o[0],s=o[1],u=n%2==1,l=e%2==1,c=Math.floor(n/2),h=Math.floor(e/2),p=u?4:0,f=n,d=0,g=0;g<h;++g){for(var v=2*g*n,m=0;m<c;++m){var y=v+2*m;r[d]=t[y],r[d+1]=t[y+1],r[d+2]=t[y+f],r[d+3]=t[y+f+1],d+=4}d+=p}if(u){y=n-1,d=4*(a-1);var b=2*n;for(p=4*a,g=0;g<h;++g)r[d]=t[y],r[d+2]=t[y+n],y+=b,d+=p}if(l)for(y=(e-1)*n,d=(s-1)*a*4,m=0;m<c;++m)r[d++]=t[y++],r[d++]=t[y++],d+=2;u&&l&&(r[r.length-4]=t[t.length-1])})(i,n,r,l),Ma(t,e,s,u,l,t.RGBA)}function Fa(t,e,n,r,a){return i(this,void 0,void 0,function(){var i,s,u,l,c;return o(this,function(o){switch(o.label){case 0:return i=t,s=new Float32Array(Lo(n*r,a.downloadUnpackNumChannels)),u=s instanceof Float32Array?4*s.length:s,l=t.createBuffer(),Vo(t,function(){return t.bindBuffer(i.PIXEL_PACK_BUFFER,l)}),Vo(t,function(){return t.bufferData(i.PIXEL_PACK_BUFFER,u,t.STATIC_DRAW)}),Vo(t,function(){return i.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),[4,e.getBufferSubDataAsync(i.PIXEL_PACK_BUFFER,0,s)];case 1:return o.sent(),c=new Float32Array(n*r),Fo(s,c,a.downloadUnpackNumChannels),[2,c]}})})}function _a(t,e,n,r){var i=Oo(e,n),o=i[0],a=i[1],s=new Float32Array(Lo(e*n,r.downloadUnpackNumChannels));Vo(t,function(){return t.readPixels(0,0,o,a,r.downloadTextureFormat,t.FLOAT,s)});var u=new Float32Array(e*n);return Fo(s,u,r.downloadUnpackNumChannels),u}function Ba(t,e,n,r){var i=Oo(e,n),o=i[0],a=i[1],s=new Uint8Array(Lo(e*n,4));return Vo(t,function(){return t.readPixels(0,0,o,a,r.downloadTextureFormat,t.UNSIGNED_BYTE,s)}),new Float32Array(s.buffer)}function Pa(t,e,n,r){var i=_o(e,n),o=i[0],a=i[1],s=new Float32Array(Bo(e,n));Vo(t,function(){return t.readPixels(0,0,o,a,t.RGBA,t.FLOAT,s)});var u=new Float32Array(e*n);return function(t,e,n,r){var i=e*n;if(i<r.length)throw new Error("matrix length ("+r.length+") must be >= "+i);for(var o=n%2==1,a=e%2==1,s=Math.floor(n/2),u=Math.floor(e/2),l=_o(e,n),c=l[0],h=l[1],p=o?4:0,f=n+(o?1:0),d=0,g=0,v=n,m=0;m<u;++m){for(var y=0;y<s;++y)r[g++]=t[d++],r[g++]=t[d++],r[v++]=t[d++],r[v++]=t[d++];d+=p,g+=f,v+=f}if(o){d=4*(c-1);var b=n-1;for(p=4*c,f=2*n,m=0;m<u;++m)r[b]=t[d],r[b+n]=t[d+2],d+=p,b+=f}if(a)for(d=(h-1)*c*4,b=(e-1)*n,y=0;y<s;++y)r[b++]=t[d++],r[b++]=t[d++],d+=2;return o&&a&&(r[r.length-1]=t[t.length-4]),r}(s,e,n,u)}var Ua=Object.freeze({getWebGLContextAttributes:wa,createWebGLContext:xa,createVertexShader:Sa,createVertexBuffer:Ea,createIndexBuffer:ka,getTextureConfig:Ca,createFloat32MatrixTexture:Ia,createFloat16MatrixTexture:Aa,createUnsignedBytesMatrixTexture:Na,createPackedMatrixTexture:Ta,bindVertexProgramAttributeStreams:Da,uploadPixelDataToTexture:za,uploadMatrixToTexture:Oa,uploadMatrixToPackedTexture:La,downloadMatrixFromOutputTextureAsync:Fa,downloadFloat32MatrixFromOutputTexture:_a,downloadByteEncodedFloatMatrixFromOutputTexture:Ba,downloadMatrixFromPackedOutputTexture:Pa}),Wa=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[],this.gl=null!=t?t:xa(),1===bt.get("WEBGL_VERSION")?(this.textureFloatExtension=$o(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),bt.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=$o(this.gl,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=$o(this.gl,"EXT_color_buffer_float"),this.loseContextExtension=$o(this.gl,"WEBGL_lose_context"),bt.get("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED")&&(this.getBufferSubDataAsyncExtension=this.gl.getExtension("WEBGL_get_buffer_sub_data_async")),this.vertexBuffer=Ea(this.gl),this.indexBuffer=ka(this.gl),this.framebuffer=aa(this.gl),this.textureConfig=Ca(this.gl,this.textureHalfFloatExtension)}return t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Vo(e,function(){return e.finish()}),Vo(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Vo(e,function(){return e.deleteFramebuffer(t.framebuffer)}),Vo(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Vo(e,function(){return e.deleteBuffer(t.vertexBuffer)}),Vo(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Vo(e,function(){return e.deleteBuffer(t.indexBuffer)}),this.loseContextExtension.loseContext(),this.disposed=!0}},t.prototype.enableAutomaticDebugValidation=function(t){this.autoDebugValidate=t,Go(t)},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),Ia(this.gl,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),Aa(this.gl,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),Na(this.gl,t,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),za(this.gl,t,e)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Ta(this.gl,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(fa(this.gl,this.framebuffer),this.outputTexture=null),Vo(this.gl,function(){return e.gl.deleteTexture(t)})},t.prototype.uploadMatrixToTexture=function(t,e,n,r){this.throwIfDisposed();var i=ra();return Oa(this.gl,t,e,n,r,i,this.textureConfig)},t.prototype.uploadMatrixToPackedTexture=function(t,e,n,r){return this.throwIfDisposed(),La(this.gl,t,e,n,r,this.textureConfig)},t.prototype.downloadFloat32MatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return _a(r.gl,e,n,r.textureConfig)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return Ba(r.gl,e,n,r.textureConfig)})},t.prototype.downloadMatrixFromTextureAsync=function(t,e,n){return i(this,void 0,void 0,function(){var r=this;return o(this,function(i){if(null==this.getBufferSubDataAsyncExtension)throw new Error("Cannot download matrix from output texture asynchronously, WEBGL_get_buffer_sub_data_async is not enabled.");return[2,this.downloadMatrixDriverAsync(t,function(){return Fa(r.gl,r.getBufferSubDataAsyncExtension,e,n,r.textureConfig)})]})})},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return Pa(r.gl,e,n,r.textureConfig)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=Xo(e,t),r=Sa(e),i=Yo(e);return Vo(e,function(){return e.attachShader(i,r)}),Vo(e,function(){return e.attachShader(i,n)}),Zo(e,i),this.autoDebugValidate&&Qo(e,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=Da(e,this.program,this.vertexBuffer)),i},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&Vo(this.gl,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.autoDebugValidate&&Qo(this.gl,this.program),Vo(this.gl,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?la(this.gl,t,e):ca(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),Vo(this.gl,function(){return n.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),ha(this.gl,this.program,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=_o(e,n),i=r[0],o=r[1];this.setOutputMatrixTextureDriver(t,i,o)},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&Qo(this.gl,this.program),da(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.autoDebugValidate&&this.debugValidate(),Vo(t,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),Vo(this.gl,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=$o(this.gl,2===bt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.runQuery=function(t){var e=this.beginQuery();return t(),this.endQuery(),this.pollQueryTime(e)},t.prototype.beginQuery=function(){if(2===bt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},t.prototype.endQuery=function(){if(2!==bt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},t.prototype.pollQueryTime=function(t){var e=this;return new Promise(function(n){var r=bt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION");e.addItemToPoll(function(){return e.isQueryAvailable(t,r)},function(){return n(e.getQueryTime(t,r))})})},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0,n=t.length-1,r=-1;e<=n;){var i=e+n>>1;t[i]()?(r=i,e=i+1):n=i-1}return r}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||x(function(){return n.pollItems(),0===n.itemsToPoll.length})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.downloadMatrixDriverSetup=function(t){this.throwIfDisposed(),pa(this.gl,t,this.framebuffer),this.autoDebugValidate&&da(this.gl)},t.prototype.downloadMatrixDriverTeardown=function(){null!=this.outputTexture?(pa(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&da(this.gl)):fa(this.gl,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.downloadMatrixDriverSetup(t);var n=e();return this.downloadMatrixDriverTeardown(),n},t.prototype.downloadMatrixDriverAsync=function(t,e){return i(this,void 0,void 0,function(){var n;return o(this,function(r){switch(r.label){case 0:return this.downloadMatrixDriverSetup(t),[4,e()];case 1:return n=r.sent(),this.downloadMatrixDriverTeardown(),[2,n]}})})},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;pa(r,t,this.framebuffer),this.autoDebugValidate&&da(r),this.outputTexture=t,Vo(r,function(){return r.viewport(0,0,e,n)}),Vo(r,function(){return r.scissor(0,0,e,n)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var i=this;this.throwIfDisposed(),Vo(this.gl,function(){return i.gl.scissor(t,e,n,r)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function Va(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(t,n){var r=t.logicalShape,i=e[n],o=i.tensor.shape;if(!v(r,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+o+" must match");if(!t.isUniform||!i.isUniform){var a=t.texShape,s=i.isUniform?null:i.texData.texShape;if(!v(a,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+s+" must match")}})}var qa=function(t,e,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<t&&a.push(""+o[u]);r=a.join(),i=s.join()}var l=ko(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},Ga=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";o=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+o+";\n        setOutput(val);\n      }\n    "},ja=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,s=e*n-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+s+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ha=function(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),this.variableNames=["matrixA","matrixB"];var i=n?t[1]:t[0],o=r?e[0]:e[1],a=n?t[0]:t[1];this.outputShape=[i,o];var s=function(t,e){return n?e+" + "+t+", aRow":"aRow, "+e+" + "+t},u=function(t,e){return r?"bCol, "+e+" + "+t:e+" + "+t+", bCol"},l=4*Math.floor(a/4),c=a%4;this.userCode=" float dotARowBCol(int aRow, int bCol) {\n      float result = 0.0;\n      for (int i = 0; i < "+l+"; i += 4) {\n        vec4 a = vec4(\n          getMatrixA("+s(0,"i")+"),\n          getMatrixA("+s(1,"i")+"),\n          getMatrixA("+s(2,"i")+"),\n          getMatrixA("+s(3,"i")+")\n        );\n        vec4 b = vec4(\n          getMatrixB("+u(0,"i")+"),\n          getMatrixB("+u(1,"i")+"),\n          getMatrixB("+u(2,"i")+"),\n          getMatrixB("+u(3,"i")+")\n        );\n\n        result += dot(a, b);\n      }\n\n      if ("+(1===c)+") {\n        result += getMatrixA("+s(0,l)+") *\n          getMatrixB("+u(0,l)+");\n      } else if ("+(2===c)+") {\n        vec2 a = vec2(\n          getMatrixA("+s(0,l)+"),\n          getMatrixA("+s(1,l)+")\n        );\n        vec2 b = vec2(\n          getMatrixB("+u(0,l)+"),\n          getMatrixB("+u(1,l)+")\n        );\n        result += dot(a, b);\n      } else if ("+(3===c)+") {\n        vec3 a = vec3(\n          getMatrixA("+s(0,l)+"),\n          getMatrixA("+s(1,l)+"),\n          getMatrixA("+s(2,l)+")\n        );\n        vec3 b = vec3(\n          getMatrixB("+u(0,l)+"),\n          getMatrixB("+u(1,l)+"),\n          getMatrixB("+u(2,l)+")\n        );\n        result += dot(a, b);\n      }\n\n      return result;\n    }\n\n    void main() {\n      ivec2 resRC = getOutputCoords();\n      setOutput(dotARowBCol(resRC.x, resRC.y));\n    }\n    "},$a=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),Ka=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},Xa=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});var r=t.length,i=ko(r),o=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+o+");\n      "+i+" end = "+i+"("+a+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+o+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Ja=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterHeight,i=t.filterWidth,o=t.strideHeight,a=t.strideWidth,s=t.padInfo.top,u=t.padInfo.left;this.outputShape=t.outShape;var l="avg"===e,c="0.0";if(l||(c="-1.0 / 0.0"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+s+", "+u+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+r+"; wR++) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+i+"; wC++) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+i+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var h=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(h="avgValue / count");var p=4*Math.floor(i/4),f=i%4,d="\n      if ("+l+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+s+", "+u+");\n      const float initializationValue = "+c+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+c+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+r+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC += 4) {\n            int xC = xCCorner + wC;\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              getValue(batch, xR, xC + 3, d)\n            );\n\n            "+d+"\n          }\n\n          int xC = xCCorner + "+p+";\n          if ("+(1===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+d+"\n          } else if ("+(2===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+d+"\n          } else if ("+(3===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              initializationValue\n            );\n\n            "+d+"\n          }\n        }\n        setOutput("+h+");\n      }\n    "}},Ya=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var a="0.0",s="";"min"===e?(a="1.0 / 0.0",s="min"):"max"===e&&(a="-1.0 / 0.0",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,h="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",p="vec4";"all"===e?(a="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===e&&(a="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var f="";i%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+u+");\n      }\n    "},Za=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?i-1:i,n&&u>1?o-1:o],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=l[0]/c[0],p=l[1]/c[1],f=1/h,d=1/p,g=2*Math.ceil(f)+2,v=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Qa=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],a=t[2],s=t[3];this.outputShape=[i,e,n,s];var u=[r&&e>1?o-1:o,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},ts=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?i-1:i,n&&u>1?o-1:o],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=l[0]/c[0],p=l[1]/c[1],f=1/h,d=1/p,g=2*Math.ceil(f)+2,v=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},es=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],a=t[2],s=t[3];this.outputShape=[i,e,n,s];var u=[r&&e>1?o-1:o,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},ns=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map(function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),i=ko(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},rs=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=t.numSegments,a=o*Math.ceil(i/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, filter);\n    ",c="";i%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},is=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e=ko(this.rank),n=function(t){if(1===t)return"sourceLoc";if(2===t)return"sourceLoc.x, sourceLoc.y";if(3===t)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(4===t)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);this.userCode="\n      uniform "+e+" start;\n\n      void main() {\n        "+e+" sourceLoc = start + getOutputCoords();\n        setOutput(getSource("+n+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){if(null!=e.startLoc||(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null!=e.startLoc))if(1===e.rank)n.gl.uniform1i(e.startLoc,t[0]);else if(2===e.rank)n.gl.uniform2i(e.startLoc,t[0],t[1]);else if(3===e.rank)n.gl.uniform3i(e.startLoc,t[0],t[1],t[2]);else{if(4!==e.rank)throw Error("Slicing for rank "+e.rank+" is not yet supported");n.gl.uniform4i(e.startLoc,t[0],t[1],t[2],t[3])}}},t}();var os=function(t,e,n){this.variableNames=["x"],this.outputShape=n,this.rank=n.length;var r,i=ko(this.rank);r=1===this.rank?"coords * strides + begin":n.map(function(t,e){return"coords["+e+"] * strides["+e+"] + begin["+e+"]"}).join(","),this.userCode="\n      "+i+" begin = "+i+"("+t+");\n      "+i+" strides = "+i+"("+e+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "},as=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e){var n,r=ss(e),i=us(t,r);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[i].shift();return this.usedTextures[i].push(o),o}return this.numUsedTextures++,this.log(),r===To.FLOAT32?n=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===To.FLOAT16?n=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===To.UNSIGNED_BYTE&&(n=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(n),n},t.prototype.releaseTexture=function(t,e,n){var r=us(e,ss(n));r in this.freeTextures||(this.freeTextures[r]=[]),this.freeTextures[r].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[r],o=i.indexOf(t);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(o,1),this.log()},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function ss(t){if(t===No.DOWNLOAD||t===No.PIXELS)return To.UNSIGNED_BYTE;if(t===No.UPLOAD)return To.FLOAT32;if(t===No.RENDER)return bt.get("WEBGL_RENDER_FLOAT32_ENABLED")?To.FLOAT32:To.FLOAT16;throw new Error("Unknown logical texture type "+t)}function us(t,e){return t[0]+"_"+t[1]+"_"+e}var ls=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var i=ko(this.rank),o=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<t.length;i++)r.push("imod("+n[i]+", "+t[i]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "};var cs=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var i=ko(this.rank),o=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),i=0;i<t.length;i++)r[t[i]]=n[i];return r.join()}(e);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "};var hs=function(){function t(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float NAN;\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(){var t=this;return function(e,n){null==t.startLoc&&(t.startLoc=e.getUniformLocationNoThrow(n,"NAN"),null==t.startLoc)||e.gl.uniform1f(t.startLoc,NaN)}},t}(),ps="if (isNaN(x)) return x;",fs=ps+"\n  return (x < 0.0) ? 0.0 : x;\n";var ds=ps+"\n  return sin(x);\n",gs=ps+"\n  return cos(x);\n",vs=ps+"\n  return atan(x);\n",ms=ps+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",ys=ps+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",bs=300,ws=function(){function t(t,e){if(void 0===e&&(e=!0),this.gpgpu=t,this.delayedStorage=e,this.texData=new WeakMap,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,bt.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");bt.get("IS_BROWSER")&&(this.canvas=document.createElement("canvas")),null==t?(this.gpgpu=new Wa(xa(this.canvas)),this.gpgpuCreatedLocally=!0):this.gpgpuCreatedLocally=!1,this.NUM_BYTES_BEFORE_PAGING=window.screen.height*window.screen.width*window.devicePixelRatio*bs,this.textureManager=new as(this.gpgpu)}return t.prototype.register=function(t,e,n){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:e,dtype:n,values:null,texture:null,texShape:null,usage:No.RENDER})},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.fromPixels() can not be null");var n=[t.height,t.width],r=[t.height,t.width,e];if(!(t instanceof HTMLVideoElement||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(t instanceof HTMLVideoElement){if(null==this.fromPixelsCanvas){if(!bt.get("IS_BROWSER"))throw new Error("Can't read pixels from HTMLImageElement outside the browser.");if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixelsCanvas=document.createElement("canvas")}this.fromPixelsCanvas.width=t.width,this.fromPixelsCanvas.height=t.height,this.fromPixelsCanvas.getContext("2d").drawImage(t,0,0,t.width,t.height),t=this.fromPixelsCanvas}var i=$.make(n,{},"int32");this.texData.get(i.dataId).usage=No.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(i.dataId),t);var o=new zo(r),a=this.compileAndRun(o,[i]);return i.dispose(),a},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendWebGL.write(): values can not be null");this.throwIfNoData(t);var n=this.texData.get(t),r=n.texture,i=n.texShape,o=n.usage;null!=r&&(this.releaseTexture(t,r,i,o),n.texture=null,n.texShape=null),n.usage=No.UPLOAD,n.values=e,this.delayedStorage||this.uploadToGPU(t)},t.prototype.readSync=function(t){this.throwIfNoData(t);var e=this.texData.get(t),n=e.shape,r=e.texture,i=e.values,o=e.texShape,a=e.dtype;if(null!=i)return this.cacheOnCPU(t),i;var s,u,l=null!=this.activeTimers;if(l&&(s=performance.now()),bt.get("WEBGL_DOWNLOAD_FLOAT_ENABLED"))u=this.gpgpu.downloadFloat32MatrixFromOutputTexture(r,o[0],o[1]);else{var c=$.make(n,{});this.texData.get(c.dataId).usage=No.DOWNLOAD;var h=$.make(n,{dataId:t},a),p=new Do(n),f=this.compileAndRun(p,[h],c),d=this.texData.get(c.dataId);u=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture,d.texShape[0],d.texShape[1]),f.dispose(),h.dispose(),c.dispose()}return l&&(this.downloadWaitMs+=performance.now()-s),this.cacheOnCPU(t,u),e.values},t.prototype.read=function(t){return i(this,void 0,void 0,function(){var e,n,r,i,a,s,u,l;return o(this,function(o){switch(o.label){case 0:return this.pendingRead.has(t)?(e=this.pendingRead.get(t),[2,new Promise(function(t){return e.push(t)})]):(this.throwIfNoData(t),n=this.texData.get(t),r=n.texture,i=n.values,a=n.texShape,null!=i?(this.cacheOnCPU(t),[2,i]):bt.get("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED")?[4,this.gpgpu.downloadMatrixFromTextureAsync(r,a[0],a[1])]:[3,2]);case 1:return s=o.sent(),this.cacheOnCPU(t,s),[2,n.values];case 2:return 0===bt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?[2,this.readSync(t)]:(this.pendingRead.set(t,[]),[4,this.gpgpu.runQuery(function(){})]);case 3:return o.sent(),u=this.pendingRead.get(t),this.pendingRead.delete(t),l=this.readSync(t),u.forEach(function(t){return t(l)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)),[2,l]}})})},t.prototype.time=function(t){return i(this,void 0,void 0,function(){var e,n,r,i,a,s;return o(this,function(o){switch(o.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),i=f(this.activeTimers),this.activeTimers=e,r&&(this.programTimersStack=null),[4,Promise.all(i).then(function(t){var e=0;return t.forEach(function(t){return e+=t}),e})];case 1:return a=o.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:a,wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return bt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},t.prototype.endTimer=function(t){return bt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},t.prototype.getQueryTime=function(t){return i(this,void 0,void 0,function(){var e;return o(this,function(n){return bt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.pollQueryTime(t)]:[2,(e=t).endMs-e.startMs]})})},t.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t))if(this.pendingRead.has(t))this.pendingDisposal.add(t);else if(this.texData.has(t)){var e=this.texData.get(t),n=e.texture,r=e.texShape,i=e.usage;null!=n&&this.releaseTexture(t,n,r,i),this.texData.delete(t)}},t.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.getCanvas=function(){return this.canvas},t.prototype.slice=function(t,e,n){var r=new is(n),i=r.getCustomSetupFunc(e);return this.compileAndRun(r,[t],null,i)},t.prototype.stridedSlice=function(t,e,n,r,i,o){var a=Pe(t.shape,e,n,r,i,o),s=a[0],u=a[1];if(u.some(function(t){return 0===t}))return Ri([],u);var l=new os(s,r,u);return this.compileAndRun(l,[t])},t.prototype.reverse=function(t,e){var n=new ns(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.concat=function(t,e){var n=new ho(t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.neg=function(t){var e=new hs(t.shape,"return -x;");return this.compileAndRun(e,[t])},t.prototype.matMul=function(t,e,n,r){var i=new Ha(t.shape,e.shape,n,r);return this.compileAndRun(i,[t,e])},t.prototype.multiply=function(t,e){var n=new lo("return a * b;",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,Tt(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.batchNormalization=function(t,e,n,r,i,o){var a=[t,e,n],s=null;null!=o&&(s=o.shape,a.push(o));var u=null;null!=i&&(u=i.shape,a.push(i));var l=new uo(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(l,a)},t.prototype.localResponseNormalization4D=function(t,e,n,r,i){var o=new Ga(t.shape,e,n,r,i);return this.compileAndRun(o,[t])},t.prototype.tile=function(t,e){var n=new ls(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.pad=function(t,e,n){var r=new Xa(t.shape,e,n);return this.compileAndRun(r,[t])},t.prototype.transpose=function(t,e){var n=new cs(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.gather=function(t,e,n){var r=new Mo(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},t.prototype.reduce=function(t,e,n){var r=t.shape[0],i=t.shape[1],o=ro(i),a=new Ya({windowSize:o,inSize:i,batchSize:r},e),s=a.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],n);return this.compileAndRun(a,[t],c),1===c.shape[1]?c:this.reduce(c,e,n)},t.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],i=t.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var o=ro(i),a=new ao({windowSize:o,inSize:i,batchSize:r},e,null==n),s=a.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],"int32"),h=[t];return null!=n&&h.push(n),this.compileAndRun(a,h,c),1===c.shape[1]?c:this.argReduce(t,e,c)},t.prototype.sum=function(t,e){Ct("sum",e,t.rank);var n=St(t.shape,e),r=n[0],i=g(n[1]),o=t.as2D(-1,i),a=Dt(t.dtype);return this.reduce(o,"sum",a).reshape(r)},t.prototype.unsortedSegmentSum=function(t,e,n){var r=0,i=Rt([r],t.rank),o=t;null!=i&&(o=t.transpose(i),r=At(1,t.rank)[0]);var a=function(t,e,n){for(var r=[],i=t.length,o=0;o<i;o++)o!==e?r.push(t[o]):r.push(n);return r}(o.shape,r,n),s=g([o.shape[r]]),u=o.as2D(-1,s),l=Dt(t.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",e,l,n).reshape(a);return null!=i&&(c=c.transpose(It(i))),c},t.prototype.segOpCompute=function(t,e,n,r,i){var o=t.shape[0],a=t.shape[1],s=function(t,e){var n,r=!1;for(t<=no?(n=t,r=!0):n=z(t,Math.floor(Math.sqrt(t)));!r;){if(n>e||n===t){r=!0;break}n=z(t,n+1)}return n}(a,i),u=new rs({windowSize:s,inSize:a,batchSize:o,numSegments:i},e),l=u.outputShape,c=l[0],h=l[1],p=this.makeOutputArray([c,h],r);return this.compileAndRun(u,[t,n],p),p.shape[1]===i?p:(n=Ei(0,i).tile([a/s]),this.segOpCompute(p,e,n,r,i))},t.prototype.argMin=function(t,e){var n=[e];Ct("argMin",n,t.rank);var r=St(t.shape,n),i=r[0],o=g(r[1]),a=t.as2D(-1,o);return this.argReduce(a,"min").reshape(i)},t.prototype.argMax=function(t,e){var n=[e];Ct("argMax",n,t.rank);var r=St(t.shape,n),i=r[0],o=g(r[1]),a=t.as2D(-1,o);return this.argReduce(a,"max").reshape(i)},t.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var i=new Io(t.shape,n,r);return this.compileAndRun(i,[t])},t.prototype.equal=function(t,e){var n=new lo("return float(a == b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.notEqual=function(t,e){var n=new lo("return float(a != b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.less=function(t,e){var n=new lo("return float(a < b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.lessEqual=function(t,e){var n=new lo("return float(a <= b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greater=function(t,e){var n=new lo("return float(a > b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greaterEqual=function(t,e){var n=new lo("return float(a >= b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalNot=function(t){var e=new hs(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},t.prototype.logicalAnd=function(t,e){var n=new lo("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalOr=function(t,e){var n=new lo("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.where=function(t,e,n,r){var i=new qa(t.rank,e.shape,e.rank),o=this.makeOutputArray(i.outputShape,r);return this.compileAndRun(i,[t,e,n],o)},t.prototype.topKValues=function(t,e){throw new Error("topKValues GPU not yet implemented!")},t.prototype.topKIndices=function(t,e){throw new Error("topKIndices GPU not yet implemented!")},t.prototype.min=function(t,e){Ct("min",e,t.rank);var n=St(t.shape,e),r=n[0],i=g(n[1]),o=t.as2D(-1,i);return this.reduce(o,"min",o.dtype).reshape(r)},t.prototype.minimum=function(t,e){var n=new lo("\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.mod=function(t,e){var n=new lo("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t,e],null,r)},t.prototype.max=function(t,e){Ct("max",e,t.rank);var n=St(t.shape,e),r=n[0],i=g(n[1]),o=t.as2D(-1,i);return this.reduce(o,"max",o.dtype).reshape(r)},t.prototype.maximum=function(t,e){var n=new lo("\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.all=function(t,e){Ct("all",e,t.rank);var n=St(t.shape,e),r=n[0],i=g(n[1]),o=t.as2D(-1,i);return this.reduce(o,"all",o.dtype).reshape(r)},t.prototype.any=function(t,e){Ct("any",e,t.rank);var n=St(t.shape,e),r=n[0],i=g(n[1]),o=t.as2D(-1,i);return this.reduce(o,"any",o.dtype).reshape(r)},t.prototype.squaredDifference=function(t,e){var n=new lo("return (a - b) * (a - b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.realDivide=function(t,e){var n=new lo("if (a == b) return 1.0;\n  return a / b;",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t,e],r)},t.prototype.floorDiv=function(t,e){var n=new lo("\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[t,e],r)},t.prototype.add=function(t,e){var n=new lo("return a + b;",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,Tt(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.subtract=function(t,e){var n=new lo("return a - b;",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,Tt(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.pow=function(t,e){var n=new lo("\n  return (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,Tt(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.ceil=function(t){var e=new hs(t.shape,"return ceil(x);");return this.compileAndRun(e,[t])},t.prototype.floor=function(t){var e=new hs(t.shape,"return floor(x);");return this.compileAndRun(e,[t])},t.prototype.sign=function(t){var e=new hs(t.shape,"\n  if (isNaN(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},t.prototype.round=function(t){var e=new hs(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},t.prototype.exp=function(t){var e=new hs(t.shape,"return exp(x);");return this.compileAndRun(e,[t])},t.prototype.expm1=function(t){var e=new hs(t.shape,"return exp(x) - 1.0;");return this.compileAndRun(e,[t])},t.prototype.log=function(t){var e=new hs(t.shape,"if (x < 0.0) return NAN;\n  return log(x);"),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.log1p=function(t){var e=new hs(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},t.prototype.sqrt=function(t){var e=new hs(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},t.prototype.rsqrt=function(t){var e=new hs(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},t.prototype.square=function(t){var e=new hs(t.shape,"return x * x;");return this.compileAndRun(e,[t])},t.prototype.reciprocal=function(t){var e=new hs(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},t.prototype.relu=function(t){var e=new hs(t.shape,fs);return this.compileAndRun(e,[t])},t.prototype.elu=function(t){var e=new hs(t.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(e,[t])},t.prototype.eluDer=function(t,e){var n=new lo("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.selu=function(t){var e=new hs(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[t])},t.prototype.int=function(t){var e=new hs(t.shape,"return float(int(x));"),n=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[t],n)},t.prototype.clip=function(t,e,n){var r=new co(t.shape,e,n);return this.compileAndRun(r,[t])},t.prototype.abs=function(t){var e=new hs(t.shape,"return abs(x);");return this.compileAndRun(e,[t])},t.prototype.sigmoid=function(t){var e=new hs(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},t.prototype.softplus=function(t){var e=new hs(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},t.prototype.sin=function(t){var e=new hs(t.shape,ds);return this.compileAndRun(e,[t])},t.prototype.cos=function(t){var e=new hs(t.shape,gs);return this.compileAndRun(e,[t])},t.prototype.tan=function(t){var e=new hs(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},t.prototype.asin=function(t){var e=new hs(t.shape,"return asin(x);");return this.compileAndRun(e,[t])},t.prototype.acos=function(t){var e=new hs(t.shape,"return acos(x);");return this.compileAndRun(e,[t])},t.prototype.atan=function(t){var e=new hs(t.shape,vs);return this.compileAndRun(e,[t])},t.prototype.atan2=function(t,e){var n=new lo("\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.sinh=function(t){var e=new hs(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},t.prototype.cosh=function(t){var e=new hs(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},t.prototype.tanh=function(t){var e=new hs(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},t.prototype.asinh=function(t){var e=new hs(t.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])},t.prototype.acosh=function(t){var e=new hs(t.shape,ms),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.atanh=function(t){var e=new hs(t.shape,ys),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.erf=function(t){var e=new hs(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n');return this.compileAndRun(e,[t])},t.prototype.step=function(t,e){var n=new hs(t.shape,function(t){return void 0===t&&(t=0),ps+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(n,[t])},t.prototype.conv2d=function(t,e,n){var r=new mo(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerInput=function(t,e,n){var r=new fo(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerFilter=function(t,e,n){var r=new po(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2D=function(t,e,n){var r=new yo(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new vo(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new go(n);return this.compileAndRun(r,[t,e])},t.prototype.maxPool=function(t,e){var n=new Ja(e,"max",!1),r=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[t],r)},t.prototype.avgPool=function(t,e){var n=new Ja(e,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t],r)},t.prototype.maxPoolBackprop=function(t,e,n,r){var i=new Ja(r,"max",!0),o=this.compileAndRun(i,[e]),a=new ja(r),s=this.makeOutputArray(a.outputShape,e.dtype),u=this.compileAndRun(a,[t,o],s);return o.dispose(),u},t.prototype.avgPoolBackprop=function(t,e,n){var r=new so(n),i=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[t],i)},t.prototype.cast=function(t,e){return io(t,e,this)},t.prototype.reshape=function(t,e){return oo(t,e)},t.prototype.resizeBilinear=function(t,e,n,r){var i=new Qa(t.shape,e,n,r);return this.compileAndRun(i,[t])},t.prototype.resizeBilinearBackprop=function(t,e,n){var r=new Za(t,e,n);return this.compileAndRun(r,[t])},t.prototype.resizeNearestNeighbor=function(t,e,n,r){var i=new es(t.shape,e,n,r);return this.compileAndRun(i,[t])},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new ts(t,e,n);return this.compileAndRun(r,[t])},t.prototype.multinomial=function(t,e,n,r){var i=e?t:Xi(t),o=i.shape[0],a=i.shape[1],s=new $a(o,a,n),u=this.makeOutputArray(s.outputShape,"int32"),l=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],u,l)},t.prototype.oneHot=function(t,e,n,r){var i=new Ka(t.size,e,n,r);return this.compileAndRun(i,[t])},t.prototype.makeOutputArray=function(t,e){return $.make(t,{},e)},t.prototype.compileAndRun=function(t,e,n,r){var i=this;null==n&&(n=this.makeOutputArray(t.outputShape,e[0].dtype));var o=e.map(function(t){var e=i.texData.get(t.dataId);return null==e.texture&&t.size<=32?{tensor:t,texData:null,isUniform:!0}:(i.uploadToGPU(t.dataId),{tensor:t,texData:e,isUniform:!1})});this.uploadToGPU(n.dataId);var a,s={tensor:n,texData:this.texData.get(n.dataId),isUniform:!1},u=function(t,e,n){var r="";e.concat(n).forEach(function(t){r+=t.tensor.shape+"_"+(t.isUniform?"uniform":t.texData.texShape)});var i=t.userCode,o=(!0===t.supportsBroadcasting).toString();return t.constructor.name+"_"+o+"_"+r+"_"+i}(t,o,s),l=this.getAndSaveBinary(u,function(){return function(t,e,n,r){for(var i=e.userCode,o=n.map(function(t,n){var r={logicalShape:t.tensor.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform};return{name:e.variableNames[n],shapeInfo:r}}),a=o.map(function(t){return t.shapeInfo}),s={logicalShape:r.tensor.shape,texShape:r.texData.texShape,isUniform:!1},u=bo(o,s,i,!0===e.supportsBroadcasting),l=t.createProgram(u),c={},h=0;h<e.variableNames.length;h++){var p=e.variableNames[h];c[p]=t.getUniformLocation(l,p,!1)}return{program:e,source:u,webGLProgram:l,uniformLocations:c,gpgpu:t,inShapeInfos:a,outShapeInfo:s}}(i.gpgpu,t,o,s)}),c=null!=this.activeTimers;if(c&&(a=this.startTimer()),function(t,e,n,r){Va(t.inShapeInfos,e),Va([t.outShapeInfo],[n]);var i=n.texData.texture,o=n.texData.texShape,a=t.gpgpu;a.setOutputMatrixTexture(i,o[0],o[1]),a.setProgram(t.webGLProgram),e.forEach(function(e,n){var r=t.program.variableNames[n],i=t.uniformLocations[r];if(null!=i){if(e.isUniform){if(1===e.tensor.size)a.gl.uniform1f(i,e.tensor.dataSync()[0]);else{var o=e.tensor.dataSync();o instanceof Float32Array||(o=new Float32Array(o)),a.gl.uniform1fv(i,o)}return}var s=e.texData.texture;a.setInputMatrixTexture(s,i,n)}}),null!=r&&r(a,t.webGLProgram),a.executeProgram()}(l,o,s,r),this.numBytesInGPU>this.NUM_BYTES_BEFORE_PAGING)for(var h=this.numBytesInGPU-this.NUM_BYTES_BEFORE_PAGING;h>0;){var p=this.lruDataGPU.shift(),f=this.texData.get(p),d=f.shape,g=f.dtype;h-=this.computeBytes(d,g),this.read(p)}return c&&(a=this.endTimer(a),this.activeTimers.push(this.getQueryTime(a))),n},t.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){if(!this.disposed){for(var t in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixelsCanvas&&this.fromPixelsCanvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},t.prototype.throwIfNoData=function(t){if(!this.texData.has(t))throw new Error("WebGL backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},t.prototype.uploadToGPU=function(t){this.throwIfNoData(t);var e=this.texData.get(t),n=e.shape,r=e.values,i=e.texture,o=(e.dtype,e.usage);if(null!=i)return this.lruDataGPU.splice(this.lruDataGPU.indexOf(t),1),void this.lruDataGPU.push(t);var a,s=null!=this.activeTimers;s&&(a=performance.now());var u=ya(this.gpgpu.gl,n);e.texShape=u;var l=this.acquireTexture(t,u,o);e.texture=l,null!=r&&(this.gpgpu.uploadMatrixToTexture(l,u[0],u[1],function(t,e){return t instanceof Float32Array?t:new Float32Array(t)}(r)),e.values=null,s&&(this.uploadWaitMs+=performance.now()-a))},t.prototype.cacheOnCPU=function(t,e){var n=this.delayedStorage,r=this.texData.get(t),i=r.texture,o=r.texShape,a=r.dtype,s=r.usage;n&&null!=i&&(this.releaseTexture(t,i,o,s),r.texture=null,r.texShape=null),null!=e&&(r.values=function(t,e){if("float32"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,a))},t.prototype.releaseTexture=function(t,e,n,r){var i=this.texData.get(t),o=i.shape,a=i.dtype,s=this.lruDataGPU.indexOf(t);s>=0&&this.lruDataGPU.splice(s,1),this.numBytesInGPU-=this.computeBytes(o,a),this.textureManager.releaseTexture(e,n,r)},t.prototype.acquireTexture=function(t,e,n){var r=this.texData.get(t),i=r.shape,o=r.dtype;return this.lruDataGPU.push(t),this.numBytesInGPU+=this.computeBytes(i,o),this.textureManager.acquireTexture(e,n)},t.prototype.computeBytes=function(t,e){return g(t)*T(e)},t}();bt.get("IS_BROWSER")&&bt.registerBackend("webgl",function(){return new ws},2,H);var xs=function(){function t(){this.data=new WeakMap,this.firstUse=!0,bt.get("IS_BROWSER")&&(this.canvas=document.createElement("canvas"))}return t.prototype.register=function(t,e,n){if(this.firstUse&&(this.firstUse=!1,bt.get("IS_NODE")&&console.warn("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,null)},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.throwIfNoData(t),this.data.set(t,e)},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.fromPixels() can not be null");var n,r;if(bt.get("IS_NODE")&&null==t.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=t.getContext)n=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else if(t instanceof ImageData)n=t.data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(null==this.canvas)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.canvas.width=t.width,this.canvas.height=t.height,this.canvas.getContext("2d").drawImage(t,0,0,t.width,t.height),n=this.canvas.getContext("2d").getImageData(0,0,t.width,t.height).data}if(4===e)r=new Int32Array(n);else{var i=t.width*t.height;r=new Int32Array(i*e);for(var o=0;o<i;o++)for(var a=0;a<e;++a)r[o*e+a]=n[4*o+a]}var s=[t.height,t.width,e];return Ti(r,s,"int32")},t.prototype.read=function(t){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,this.readSync(t)]})})},t.prototype.readSync=function(t){return this.throwIfNoData(t),this.data.get(t)},t.prototype.disposeData=function(t){this.data.has(t)&&this.data.delete(t)},t.prototype.time=function(t){return i(this,void 0,void 0,function(){var e;return o(this,function(n){return e=performance.now(),t(),[2,{kernelMs:performance.now()-e}]})})},t.prototype.memory=function(){return{unreliable:!0}},t.prototype.throwIfNoData=function(t){if(!this.data.has(t))throw new Error("CPU backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},t.prototype.slice=function(t,e,n){for(var r=ki(n,t.dtype),i=0;i<r.size;++i){var o=r.indexToLoc(i),a=o.map(function(t,n){return t+e[n]});r.set.apply(r,[t.get.apply(t,a)].concat(o))}return r.toTensor()},t.prototype.stridedSlice=function(t,e,n,r,i,o){var a=Pe(t.shape,e,n,r,i,o),s=a[0],u=a[1];if(u.some(function(t){return 0===t}))return Ri([],u);for(var l=ki(u,t.dtype),c=0;c<l.size;c++){for(var h=l.indexToLoc(c),p=new Array(h.length),f=0;f<p.length;f++)p[f]=h[f]*r[f]+s[f];l.set.apply(l,[t.get.apply(t,p)].concat(h))}return l.toTensor()},t.prototype.reverse=function(t,e){for(var n=ki(t.shape,t.dtype),r=t.buffer(),i=function(i){var o=n.indexToLoc(i),a=o.slice();e.forEach(function(e){return a[e]=t.shape[e]-1-a[e]}),n.set.apply(n,[r.get.apply(r,a)].concat(o))},o=0;o<n.size;o++)i(o);return n.toTensor()},t.prototype.concat=function(t,e){var n=zt(t.shape,e.shape,1),r=ki(n,t.dtype);if(1===t.shape[0]&&1===e.shape[0]){var i=t.dataSync(),o=e.dataSync(),a=r.values;return a.set(i,0),a.set(o,t.size),r.toTensor()}for(var s=0;s<n[0];++s){for(var u=0;u<t.shape[1];++u)r.set(t.get(s,u),s,u);for(u=0;u<e.shape[1];++u)r.set(e.get(s,u),s,u+t.shape[1])}return r.toTensor()},t.prototype.neg=function(t){return this.multiply(Ii(-1),t)},t.prototype.add=function(t,e){return this.broadcastedBinaryOp(t,e,Tt(t.dtype,e.dtype),function(t,e){return t+e})},t.prototype.subtract=function(t,e){return this.broadcastedBinaryOp(t,e,Tt(t.dtype,e.dtype),function(t,e){return t-e})},t.prototype.pow=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},t.prototype.matMul=function(t,e,n,r){for(var i=n?t.shape[0]:t.shape[1],o=n?t.shape[1]:t.shape[0],a=r?e.shape[0]:e.shape[1],s=t.dataSync(),u=e.dataSync(),l=n?[1,t.strides[0]]:[t.strides[0],1],c=l[0],h=l[1],p=r?[e.strides[0],1]:[1,e.strides[0]],f=p[0],d=p[1],g=o*c,v=a*f,m=new Float32Array(o*a),y=0,b=0;b<g;b+=c)for(var w=0;w<v;w+=f){for(var x=b,S=w,E=0,k=0;k<i;++k)E+=s[x]*u[S],x+=h,S+=d;m[y++]=E}return Ni(m,[o,a])},t.prototype.multiply=function(t,e){return this.broadcastedBinaryOp(t,e,Tt(t.dtype,e.dtype),function(t,e){return t*e})},t.prototype.realDivide=function(t,e){return this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},t.prototype.floorDiv=function(t,e){return this.broadcastedBinaryOp(t,e,"int32",function(t,e){return Math.floor(t/e)})},t.prototype.sum=function(t,e){Ct("sum",e,t.rank);for(var n=St(t.shape,e),r=n[0],i=n[1],o=Tt(t.dtype,"int32"),a=li(r,o),s=g(i),u=a.dataSync(),l=t.dataSync(),c=0;c<u.length;++c){for(var h=c*s,p=0,f=0;f<s;++f)p+=l[h+f];u[c]=p}return a},t.prototype.unsortedSegmentSum=function(t,e,n){for(var r=[],i=t.rank-e.rank,o=0;o<i;++o)e=e.expandDims(o+1);for(o=0;o<n;++o){var a=Ii(o,"int32"),s=Fn(a,e).asType("float32").mul(t).sum(0);r.push(s)}return Fi(r)},t.prototype.argMin=function(t,e){var n=[e];Ct("argMin",n,t.rank);for(var r=St(t.shape,n),i=r[0],o=r[1],a=li(i,"int32"),s=g(o),u=a.dataSync(),l=t.dataSync(),c=0;c<u.length;++c){for(var h=c*s,p=l[h],f=0,d=0;d<s;++d){var v=l[h+d];v<p&&(p=v,f=d)}u[c]=f}return a},t.prototype.argMax=function(t,e){var n=[e];Ct("argMax",n,t.rank);for(var r=St(t.shape,n),i=r[0],o=r[1],a=li(i,"int32"),s=g(o),u=a.dataSync(),l=t.dataSync(),c=0;c<u.length;++c){for(var h=c*s,p=l[h],f=0,d=0;d<s;++d){var v=l[h+d];v>p&&(p=v,f=d)}u[c]=f}return a},t.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var i=Tt(t.dtype,"int32"),o=li(t.shape,i),a=o.dataSync(),s=t.dataSync(),u=t.shape[t.rank-1],l=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},c=0;c<s.length;c+=u)for(var h=0;h<u;h++){var p=l(c,h);if(0===h)a[p]=n?0:s[p];else{var f=l(c,h-1);a[p]=n?s[f]+a[f]:s[p]+a[f]}}return o},t.prototype.equal=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},t.prototype.notEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},t.prototype.less=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},t.prototype.lessEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},t.prototype.greater=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},t.prototype.greaterEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},t.prototype.logicalNot=function(t){for(var e=t.dataSync(),n=new Int32Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return $.make(t.shape,{values:n},"bool")},t.prototype.logicalAnd=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},t.prototype.logicalOr=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},t.prototype.where=function(t,e,n,r){for(var i=t.dataSync(),o=e.dataSync(),a=n.dataSync(),s=li(e.shape,r),u=s.dataSync(),l=0,c=0===t.rank||t.rank>1||1===e.rank?1:e.shape[1],h=0;h<i.length;h++)for(var p=0;p<c;p++)1===i[h]?u[l++]=o[h]:u[l++]=a[h];return s},t.prototype.topKValues=function(t,e){return this.topK(t,e).values},t.prototype.topKIndices=function(t,e){return this.topK(t,e).indices},t.prototype.topK=function(t,e){for(var n=t.dataSync(),r=[],i=0;i<n.length;i++)r.push({value:n[i],index:i});r.sort(function(t,e){return e.value-t.value});var o=C(t.dtype,e),a=new Int32Array(e);for(i=0;i<e;i++)o[i]=r[i].value,a[i]=r[i].index;return{values:Ai(o,t.dtype),indices:Ai(a,"int32")}},t.prototype.min=function(t,e){Ct("min",e,t.rank);for(var n=St(t.shape,e),r=n[0],i=n[1],o=li(r,t.dtype),a=g(i),s=o.dataSync(),u=t.dataSync(),l=0;l<s.length;++l){for(var c=l*a,h=u[c],p=0;p<a;++p){var f=u[c+p];f<h&&(h=f)}s[l]=h}return o},t.prototype.minimum=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},t.prototype.mod=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})},t.prototype.max=function(t,e){Ct("max",e,t.rank);for(var n=St(t.shape,e),r=n[0],i=n[1],o=li(r,t.dtype),a=g(i),s=o.dataSync(),u=t.dataSync(),l=0;l<s.length;++l){for(var c=l*a,h=u[c],p=0;p<a;++p){var f=u[c+p];f>h&&(h=f)}s[l]=h}return o},t.prototype.maximum=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},t.prototype.all=function(t,e){Ct("all",e,t.rank);for(var n=St(t.shape,e),r=n[0],i=n[1],o=li(r,t.dtype),a=g(i),s=o.dataSync(),u=t.dataSync(),l=0;l<s.length;++l){for(var c=l*a,h=u[c],p=0;p<a;++p){var f=u[c+p];h=h&&f}s[l]=h}return o},t.prototype.any=function(t,e){Ct("any",e,t.rank);for(var n=St(t.shape,e),r=n[0],i=n[1],o=li(r,t.dtype),a=g(i),s=o.dataSync(),u=t.dataSync(),l=0;l<s.length;++l){for(var c=l*a,h=u[c],p=0;p<a;++p){var f=u[c+p];h=h||f}s[l]=h}return o},t.prototype.squaredDifference=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t-e;return n*n})},t.prototype.ceil=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return $.make(t.shape,{values:n})},t.prototype.floor=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return $.make(t.shape,{values:n})},t.prototype.sign=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)e[r]<0?n[r]=-1:e[r]>0?n[r]=1:n[r]=0;return $.make(t.shape,{values:n})},t.prototype.round=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=Math.floor(e[r]);e[r]-i<.5?n[r]=Math.floor(e[r]):e[r]-i>.5?n[r]=Math.ceil(e[r]):n[r]=i%2==0?i:i+1}return $.make(t.shape,{values:n})},t.prototype.exp=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return $.make(t.shape,{values:n})},t.prototype.expm1=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return $.make(t.shape,{values:n})},t.prototype.log=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.log(i)}return $.make(t.shape,{values:n})},t.prototype.log1p=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.log1p(i)}return $.make(t.shape,{values:n})},t.prototype.sqrt=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.sqrt(i)}return $.make(t.shape,{values:n})},t.prototype.rsqrt=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=1/Math.sqrt(i)}return $.make(t.shape,{values:n})},t.prototype.square=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=i*i}return $.make(t.shape,{values:n})},t.prototype.reciprocal=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return $.make(t.shape,{values:n})},t.prototype.relu=function(t){for(var e=li(t.shape,t.dtype),n=e.dataSync(),r=t.dataSync(),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return e},t.prototype.elu=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var i=n[r];e[r]=i>=0?i:Math.exp(i)-1}return $.make(t.shape,{values:e})},t.prototype.eluDer=function(t,e){for(var n=new Float32Array(e.size),r=e.dataSync(),i=t.dataSync(),o=0;o<r.length;++o){var a=r[o];n[o]=a>=1?i[o]:i[o]*(a+1)}return $.make(e.shape,{values:n})},t.prototype.selu=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var i=n[r];e[r]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return $.make(t.shape,{values:e})},t.prototype.clip=function(t,e,n){for(var r=new Float32Array(t.size),i=t.dataSync(),o=0;o<i.length;++o)r[o]=Math.min(n,Math.max(e,i[o]));return $.make(t.shape,{values:r})},t.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return $.make(t.shape,{values:e})},t.prototype.int=function(t){for(var e=new Int32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=n[r];return $.make(t.shape,{values:e},"int32")},t.prototype.sigmoid=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return $.make(t.shape,{values:e})},t.prototype.softplus=function(t){for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=t.dataSync(),i=0;i<r.length;++i){var o,a=r[i]>-e,s=r[i]<e,u=Math.exp(r[i]);o=s?u:a?r[i]:Math.log(1+u),n[i]=o}return $.make(t.shape,{values:n})},t.prototype.sin=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return $.make(t.shape,{values:e})},t.prototype.cos=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return $.make(t.shape,{values:e})},t.prototype.tan=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return $.make(t.shape,{values:e})},t.prototype.asin=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return $.make(t.shape,{values:e})},t.prototype.acos=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return $.make(t.shape,{values:e})},t.prototype.atan=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return $.make(t.shape,{values:e})},t.prototype.atan2=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},t.prototype.sinh=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return $.make(t.shape,{values:e})},t.prototype.cosh=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return $.make(t.shape,{values:e})},t.prototype.tanh=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=y(n[r]);return $.make(t.shape,{values:e})},t.prototype.asinh=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return $.make(t.shape,{values:e})},t.prototype.acosh=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return $.make(t.shape,{values:e})},t.prototype.atanh=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return $.make(t.shape,{values:e})},t.prototype.erf=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var i=n[r],o=1/(1+.3275911*i);e[r]=1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-i*i)}return $.make(t.shape,{values:e})},t.prototype.step=function(t,e){void 0===e&&(e=0);for(var n=new Float32Array(t.size),r=t.dataSync(),i=0;i<r.length;++i){var o=r[i];isNaN(o)?n[i]=NaN:n[i]=o>0?1:e}return $.make(t.shape,{values:n})},t.prototype.conv2d=function(t,e,n){for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=ki(n.outShape,t.dtype),c=0;c<n.batchSize;++c)for(var h=0;h<n.outChannels;++h)for(var p=0;p<n.outHeight;++p)for(var f=p*n.strideHeight-s,d=0;d<n.outWidth;++d){for(var g=d*n.strideWidth-u,v=0,m=0;m<r;m++){var y=f+m*o;if(!(y<0||y>=n.inHeight))for(var b=0;b<i;b++){var w=g+b*a;if(!(w<0||w>=n.inWidth))for(var x=0;x<n.inChannels;++x)v+=t.get(c,y,w,x)*e.get(m,b,x,h)}}l.set(v,c,p,d,h)}return l.toTensor()},t.prototype.conv2dDerInput=function(t,e,n){for(var r=ki(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],l=t.dataSync(),c=t.strides,h=c[0],p=c[1],f=c[2],d=e.dataSync(),g=e.strides,v=g[0],m=g[1],y=g[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,S=n.inChannels,E=n.inHeight,k=n.inWidth,C=n.outChannels,R=n.outHeight,I=n.outWidth,A=n.strideHeight,N=n.strideWidth,T=w-1-n.padInfo.top,D=x-1-n.padInfo.left,z=0;z<b;++z)for(var M=0;M<S;++M)for(var O=0;O<E;++O)for(var L=O-T,F=Math.max(0,Math.ceil(L/A)),_=Math.min(R,(w+L)/A),B=0;B<k;++B){for(var P=B-D,U=Math.max(0,Math.ceil(P/N)),W=Math.min(I,(x+P)/N),V=0,q=F;q<_;++q)for(var G=q*A-L,j=U;j<W;++j)for(var H=h*z+p*q+f*j,$=v*(w-1-G)+m*(x-1-(j*N-P))+y*M,K=0;K<C;++K)V+=l[H+K]*d[$+K];i[a*z+s*O+u*B+M]=V}return r.toTensor()},t.prototype.conv2dDerFilter=function(t,e,n){for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=ki(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=0;c<o;++c)for(var h=Math.max(0,Math.ceil((l-c)/r)),p=Math.min(n.outHeight,(n.inHeight+l-c)/r),f=0;f<a;++f)for(var d=Math.max(0,Math.ceil((u-f)/i)),g=Math.min(n.outWidth,(n.inWidth+u-f)/i),v=0;v<n.inChannels;++v)for(var m=0;m<n.outChannels;++m){for(var y=0,b=0;b<n.batchSize;++b)for(var w=h;w<p;++w)for(var x=c+w*r-l,S=d;S<g;++S){var E=f+S*i-u;y+=t.get(b,x,E,v)*e.get(b,w,S,m)}s.set(y,c,f,v,m)}return s.toTensor()},t.prototype.depthwiseConv2D=function(t,e,n){for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=ki(n.outShape,t.dtype),h=0;h<n.batchSize;++h)for(var p=0;p<n.inChannels;++p)for(var f=0;f<n.outHeight;++f)for(var d=f*n.strideHeight-s,g=0;g<n.outWidth;++g)for(var v=g*n.strideWidth-u,m=0;m<l;++m){for(var y=0,b=0;b<r;++b){var w=d+b*o;if(!(w<0||w>=n.inHeight))for(var x=0;x<i;++x){var S=v+x*a;S<0||S>=n.inWidth||(y+=t.get(h,w,S,p)*e.get(b,x,p,m))}}c.set(y,h,f,g,p*l+m)}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(t,e,n){for(var r=ki(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],l=t.dataSync(),c=t.strides,h=c[0],p=c[1],f=c[2],d=e.dataSync(),g=e.strides,v=g[0],m=g[1],y=g[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,S=n.inChannels,E=n.inHeight,k=n.inWidth,C=n.outChannels,R=n.outHeight,I=n.outWidth,A=n.strideHeight,N=n.strideWidth,T=w-1-n.padInfo.top,D=x-1-n.padInfo.left,z=C/S,M=0;M<b;++M)for(var O=0;O<S;++O)for(var L=0;L<E;++L)for(var F=L-T,_=Math.max(0,Math.ceil(F/A)),B=Math.min(R,(w+F)/A),P=0;P<k;++P){for(var U=P-D,W=Math.max(0,Math.ceil(U/N)),V=Math.min(I,(x+U)/N),q=0,G=_;G<B;++G)for(var j=G*A-F,H=W;H<V;++H)for(var $=h*M+p*G+f*H,K=v*(w-1-j)+m*(x-1-(H*N-U))+y*O,X=0;X<z;++X)q+=l[$+(O*z+X)]*d[K+X];i[a*M+s*L+u*P+O]=q}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=ki(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,h=0;h<o;++h)for(var p=Math.max(0,Math.ceil((l-h)/r)),f=Math.min(n.outHeight,(n.inHeight+l-h)/r),d=0;d<a;++d)for(var g=Math.max(0,Math.ceil((u-d)/i)),v=Math.min(n.outWidth,(n.inWidth+u-d)/i),m=0;m<n.outChannels;++m){for(var y=Math.trunc(m/c),b=m%c,w=0,x=0;x<n.batchSize;++x)for(var S=p;S<f;++S)for(var E=h+S*r-l,k=g;k<v;++k){var C=d+k*i-u;w+=t.get(x,E,C,y)*e.get(x,S,k,m)}s.set(w,h,d,y,b)}return s.toTensor()},t.prototype.tile=function(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var i=ki(n,t.dtype),o=t.buffer();for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),s=new Array(t.rank),u=0;u<s.length;u++)s[u]=a[u]%t.shape[u];var l=o.locToIndex(s);i.values[r]=o.values[l]}return i.toTensor()},t.prototype.pad=function(t,e,n){var r=e.map(function(e,n){return e[0]+t.shape[n]+e[1]}),i=e.map(function(t){return t[0]}),o=t.buffer(),a=ki(r,t.dtype);0!==n&&a.values.fill(n);for(var s=0;s<t.size;s++){var u=o.indexToLoc(s),l=u.map(function(t,e){return t+i[e]});a.set.apply(a,[t.get.apply(t,u)].concat(l))}return a.toTensor()},t.prototype.transpose=function(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var i=t.dataSync(),o=ki(n,t.dtype),a=t.buffer();for(r=0;r<t.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[e[l]];var c=o.locToIndex(u);o.values[c]=i[r]}return o.toTensor()},t.prototype.gather=function(t,e,n){var r=t.shape.slice(),i=e.dataSync();r[n]=i.length;for(var o=ki(r,t.dtype),a=t.buffer(),s=0;s<o.size;++s){var u=o.indexToLoc(s),l=u.slice();l[n]=i[u[n]];var c=a.locToIndex(l);o.values[s]=a.values[c]}return o.toTensor()},t.prototype.pool=function(t,e,n){for(var r=e.strideHeight,i=e.strideWidth,o=e.filterHeight,a=e.filterWidth,s=ki(e.outShape,"float32"),u=e.padInfo.top,l=e.padInfo.left,c=0;c<e.batchSize;++c)for(var h=0;h<e.inChannels;++h)for(var p=0;p<e.outHeight;++p)for(var f=p*r-u,d=Math.max(0,f),g=Math.min(e.inHeight,o+f),v=0;v<e.outWidth;++v){for(var m=v*i-l,y=Math.max(0,m),b=Math.min(e.inWidth,a+m),w="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=0,S=0,E=d;E<g;++E){for(var k=y;k<b;++k){var C=t.get(c,E,k,h);"max"===n&&C>w?w=C:"avg"===n&&(x+=C,S++)}if(isNaN(w))break}s.set("avg"===n?x/S:w,c,p,v,h)}return s.toTensor()},t.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},t.prototype.maxPoolPositions=function(t,e){for(var n=ki(e.outShape,"int32"),r=e.strideHeight,i=e.strideWidth,o=e.filterHeight,a=e.filterWidth,s=e.padInfo.top,u=e.padInfo.left,l=0;l<e.batchSize;++l)for(var c=0;c<e.inChannels;++c)for(var h=0;h<e.outHeight;++h)for(var p=h*r-s,f=Math.max(0,p),d=Math.min(e.inHeight,o+p),g=0;g<e.outWidth;++g){for(var v=g*i-u,m=Math.max(0,v),y=Math.min(e.inWidth,a+v),b=Number.NEGATIVE_INFINITY,w=-1,x=f;x<d;++x)for(var S=x-p,E=m;E<y;++E){var k=E-v,C=t.get(l,x,E,c);C>b&&(b=C,w=S*a+k)}n.set(w,l,h,g,c)}return n.toTensor()},t.prototype.maxPoolBackprop=function(t,e,n,r){for(var i=this.maxPoolPositions(e,r),o=r.strideHeight,a=r.strideWidth,s=r.filterHeight,u=r.filterWidth,l=u-1-r.padInfo.left,c=s-1-r.padInfo.top,h=ki(e.shape,"float32"),p=0;p<r.batchSize;++p)for(var f=0;f<r.inChannels;++f)for(var d=0;d<r.inHeight;++d)for(var g=0;g<r.inWidth;++g){for(var v=d-c,m=g-l,y=0,b=0;b<s;++b){var w=(v+b)/o;if(!(w<0||w>=r.outHeight||Math.floor(w)!==w))for(var x=0;x<u;++x){var S=(m+x)/a;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var E=s*u-1-i.get(p,w,S,f)===b*u+x?1:0;0!==E&&(y+=t.get(p,w,S,f)*E)}}}h.set(y,p,d,g,f)}return h.toTensor()},t.prototype.avgPoolBackprop=function(t,e,n){for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=a-1-n.padInfo.left,u=o-1-n.padInfo.top,l=ki(e.shape,"float32"),c=1/(o*a),h=0;h<n.batchSize;++h)for(var p=0;p<n.inChannels;++p)for(var f=0;f<n.inHeight;++f)for(var d=0;d<n.inWidth;++d){for(var g=f-u,v=d-s,m=0,y=0;y<o;++y){var b=(g+y)/r;if(!(b<0||b>=n.outHeight||Math.floor(b)!==b))for(var w=0;w<a;++w){var x=(v+w)/i;x<0||x>=n.outWidth||Math.floor(x)!==x||(m+=t.get(h,b,x,p))}}l.set(m*c,h,f,d,p)}return l.toTensor()},t.prototype.cast=function(t,e){return io(t,e,this)},t.prototype.reshape=function(t,e){return oo(t,e)},t.prototype.avgPool=function(t,e){return this.pool(t,e,"avg").toFloat()},t.prototype.resizeBilinear=function(t,e,n,r){for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=ki([o,e,n,u],t.dtype),c=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],p=0;p<o;p++)for(var f=0;f<e;f++)for(var d=0;d<n;d++)for(var g=0;g<u;g++){var v=c[0]*f/h[0],m=c[1]*d/h[1],y=Math.floor(v),b=Math.min(a-1,Math.ceil(v)),w=Math.floor(m),x=Math.min(s-1,Math.ceil(m)),S=t.get(p,y,w,g),E=t.get(p,b,w,g),k=m-w,C=S+(t.get(p,y,x,g)-S)*k,R=C+(E+(t.get(p,b,x,g)-E)*k-C)*(v-y);l.set(R,p,f,d,g)}return l.toTensor()},t.prototype.resizeBilinearBackprop=function(t,e,n){for(var r=e.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=t.shape,l=u[1],c=u[2],h=ki([i,o,a,s],e.dtype),p=[n&&l>1?o-1:o,n&&c>1?a-1:a],f=[n&&l>1?l-1:l,n&&c>1?c-1:c],d=p[0]/f[0],g=p[1]/f[1],v=0;v<i;v++)for(var m=0;m<l;m++)for(var y=m*d,b=Math.floor(y),w=Math.min(Math.ceil(y),o-1),x=y-b,S=1-x,E=0;E<c;E++)for(var k=E*g,C=Math.floor(k),R=Math.min(Math.ceil(k),a-1),I=k-C,A=1-I,N=0;N<s;N++){var T=t.get(v,m,E,N),D=h.get(v,b,C,N);D+=T*S*A,h.set(D,v,b,C,N);var z=h.get(v,b,R,N);z+=T*S*I,h.set(z,v,b,R,N);var M=h.get(v,w,C,N);M+=T*x*A,h.set(M,v,w,C,N);var O=h.get(v,w,R,N);O+=T*x*I,h.set(O,v,w,R,N)}return h.toTensor()},t.prototype.resizeNearestNeighbor=function(t,e,n,r){for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=ki([o,e,n,u],t.dtype),c=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],p=0;p<o;p++)for(var f=0;f<e;f++)for(var d=0;d<n;d++)for(var g=0;g<u;g++){var v=c[0]*f/h[0],m=c[1]*d/h[1],y=Math.min(a-1,r?Math.round(v):Math.floor(v)),b=Math.min(s-1,r?Math.round(m):Math.floor(m)),w=t.get(p,y,b,g);l.set(w,p,f,d,g)}return l.toTensor()},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){for(var r=e.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=t.shape,l=u[1],c=u[2],h=ki([i,o,a,s],e.dtype),p=[n&&l>1?o-1:o,n&&c>1?a-1:a],f=[n&&l>1?l-1:l,n&&c>1?c-1:c],d=1/(p[0]/f[0]),g=1/(p[1]/f[1]),v=2*Math.ceil(d)+2,m=2*Math.ceil(g)+2,y=0;y<i;y++)for(var b=0;b<o;b++)for(var w=0;w<a;w++)for(var x=Math.floor(b*d),S=Math.floor(x-v/2),E=Math.floor(w*g),k=Math.floor(E-m/2),C=0;C<s;C++){for(var R=0,I=0;I<v;I++){var A=I+S;if(!(A<0||A>=l))for(var N=0;N<m;N++){var T=N+k;if(!(T<0||T>=c)){var D=p[0]*(A/f[0]),z=p[1]*(T/f[1]),M=Math.min(o-1,n?Math.round(D):Math.floor(D)),O=Math.min(a-1,n?Math.round(z):Math.floor(z));b===M&&w===O&&(R+=t.get(y,A,T,C))}}}h.set(R,y,b,w,C)}return h.toTensor()},t.prototype.batchNormalization=function(t,e,n,r,i,o){for(var a=t.dataSync(),s=e.dataSync(),u=n.dataSync(),l=i?i.dataSync():new Float32Array([1]),c=o?o.dataSync():new Float32Array([0]),h=new Float32Array(a.length),p=0;p<a.length;p++)h[p]=c[p%c.length]+(a[p]-s[p%s.length])*l[p%l.length]/Math.sqrt(u[p%u.length]+r);return Di(h,t.shape)},t.prototype.localResponseNormalization4D=function(t,e,n,r,i){var o=ki(t.shape,"float32"),a=e,s=o.shape[3]-1;function u(e,n,r,i){for(var o=0,u=Math.max(0,i-a);u<=Math.min(i+a,s);u++){var l=t.get(e,n,r,u);o+=l*l}return o}for(var l=0;l<o.shape[0];l++)for(var c=0;c<=o.shape[1];c++)for(var h=0;h<o.shape[2];h++)for(var p=0;p<o.shape[3];p++){var f=u(l,c,h,p),d=t.get(l,c,h,p)*Math.pow(n+r*f,-i);o.set(d,l,c,h,p)}return o.toTensor()},t.prototype.multinomial=function(t,e,n,r){for(var i=e?t:Xi(t),o=i.shape[0],a=i.shape[1],s=li([o,n],"int32"),u=s.dataSync(),l=i.dataSync(),c=0;c<o;++c){var h=c*a,p=new Float32Array(a-1);p[0]=l[h];for(var f=1;f<p.length;++f)p[f]=p[f-1]+l[h+f];for(var d=Gt(r.toString()),g=c*n,v=0;v<n;++v){var m=d();u[g+v]=p.length;for(var y=0;y<p.length;y++)if(m<p[y]){u[g+v]=y;break}}}return s},t.prototype.oneHot=function(t,e,n,r){var i=new Float32Array(t.size*e);i.fill(r);for(var o=0;o<t.size;++o)t.get(o)>=0&&t.get(o)<e&&(i[o*e+t.get(o)]=n);return Ni(i,[t.size,e],"int32")},t.prototype.broadcastedBinaryOp=function(t,e,n,r){for(var i=Xt(t.shape,e.shape),o=ki(i,n),a=t.dataSync(),s=e.dataSync(),u=$t(t.shape,i),l=$t(e.shape,i),c=t.buffer(),h=e.buffer(),p=function(n){var i=o.indexToLoc(n),p=i.slice(-t.rank);u.forEach(function(t){return p[t]=0});var f=c.locToIndex(p),d=i.slice(-e.rank);l.forEach(function(t){return d[t]=0});var g=h.locToIndex(d);o.values[n]=r(a[f],s[g])},f=0;f<o.values.length;++f)p(f);return o.toTensor()},t.prototype.dispose=function(){},t}();bt.registerBackend("cpu",function(){return new xs},1,H);var Ss=function(){function t(){}return t.nextFrame=function(){return new Promise(function(t){return requestAnimationFrame(function(){return t()})})},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"nextFrame",null),t}(),Es={float32:4,int32:4,uint16:2,uint8:1,bool:1};function ks(t){return new Blob([t]).size}function Cs(t){var e=0;t.forEach(function(t){e+=t.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(t){n.set(new Uint8Array(t),r),r+=t.byteLength}),n.buffer}function Rs(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function Is(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:ks(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:ks(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var As=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e){return t.getHandlers(e,"load")},t.getHandlers=function(t,e){var n=[];return("load"===e?this.getInstance().loadRouters:this.getInstance().saveRouters).forEach(function(e){var r=e(t);null!==r&&n.push(r)}),n},t}(),Ns="://",Ts=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){c(null!=e,"scheme must not be undefined or null."),e.endsWith(Ns)&&(e=e.slice(0,e.indexOf(Ns))),c(e.length>0,"scheme must not be an empty string.");var r=t.getInstance();c(null==r.managers[e],"A model store manager is already registered for scheme '"+e+"'."),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function Ds(t){if(-1===t.indexOf(Ns))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ts.getSchemes().join(","));return{scheme:t.split(Ns)[0],path:t.split(Ns)[1]}}function zs(t,e,n){return void 0===n&&(n=!1),i(this,void 0,void 0,function(){var r,i,a,s,u,l,h,p,f;return o(this,function(o){switch(o.label){case 0:return c(t!==e,"Old path and new path are the same: '"+t+"'"),c((r=As.getLoadHandlers(t)).length>0,"Copying failed because no load handler is found for source URL "+t+"."),c(r.length<2,"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."),i=r[0],c((a=As.getSaveHandlers(e)).length>0,"Copying failed because no save handler is found for destination URL "+e+"."),c(a.length<2,"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."),s=a[0],u=Ds(t).scheme,l=Ds(t).path,h=u===Ds(t).scheme,[4,i.load()];case 1:return p=o.sent(),n&&h?[4,Ts.getManager(u).removeModel(l)]:[3,3];case 2:o.sent(),o.label=3;case 3:return[4,s.save(p)];case 4:return f=o.sent(),!n||h?[3,6]:[4,Ts.getManager(u).removeModel(l)];case 5:o.sent(),o.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}var Ms=function(){function t(){}return t.listModels=function(){return i(this,void 0,void 0,function(){var t,e,n,r,i,a,s;return o(this,function(o){switch(o.label){case 0:t=Ts.getSchemes(),e={},n=0,r=t,o.label=1;case 1:return n<r.length?(i=r[n],[4,Ts.getManager(i).listModels()]):[3,4];case 2:for(s in a=o.sent())e[i+Ns+s]=a[s];o.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},t.removeModel=function(t){return i(this,void 0,void 0,function(){var e;return o(this,function(n){switch(n.label){case 0:return e=Ds(t),[4,Ts.getManager(e.scheme).removeModel(e.path)];case 1:return[2,n.sent()]}})})},t.copyModel=function(t,e){return i(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,zs(t,e,!1)];case 1:return[2,n.sent()]}})})},t.moveModel=function(t,e){return i(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,zs(t,e,!0)];case 1:return[2,n.sent()]}})})},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"listModels",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"removeModel",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"copyModel",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"moveModel",null),t}(),Os="models_store",Ls="model_info_store";function Fs(){if(!bt.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function _s(t){var e=t.result;e.createObjectStore(Os,{keyPath:"modelPath"}),e.createObjectStore(Ls,{keyPath:"modelPath"})}var Bs=function(){function t(t){if(this.indexedDB=Fs(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return i(this,void 0,void 0,function(){return o(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return i(this,void 0,void 0,function(){return o(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(t,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return _s(i)},i.onsuccess=function(){var o=i.result;if(null==e){var a=o.transaction(Os,"readonly"),s=a.objectStore(Os).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return o.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return o.close(),r(s.error)},a.oncomplete=function(){return o.close()}}else{var u,l=Is(e),c=o.transaction(Ls,"readwrite"),h=c.objectStore(Ls),p=h.put({modelPath:n.modelPath,modelArtifactsInfo:l});p.onsuccess=function(){var i=(u=o.transaction(Os,"readwrite")).objectStore(Os).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:l});i.onsuccess=function(){return t({modelArtifactsInfo:l})},i.onerror=function(t){var e=(h=c.objectStore(Ls)).delete(n.modelPath);e.onsuccess=function(){return o.close(),r(i.error)},e.onerror=function(t){return o.close(),r(i.error)}}},p.onerror=function(t){return o.close(),r(p.error)},c.oncomplete=function(){null==u?o.close():u.oncomplete=function(){return o.close()}}}},i.onerror=function(t){return r(i.error)}})},t.URL_SCHEME="indexeddb://",t}(),Ps=function(t){return bt.get("IS_BROWSER")&&t.startsWith(Bs.URL_SCHEME)?function(t){return new Bs(t)}(t.slice(Bs.URL_SCHEME.length)):null};As.registerSaveRouter(Ps),As.registerLoadRouter(Ps);var Us=function(){function t(){this.indexedDB=Fs()}return t.prototype.listModels=function(){return i(this,void 0,void 0,function(){var t=this;return o(this,function(e){return[2,new Promise(function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return _s(r)},r.onsuccess=function(){var t=r.result,i=t.transaction(Ls,"readonly"),o=i.objectStore(Ls).getAll();o.onsuccess=function(){for(var t={},n=0,r=o.result;n<r.length;n++){var i=r[n];t[i.modelPath]=i.modelArtifactsInfo}e(t)},o.onerror=function(e){return t.close(),n(o.error)},i.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}})]})})},t.prototype.removeModel=function(t){return i(this,void 0,void 0,function(){var e=this;return o(this,function(n){return t=function(t){return t.startsWith(Bs.URL_SCHEME)?t.slice(Bs.URL_SCHEME.length):t}(t),[2,new Promise(function(n,r){var i=e.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return _s(i)},i.onsuccess=function(){var e,o=i.result,a=o.transaction(Ls,"readwrite"),s=a.objectStore(Ls),u=s.get(t);u.onsuccess=function(){if(null==u.result)return o.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var i=s.delete(t),a=function(){var i=(e=o.transaction(Os,"readwrite")).objectStore(Os).delete(t);i.onsuccess=function(){return n(u.result.modelArtifactsInfo)},i.onerror=function(t){return r(u.error)}};i.onsuccess=a,i.onerror=function(t){return a(),o.close(),r(u.error)}},u.onerror=function(t){return o.close(),r(u.error)},a.oncomplete=function(){null==e?o.close():e.oncomplete=function(){return o.close()}}},i.onerror=function(t){return r(i.error)}})]})})},t}();if(bt.get("IS_BROWSER"))try{Ts.registerManager(Bs.URL_SCHEME,new Us)}catch(it){}var Ws="/",Vs="tensorflowjs_models",qs="info",Gs="model_topology",js="weight_specs",Hs="weight_data";function $s(t){return{info:[Vs,t,qs].join(Ws),topology:[Vs,t,Gs].join(Ws),weightSpecs:[Vs,t,js].join(Ws),weightData:[Vs,t,Hs].join(Ws)}}function Ks(t){var e=t.split(Ws);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(Ws)}var Xs=function(){function t(t){if(!bt.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=$s(this.modelPath)}return t.prototype.save=function(t){return i(this,void 0,void 0,function(){var e,n,r,i;return o(this,function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=Is(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){return btoa(String.fromCharCode.apply(null,new Uint8Array(t)))}(t.weightData)),[2,{modelArtifactsInfo:r}]}catch(t){for(i in this.keys)this.LS.removeItem(this.keys[i]);throw new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return i(this,void 0,void 0,function(){var t,e,n,r,i;return o(this,function(o){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null==(i=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){for(var e=atob(t),n=new Uint8Array(e.length),r=0;r<e.length;++r)n.set([e.charCodeAt(r)],r);return n.buffer}(i),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),Js=function(t){return bt.get("IS_BROWSER")&&t.startsWith(Xs.URL_SCHEME)?function(t){return new Xs(t)}(t.slice(Xs.URL_SCHEME.length)):null};As.registerSaveRouter(Js),As.registerLoadRouter(Js);var Ys=function(){function t(){c(bt.get("IS_BROWSER"),"Current environment is not a web browser"),c(void 0!==window.localStorage,"Current browser does not appear to support localStorage"),this.LS=window.localStorage}return t.prototype.listModels=function(){return i(this,void 0,void 0,function(){var t,e,n,r,i,a;return o(this,function(o){for(t={},e=Vs+Ws,n=Ws+qs,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(e)&&i.endsWith(n)&&(a=Ks(i),t[a]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},t.prototype.removeModel=function(t){return i(this,void 0,void 0,function(){var e,n;return o(this,function(r){if(t=function(t){return t.startsWith(Xs.URL_SCHEME)?t.slice(Xs.URL_SCHEME.length):t}(t),e=$s(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},t}();if(bt.get("IS_BROWSER"))try{Ts.registerManager(Xs.URL_SCHEME,new Ys)}catch(it){}var Zs="model",Qs=".json",tu=".weights.bin",eu=function(){function t(e){if(!bt.get("IS_BROWSER"))throw new Error("triggerDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e=Zs),this.modelTopologyFileName=e+Qs,this.weightDataFileName=e+tu}return t.prototype.save=function(t){return i(this,void 0,void 0,function(){var e,n,r,i,a,s;return o(this,function(o){if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),t.modelTopology instanceof ArrayBuffer)throw new Error("DownloadTrigger.save() does not support saving model topology in binary formats yet.");return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,a.click(),null!=t.weightData&&((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,s.click()),[2,{modelArtifactsInfo:Is(t)}]})})},t.URL_SCHEME="downloads://",t}(),nu=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return i(this,void 0,void 0,function(){var t,e,n=this;return o(this,function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(r,i){var o=new FileReader;o.onload=function(o){var a=JSON.parse(o.target.result),s=a.modelTopology;if(null!=s){0===e.length&&r({modelTopology:s});var u=a.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,e)}catch(t){return void i(t)}var c=[],h=[],p=[];u.forEach(function(t){t.paths.forEach(function(t){h.push(t),p.push(null)}),c.push.apply(c,t.weights)}),u.forEach(function(t){t.paths.forEach(function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,i=h.indexOf(t);p[i]=n,-1===p.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:Cs(p)})},e.onerror=function(e){i("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(l[t])})})}else i(new Error("weightManifest field is missing from file "+t.name))}else i(new Error("modelTopology field is missing from file "+t.name))},o.onerror=function(e){i("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},o.readAsText(t)})]})})},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map(function(t){return Rs(t.name)}),i={},o=0,a=t;o<a.length;o++)a[o].paths.forEach(function(t){var o=Rs(t);if(-1!==n.indexOf(o))throw new Error("Duplicate file basename found in weights manifest: '"+o+"'");if(n.push(o),-1===r.indexOf(o))throw new Error("Weight file with basename '"+o+"' is not provided.");i[t]=e[r.indexOf(o)]});if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return i},t}();function ru(t,e){return i(this,void 0,void 0,function(){var n,r;return o(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return fetch(t,e)}),[4,Promise.all(n)];case 1:return r=i.sent(),[4,Promise.all(r.map(function(t){return t.arrayBuffer()}))];case 2:return[2,i.sent()]}})})}As.registerSaveRouter(function(t){return bt.get("IS_BROWSER")&&t.startsWith(eu.URL_SCHEME)?function(t){return void 0===t&&(t="model"),new eu(t)}(t.slice(eu.URL_SCHEME.length)):null});var iu=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",!bt.get("IS_BROWSER"))throw new Error("browserHTTPRequest is not supported outside the web browser.");if(c(null!=t&&t.length>0,"URL path for browserHTTPRequest must not be null, undefined or empty."),this.path=t,null!=e&&null!=e.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e||{}}return t.prototype.save=function(t){return i(this,void 0,void 0,function(){var e,n,r,i;return o(this,function(o){switch(o.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,fetch(this.path,e)];case 1:if(200===(i=o.sent()).status)return[2,{modelArtifactsInfo:Is(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},t.prototype.load=function(){return i(this,void 0,void 0,function(){var t,e,n,r,i,a,s,u,l,c,h,p;return o(this,function(o){switch(o.label){case 0:return[4,fetch(this.path,this.requestInit)];case 1:return[4,o.sent().json()];case 2:if(t=o.sent(),e=t.modelTopology,n=t.weightsManifest,null==e&&null==n)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");if(null==n)return[3,4];for(a=t.weightsManifest,r=[],s=0,u=a;s<u.length;s++)l=u[s],r.push.apply(r,l.weights);return(c=this.path.substring(0,this.path.lastIndexOf("/"))).endsWith("/")||(c+="/"),h=[],a.forEach(function(t){t.paths.forEach(function(t){h.push(c+t)})}),p=Cs,[4,ru(h,this.requestInit)];case 3:i=p.apply(void 0,[o.sent()]),o.label=4;case 4:return[2,{modelTopology:e,weightSpecs:r,weightData:i}]}})})},t.URL_SCHEMES=["http://","https://"],t}(),ou=function(t){if(bt.get("IS_BROWSER")){for(var e=0,n=iu.URL_SCHEMES;e<n.length;e++){var r=n[e];if(t.startsWith(r))return au(t)}return null}return null};function au(t,e){return new iu(t,e)}As.registerSaveRouter(ou),As.registerLoadRouter(ou);var su=As.registerSaveRouter,uu=As.registerLoadRouter,lu=As.getSaveHandlers,cu=As.getLoadHandlers,hu=Ms.copyModel,pu=Ms.listModels,fu=Ms.moveModel,du=Ms.removeModel,gu=Object.freeze({browserFiles:function(t){return new nu(t)},browserHTTPRequest:au,concatenateArrayBuffers:Cs,copyModel:hu,decodeWeights:function(t,e){for(var n={},r=0,i=0,o=e;i<o.length;i++){var a=o[i],s=a.name,u=a.dtype,l=a.shape;if(null!=a.quantization)throw new Error("decodeWeights does not support quantization yet, but encountered weight '"+s+" with quantization.'");var c=g(l),h=void 0;if("float32"===u)h=tt.tensor(new Float32Array(t,r,c),l,"float32");else if("int32"===u)h=tt.tensor(new Int32Array(t,r,c),l,"int32");else{if("bool"!==u)throw new Error("Unsupported dtype in weight '"+s+"': "+u);h=tt.tensor(new Uint8Array(t,r,c),l,"bool")}n[s]=h,r+=c*Es[u]}return n},encodeWeights:function(t){return i(this,void 0,void 0,function(){var e,n,r,i;return o(this,function(o){switch(o.label){case 0:for(r in e=[],n=[],t){if("float32"!==(i=t[r]).dtype&&"int32"!==i.dtype&&"bool"!==i.dtype)throw new Error("Unsupported dtype in weight '"+r+"': "+i.dtype);e.push({name:r,shape:i.shape,dtype:i.dtype}),n.push(i.data())}return[4,Promise.all(n)];case 1:return[2,{data:function(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0;t.forEach(function(t){if(t instanceof Float32Array||t instanceof Int32Array)e+=t.buffer.byteLength;else{if(!(t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name);e+=t.buffer.byteLength}});var n=new Uint8Array(e),r=0;return t.forEach(function(t){n.set(new Uint8Array(t.buffer),r),r+=t.buffer.byteLength}),n.buffer}(o.sent()),specs:e}]}})})},getLoadHandlers:cu,getModelArtifactsInfoForJSON:Is,getSaveHandlers:lu,listModels:pu,loadWeights:function(t,e,n,r){return void 0===e&&(e=""),i(this,void 0,void 0,function(){var i,a,s,u,l,c,h,p,f,d;return o(this,function(o){switch(o.label){case 0:if(i=t.map(function(){return!1}),a={},s=null!=n?n.map(function(){return!1}):[],u=[],t.forEach(function(t,e){var r=0;t.weights.forEach(function(t){var o="quantization"in t?t.quantization.dtype:t.dtype,l=Es[o]*g(t.shape),c=function(){i[e]=!0,null==a[e]&&(a[e]=[]),a[e].push({manifestEntry:t,groupOffset:r,sizeBytes:l})};null!=n?n.forEach(function(e,n){e===t.name&&(c(),s[n]=!0)}):c(),u.push(t.name),r+=l})}),!s.every(function(t){return t}))throw l=n.filter(function(t,e){return!s[e]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return c=i.reduce(function(t,e,n){return e&&t.push(n),t},[]),h=[],c.forEach(function(n){t[n].paths.forEach(function(t){var n=e+(e.endsWith("/")?"":"/")+t;h.push(n)})}),[4,ru(h,r)];case 1:return p=o.sent(),f={},d=0,c.forEach(function(e){for(var n=t[e].paths.length,r=0,i=0;i<n;i++)r+=p[d+i].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),u=0,l=0;l<n;l++){var c=new Uint8Array(p[d+l]);s.set(c,u),u+=c.byteLength}a[e].forEach(function(t){var e,n=o.slice(t.groupOffset,t.groupOffset+t.sizeBytes),r=t.manifestEntry.dtype;if("quantization"in t.manifestEntry){var i=t.manifestEntry.quantization;if("uint8"!==i.dtype&&"uint16"!==i.dtype)throw new Error("Weight "+t.manifestEntry.name+" has unknown quantization dtype "+i.dtype+".");var a="uint8"===i.dtype?new Uint8Array(n):new Uint16Array(n);if("float32"===r)e=Float32Array.from(a,function(t){return t*i.scale+i.min});else{if("int32"!==r)throw new Error("Weight "+t.manifestEntry.name+" has a dtype not supported by quantization: "+r);e=Int32Array.from(a,function(t){return Math.round(t*i.scale+i.min)})}}else if("float32"===r)e=new Float32Array(n);else{if("int32"!==r)throw new Error("Weight "+t.manifestEntry.name+" has unknown dtype "+r+".");e=new Int32Array(n)}var s=t.manifestEntry.name;if(null!=f[s])throw new Error("Duplicate weight with name "+s+". Please make sure weights names are unique in the manifest JSON.");f[s]=Ri(e,t.manifestEntry.shape,t.manifestEntry.dtype)}),d+=n}),[2,f]}})})},moveModel:fu,registerLoadRouter:uu,registerSaveRouter:su,removeModel:du}),vu=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),mu=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(t){this.getMap().classNameMap[t.className]=[t,t.fromConfig]},t}(),yu=Object.freeze({Serializable:vu,SerializationMap:mu}),bu=[{BACKEND:"test-webgl",WEBGL_RENDER_FLOAT32_ENABLED:!0,WEBGL_DOWNLOAD_FLOAT_ENABLED:!0,WEBGL_VERSION:1},{BACKEND:"test-webgl",WEBGL_RENDER_FLOAT32_ENABLED:!0,WEBGL_DOWNLOAD_FLOAT_ENABLED:!0,WEBGL_VERSION:2}],wu=[{BACKEND:"test-cpu"}],xu={},Su=bu.concat(wu),Eu=[xu].concat(Su);function ku(t,e,n){if(null==n&&(n=bt.get("TEST_EPSILON")),t instanceof $||e instanceof $){if(t instanceof $&&e instanceof $){if(t.dtype!==e.dtype)throw new Error("Arrays are of different type actual: "+t.dtype+" vs expected: "+e.dtype+".");if(!v(t.shape,e.shape))throw new Error("Arrays are of different shape actual: "+t.shape+" vs expected: "+e.shape+".")}}else{var r=t.constructor.name,i=e.constructor.name;if(r!==i)throw new Error("Arrays are of different type actual: "+r+" vs expected: "+i)}var o,a;if(o=t instanceof $?t.dataSync():t,a=e instanceof $?e.dataSync():e,o.length!==a.length)throw new Error("Arrays have different lengths actual: "+o.length+" vs expected: "+a.length+".\nActual:   "+o+".\nExpected: "+a+".");for(var s=0;s<a.length;++s){var u=o[s],l=a[s];if(!Cu(u,Number(l),n))throw new Error("Arrays differ: actual["+s+"] = "+u+", expected["+s+"] = "+l+".\nActual:   "+o+".\nExpected: "+a+".")}}function Cu(t,e,n){return!(!isNaN(t)||!isNaN(e))||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var Ru=Object.freeze({WEBGL_ENVS:bu,CPU_ENVS:wu,CHROME_CPU_ENVS:[{BACKEND:"test-cpu",IS_CHROME:!0}],NATIVE_ENV:xu,BROWSER_ENVS:Su,ALL_ENVS:Eu,expectArraysClose:ku,expectPromiseToFail:function(t,e){t().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(t,e){return ku(t,e,0)},expectNumbersClose:function(t,e,n){if(null==n&&(n=bt.get("TEST_EPSILON")),!Cu(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,n){var r;r=t instanceof $?t.dataSync():t;for(var i=0;i<r.length;i++)if(r[i]<e||r[i]>n)throw new Error("Value out of range:"+r[i]+" low: "+e+", high: "+n)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}}),Iu=Object.freeze({gpgpu_util:Ua,webgl_util:ba,MathBackendWebGL:ws,GPGPUContext:Wa}),Au=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),i=r.value,o=r.grads;return this.applyGradients(o),Object.keys(o).forEach(function(t){return o[t].dispose()}),e?i:(i.dispose(),null)},e.prototype.computeGradients=function(t,e){return we(t,e)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"minimize",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e)}(vu),Nu=1e-8,Tu=1e-4;function Du(){return bt.get("WEBGL_RENDER_FLOAT32_ENABLED")?Nu:Tu}var zu=function(t){function e(e,n,r){void 0===r&&(r=null);var i=t.call(this)||this;return i.learningRate=e,i.rho=n,i.epsilon=r,i.accumulatedGrads={},i.accumulatedUpdates={},i.c=fe(Ii(-e)),i.rhoScalar=fe(Ii(n)),i.oneMinusRho=fe(Ii(1-n)),null===r&&(r=Du()),i.epsilonScalar=fe(Ii(r)),i}return n(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var i=bt.engine.registeredVariables[n];null==r.accumulatedGrads[n]&&pe(function(){e.accumulatedGrads[n]=ci(i).variable(!1)}),null==r.accumulatedUpdates[n]&&pe(function(){e.accumulatedUpdates[n]=ci(i).variable(!1)});var o=t[n],a=r.accumulatedGrads[n],s=r.accumulatedUpdates[n];pe(function(){var t=e.rhoScalar.mul(a).add(e.oneMinusRho.mul(o.square())),r=s.add(e.epsilonScalar).sqrt().div(a.add(e.epsilonScalar).sqrt()).mul(o),u=e.rhoScalar.mul(s).add(e.oneMinusRho.mul(r.square()));e.accumulatedGrads[n].assign(t),e.accumulatedUpdates[n].assign(u);var l=e.c.mul(r).add(i);i.assign(l)})},r=this;for(var i in t)n(i)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(e){return t.accumulatedUpdates[e].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="AdadeltaOptimizer",e}(Au);mu.register(zu);var Mu=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads={},r.c=fe(Ii(-e));var i=Du();return r.epsilon=fe(Ii(i)),r}return n(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var i=bt.engine.registeredVariables[n];null==r.accumulatedGrads[n]&&pe(function(){e.accumulatedGrads[n]=Ci(i.shape,e.initialAccumulatorValue).variable(!1)});var o=t[n],a=r.accumulatedGrads[n];pe(function(){var t=a.add(o.square());e.accumulatedGrads[n].assign(t);var r=e.c.mul(o.div(t.add(e.epsilon).sqrt())).add(i);i.assign(r)})},r=this;for(var i in t)n(i)},e.prototype.dispose=function(){var t=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="AdagradOptimizer",e}(Au);mu.register(Mu);var Ou=function(t){function e(e,n,r,i){void 0===i&&(i=null);var o=t.call(this)||this;return o.learningRate=e,o.beta1=n,o.beta2=r,o.epsilon=i,o.accumulatedFirstMoment={},o.accumulatedSecondMoment={},o.c=fe(Ii(-e)),o.beta1Scalar=fe(Ii(n)),o.beta2Scalar=fe(Ii(r)),pe(function(){o.accBeta1=Ii(n).variable(),o.accBeta2=Ii(r).variable()}),o.oneMinusBeta1=fe(Ii(1-n)),o.oneMinusBeta2=fe(Ii(1-r)),o.one=fe(Ii(1)),null===i&&(i=Du()),o.epsScalar=fe(Ii(i)),o}return n(e,t),e.prototype.applyGradients=function(t){var e=this;pe(function(){var n=e.one.sub(e.accBeta1),r=e.one.sub(e.accBeta2);for(var i in t){var o=bt.engine.registeredVariables[i];if(null==e.accumulatedFirstMoment[i]){var a=!1;e.accumulatedFirstMoment[i]=ci(o).variable(a)}null==e.accumulatedSecondMoment[i]&&(a=!1,e.accumulatedSecondMoment[i]=ci(o).variable(a));var s=t[i],u=e.accumulatedFirstMoment[i],l=e.accumulatedSecondMoment[i],c=e.beta1Scalar.mul(u).add(e.oneMinusBeta1.mul(s)),h=e.beta2Scalar.mul(l).add(e.oneMinusBeta2.mul(s.square())),p=c.div(n),f=h.div(r);e.accumulatedFirstMoment[i].assign(c),e.accumulatedSecondMoment[i].assign(h);var d=e.c.mul(p.div(e.epsScalar.add(f.sqrt()))).add(o);o.assign(d)}e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar)),e.accBeta2.assign(e.accBeta2.mul(e.beta2Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(e){return t.accumulatedSecondMoment[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="AdamOptimizer",e}(Au);mu.register(Ou);var Lu=function(t){function e(e,n,r,i,o){void 0===i&&(i=null),void 0===o&&(o=0);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=i,a.decay=o,a.accumulatedFirstMoment={},a.accumulatedWeightedInfNorm={},a.c=fe(Ii(-e)),a.beta1Scalar=fe(Ii(n)),a.beta2Scalar=fe(Ii(r)),a.decayScalar=fe(Ii(o)),pe(function(){a.iteration=Ii(0).variable(),a.accBeta1=Ii(n).variable()}),a.oneMinusBeta1=fe(Ii(1-n)),a.one=fe(Ii(1)),null===i&&(i=Du()),a.epsScalar=fe(Ii(i)),a}return n(e,t),e.prototype.applyGradients=function(t){var e=this;pe(function(){var n=e.one.sub(e.accBeta1),r=e.c.div(e.one.add(e.decayScalar.mul(e.iteration)));for(var i in t){var o=bt.engine.registeredVariables[i];if(null==e.accumulatedFirstMoment[i]){var a=!1;e.accumulatedFirstMoment[i]=ci(o).variable(a)}null==e.accumulatedWeightedInfNorm[i]&&(a=!1,e.accumulatedWeightedInfNorm[i]=ci(o).variable(a));var s=t[i],u=e.accumulatedFirstMoment[i],l=e.accumulatedWeightedInfNorm[i],c=e.beta1Scalar.mul(u).add(e.oneMinusBeta1.mul(s)),h=e.beta2Scalar.mul(l),p=s.abs(),f=h.maximum(p);e.accumulatedFirstMoment[i].assign(c),e.accumulatedWeightedInfNorm[i].assign(f);var d=r.div(n).mul(c.div(e.epsScalar.add(f))).add(o);o.assign(d)}e.iteration.assign(e.iteration.add(e.one)),e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(e){return t.accumulatedWeightedInfNorm[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="AdamaxOptimizer",e}(Au);mu.register(Lu);var Fu=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return n(e,t),e.prototype.applyGradients=function(t){var e=this;Object.keys(t).forEach(function(n){var r=t[n],i=bt.engine.registeredVariables[n];pe(function(){var t=e.c.mul(r).add(i);i.assign(t)})})},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=fe(Ii(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGDOptimizer",e}(Au);mu.register(Fu);var _u=function(t){function e(e,n,r){void 0===r&&(r=!1);var i=t.call(this,e)||this;return i.learningRate=e,i.momentum=n,i.useNesterov=r,i.m=Ii(i.momentum),i.accumulations={},i}return n(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var i=bt.engine.registeredVariables[n];null==r.accumulations[n]&&pe(function(){e.accumulations[n]=ci(i).variable(!1)});var o=r.accumulations[n],a=t[n];pe(function(){var t,r=e.m.mul(o).add(a);t=e.useNesterov?e.c.mul(a.add(r.mul(e.m))).add(i):e.c.mul(r).add(i),e.accumulations[n].assign(r),i.assign(t)})},r=this;for(var i in t)n(i)},e.prototype.dispose=function(){if(t.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var e in this.accumulations)this.accumulations[e].dispose()},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="MomentumOptimizer",e}(Fu);mu.register(_u);var Bu=function(t){function e(e,n,r,i,o){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===o&&(o=!1);var a=t.call(this)||this;return a.learningRate=e,a.decay=n,a.momentum=r,a.epsilon=i,a.accumulatedMeanSquares={},a.accumulatedMeanGrads={},a.accumulatedMoments={},a.c=fe(Ii(e)),a.decayScalar=fe(Ii(n)),a.momentumScalar=fe(Ii(r)),a.oneMinusDecay=fe(Ii(1-n)),a.centered=o,null===i&&(i=Du()),a.epsilonScalar=fe(Ii(i)),a}return n(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var i=bt.engine.registeredVariables[n];null==r.accumulatedMeanSquares[n]&&pe(function(){e.accumulatedMeanSquares[n]=ci(i).variable(!1)}),null==r.accumulatedMeanGrads[n]&&r.centered&&pe(function(){e.accumulatedMeanGrads[n]=ci(i).variable(!1)}),null==r.accumulatedMoments[n]&&pe(function(){e.accumulatedMoments[n]=ci(i).variable(!1)});var o=r.accumulatedMeanSquares[n],a=r.accumulatedMeanGrads[n],s=r.accumulatedMoments[n],u=t[n];pe(function(){var t=e.decayScalar.mul(o).add(e.oneMinusDecay.mul(u.square()));if(e.centered){var r=e.decayScalar.mul(a).add(e.oneMinusDecay.mul(u)),l=e.momentumScalar.mul(s).add(e.c.mul(u).div(t.sub(r.square().add(e.epsilonScalar)).sqrt()));e.accumulatedMeanSquares[n].assign(t),e.accumulatedMeanGrads[n].assign(r),e.accumulatedMoments[n].assign(l);var c=i.sub(l);i.assign(c)}else{var h=e.decayScalar.mul(o).add(e.oneMinusDecay.mul(u.square()));l=e.momentumScalar.mul(s).add(e.c.mul(u).div(h.add(e.epsilonScalar).sqrt())),e.accumulatedMeanSquares[n].assign(h),e.accumulatedMoments[n].assign(l),c=i.sub(l),i.assign(c)}})},r=this;for(var i in t)n(i)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(e){return t.accumulatedMeanSquares[e].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(e){return t.accumulatedMeanGrads[e].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(e){return t.accumulatedMoments[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSPropOptimizer",e}(Au);mu.register(Bu);var Pu=function(){function t(){}return t.sgd=function(t){return new Fu(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new _u(t,e,n)},t.rmsprop=function(t,e,n,r,i){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new Bu(t,e,n,r,i)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new Ou(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new zu(t,e,n)},t.adamax=function(t,e,n,r,i){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new Lu(t,e,n,r,i)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new Mu(t,e)},r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"sgd",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"momentum",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"rmsprop",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"adam",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"adadelta",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"adamax",null),r([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"adagrad",null),t}(),Uu={sgd:Pu.sgd,momentum:Pu.momentum,adadelta:Pu.adadelta,adagrad:Pu.adagrad,rmsprop:Pu.rmsprop,adamax:Pu.adamax,adam:Pu.adam},Wu=dt.setBackend,Vu=dt.getBackend,qu=dt.disposeVariables,Gu=dt.memory,ju=Ss.nextFrame;!function(t){j=t}(eo);var Hu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function $u(t,e){function n(){this.constructor=t}Hu(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Ku=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t};function Xu(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function Ju(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function Yu(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Zu=1e-7;function Qu(){return Zu}var tl=0;function el(){return tl++}var nl={};function rl(t){return void 0===t&&(t=""),t in nl||(nl[t]=0),nl[t]+=1,t+nl[t].toString()}var il={float32:{},int32:{}},ol="float32";function al(t,e){return void 0===e&&(e=ol),null==il[e][t]&&(il[e][t]=Ii(t,e),fe(il[e][t])),il[e][t]}var sl=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return $u(e,t),e}(Error),ul=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return $u(e,t),e}(Error),ll=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return $u(e,t),e}(Error),cl=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return $u(e,t),e}(Error),hl=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return $u(e,t),e}(Error);!function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}$u(e,t)}(Error);function pl(t,e){if(Array.isArray(t)){for(var n=[],r=0;r<e;r++)n=n.concat(t);return n}return(n=new Array(e)).fill(t),n}function fl(t,e){if(!t)throw new hl(e)}function dl(t,e){for(var n=0,r=0,i=t;r<i.length;r++)i[r]===e&&n++;return n}function gl(t){return 1===t.length?t[0]:t}function vl(t){return Array.isArray(t)?t:[t]}function ml(t){var e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function yl(t){return t.length<=1?t:-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,function(t,e){return e.toUpperCase()})}var bl={};function wl(t){return null===t||void 0===t?null:{className:t.getClassName(),config:t.getConfig()}}function xl(t,e,n,r){if(void 0===e&&(e={}),void 0===n&&(n={}),void 0===r&&(r="object"),"string"==typeof t){var i=t,o=void 0;if(i in n)o=n[i];else if(i in bl)o=bl[i];else if(null==(o=e[i]))throw new ll("Unknown "+r+": "+t);return o}var a=t;if(null==a.className||null==a.config)throw new ll(r+": Improper config format: "+JSON.stringify(a)+".\n'className' and 'config' must set.");var s,u,l,c=a.className,h=void 0,p=void 0;if(c in n?(h=(s=n.get(c))[0],p=s[1]):c in bl?(h=(u=bl.className)[0],p=u[1]):c in e&&(h=(l=e[c])[0],p=l[1]),null==h)throw new ll("Unknown "+r+": "+c);if(null!=p){for(var f={},d=0,g=Object.keys(bl);d<g.length;d++)f[x=g[d]]=bl[x];for(var v=0,m=Object.keys(n);v<m.length;v++)f[x=m[v]]=n[x];a.config.customObjects=f;for(var y=Ku({},bl),b=0,w=Object.keys(n);b<w.length;b++){var x=w[b];bl[x]=n[x]}var S=p(h,a.config);return bl=Ku({},y),S}y=Ku({},bl);for(var E=0,k=Object.keys(n);E<k.length;E++)x=k[E],bl[x]=n[x];return S=new h(a.config),bl=Ku({},y),S}function Sl(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function El(t){if(null==t)return t;for(var e=[],n=0,r=t;n<r.length;n++){var i=r[n];-1===e.indexOf(i)&&e.push(i)}return e}function kl(t){if(null==t)throw new ll("Invalid value in obj: "+JSON.stringify(t));for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function Cl(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new ll(n+" is not a valid "+e+".  Valid values are "+t+" or null/undefined.")}function Rl(t,e,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),fl(n>=0),fl(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every(function(t){return typeof t===e})}function Il(t,e){return pe(function(){return Nr(Ln(Xr(t,t),e,!0))})}var Al=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.getConfig=function(){return{}},Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e)}(yu.Serializable),Nl=function(t){function e(e){var n=t.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=null!=e.maxValue?e.maxValue:n.defaultMaxValue,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return $u(e,t),e.prototype.apply=function(t){var e=this;return pe(function(){var n=Il(t,e.axis),r=sr(n,0,e.maxValue);return Kr(t,Pr(r,Fr(al(Qu()),n)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e.className="MaxNorm",e}(Al);yu.SerializationMap.register(Nl);var Tl=function(t){function e(e){var n=t.call(this)||this;return n.defaultAxis=0,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return $u(e,t),e.prototype.apply=function(t){var e=this;return pe(function(){return Pr(t,Fr(al(Qu()),Il(t,e.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e.className="UnitNorm",e}(Al);yu.SerializationMap.register(Tl);var Dl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t){return xr(t)},e.className="NonNeg",e}(Al);yu.SerializationMap.register(Dl);var zl=function(t){function e(e){var n=t.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=null!=e.minValue?e.minValue:n.defaultMinValue,n.maxValue=null!=e.maxValue?e.maxValue:n.defaultMaxValue,n.rate=null!=e.rate?e.rate:n.defaultRate,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return $u(e,t),e.prototype.apply=function(t){var e=this;return pe(function(){var n=Il(t,e.axis),r=Fr(Kr(al(e.rate),sr(n,e.minValue,e.maxValue)),Kr(al(1-e.rate),n));return Kr(t,Pr(r,Fr(al(Qu()),n)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e.className="MinMaxNorm",e}(Al);yu.SerializationMap.register(zl);var Ml={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ol(t){return wl(t)}function Ll(t,e){return void 0===e&&(e={}),xl(t,yu.SerializationMap.getMap().classNameMap,e,"constraint")}function Fl(t){return null==t?null:"string"==typeof t?Ll({className:t in Ml?Ml[t]:t,config:{}}):t instanceof Al?t:Ll(t)}var _l=new Map,Bl=["channelsFirst","channelsLast"];function Pl(t){Cl(Bl,"DataFormat",t)}var Ul=["valid","same","causal"];function Wl(t){Cl(Ul,"PaddingMode",t)}var Vl=["max","avg"];var ql=[],Gl="/";function jl(t,e){ql.push(t);try{var n=e();return ql.pop(),n}catch(t){throw ql.pop(),t}}function Hl(t){if(!Xl(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===ql.length?"":ql.join(Gl)+Gl)+t}function $l(t){if(!Xl(t))throw new Error("Not a valid tensor name: '"+t+"'");_l.has(t)||_l.set(t,0);var e=_l.get(t);if(_l.set(t,_l.get(t)+1),e>0){var n=t+"_"+e;return _l.set(n,1),n}return t}var Kl=new RegExp(/^[A-Za-z][A-Za-z0-9\._\/]*$/);function Xl(t){return!!t.match(Kl)}function Jl(t,e){return void 0===e&&(e={}),xl(t,yu.SerializationMap.getMap().classNameMap,e,"layer")}function Yl(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function Zl(t){return Array.isArray(t)&&Array.isArray(t[0])}function Ql(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function tc(t){var e;if(Array.isArray(t)){if(1!==t.length)throw new ll("Expected Tensor length to be 1; got "+t.length);e=t[0]}else e=t;return e}function ec(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new ll("Expected exactly 1 Shape; got "+t.length)}return t}function nc(t){for(var e=0,n=0,r=t;n<r.length;n++){var i=r[n];0===i.shape.length?e+=1:e+=i.shape.reduce(function(t,e){return t*e})}return e}var rc="Variable",ic=function(){function t(t,e,n,r,i){void 0===e&&(e="float32"),void 0===n&&(n=rc),void 0===r&&(r=!0),void 0===i&&(i=null),this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=el(),n=null==n?rc:n,this.originalName=Hl(n),this.name=$l(this.originalName),this.trainable=r,this.constraint=i,this.val=X(t,this.trainable,this.name,this.dtype)}return t.prototype.read=function(){return this.val},t.prototype.write=function(t){return function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val)),this},t}();function oc(t){return t.map(function(t){return t.read()})}function ac(t){t.map(function(t){t[0].write(t[1])})}var sc=function(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},uc=function(){function t(t,e,n,r,i,o,a){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=el(),null!=o&&(this.originalName=Hl(o),this.name=$l(this.originalName)),this.rank=e.length}return Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t)}(),lc=0,cc=function(){function t(t,e){this.callArgs=e,this.id=lc++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(var n=0,r=t.inboundLayers;n<r.length;n++){var i=r[n];null!=i&&i.outboundNodes.push(this)}t.outboundLayer.inboundNodes.push(this)}return t.prototype.getConfig=function(){for(var t=[],e=0,n=this.inboundLayers;e<n.length;e++){var r=n[e];null!=r?t.push(r.name):t.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},t}(),hc=0,pc=function(t){function e(e){var n=t.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=hc++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var r=e.name;if(!r){var i=n.getClassName();r=ml(i)+"_"+rl(i)}if(n.name=r,n.trainable=null==e.trainable||e.trainable,n.updatable=null==e.updatable||e.updatable,null!=e.inputShape||null!=e.batchInputShape){var o=void 0;if(null!=e.batchInputShape)o=e.batchInputShape;else if(null!=e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),o=[a].concat(e.inputShape)}n.batchInputShape=o;var s=e.dtype;null==s&&(s=e.inputDType),null==s&&(s="float32"),n.dtype=s}return null!=e.weights?n.initialWeights=e.weights:n.initialWeights=null,n}return $u(e,t),e.nodeKey=function(t,e){return t.name+"_ib-"+e.toString()},e.prototype.getNodeAtIndex=function(t,e){if(0===this.inboundNodes.length)throw new ul("The layer has never been called and thus has no defined "+e+".");if(this.inboundNodes.length<=t)throw new ll("Asked to get "+e+" at node "+t+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return gl(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return gl(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new sl("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new sl("Layer "+this.name+" is not connected, no input to return.");return gl(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new sl("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new sl("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return gl(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this._trainableWeights:[]},set:function(t){this._trainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._nonTrainableWeights:this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),e.prototype.assertInputCompatibility=function(t){if(t=vl(t),null!=this.inputSpec&&0!==this.inputSpec.length){var e=vl(this.inputSpec);if(t.length!==e.length)throw new ll("Layer "+this.name+" expects "+e.length+" inputs, but it received "+t.length+" input tensors. Input received: "+t);for(var n=0;n<t.length;n++){var r=t[n],i=e[n];if(null!=i){var o=r.rank;if(null!=i.ndim&&o!==i.ndim)throw new ll("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+i.ndim+", found ndim="+o);if(null!=i.maxNDim&&o>i.maxNDim)throw new ll("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+i.maxNDim+", found ndim="+o);if(null!=i.minNDim&&o<i.minNDim)throw new ll("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+i.minNDim+", found ndim="+o+".");if(null!=i.dtype&&r.dtype!==i.dtype)throw new ll("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+i.dtype+", found dtype="+r.dtype+".");if(i.axes){var a=r.shape;for(var s in i.axes){var u=Number(s),l=i.axes[s],c=u>=0?a[u]:a[a.length+u];if(null!=l&&-1===[l,null].indexOf(c))throw new ll("Input "+n+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+l+" but got shape "+a+".")}}if(null!=i.shape)for(var h=0;h<i.shape.length;++h){var p=i.shape[h],f=r.shape[h];if(null!=p&&null!=f&&p!==f)throw new ll("Input "+n+" is incompatible with layer "+this.name+": expected shape="+i.shape+", found shape=${xShape}.")}}}}},e.prototype.call=function(t,e){return t},e.prototype.invokeCallHook=function(t,e){null!=this._callHook&&this._callHook(t,e)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,e){var n=this;e=e||{};for(var r=vl(t),i=!0,o=0,a=r;o<a.length;o++)if(!(a[o]instanceof uc)){i=!1;break}for(var s=!0,u=0,l=r;u<l.length;u++)if(l[u]instanceof uc){s=!1;break}if(i===s)throw new ll("Arguments to apply() must be all SymbolicTensors or all Tensors");return jl(this.name,function(){if(!n.built){n.assertInputCompatibility(t);for(var i=[],o=0,a=vl(t);o<a.length;o++){var u=a[o];i.push(u.shape)}n.build(gl(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights)}if(n.assertInputCompatibility(t),s){for(var l=[],c=0,h=vl(g=n.call(t,e));c<h.length;c++){var p=h[c];-1!==r.indexOf(p)&&(p=p.clone()),l.push(p)}if(g=gl(l),null!=n.activityRegularizer)throw new cl("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return g}var f=function(t){for(var e=[],n=0,r=t=vl(t);n<r.length;n++){var i=r[n];e.push(i.shape)}return gl(e)}(t),d=n.computeOutputShape(f),g=void 0,v="float32";if(g=null!=d&&d.length>0&&Array.isArray(d[0])?d.map(function(r,i){return new uc(v,r,n,vl(t),e,n.name,i)}):new uc(v,d,n,vl(t),e,n.name),n.addInboundNode(t,g,null,null,f,d,e),null!=n.activityRegularizer)throw new cl("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return g})},Object.defineProperty(e.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new sl("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var t=[],e=0,n=this.inboundNodes;e<n.length;e++){var r=n[e],i=JSON.stringify(r.outputShapes);-1===t.indexOf(i)&&t.push(i)}if(1===t.length){var o=this.inboundNodes[0].outputShapes;return Array.isArray(o)&&Array.isArray(o[0])&&1===o.length?o[0]:o}throw new sl("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new ul("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return nc(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return void 0===t&&(t=!1),oc(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var e=this;pe(function(){var n=e.weights;if(n.length!==t.length)throw new ll('You called setWeights(weights) on layer "'+e.name+'" with a weight list of length '+t.length+", but the layer was expecting "+n.length+" weights. Provided weights: "+t+"...");if(0!==n.length){for(var r=[],i=oc(n),o=0;o<i.length;++o){var a=i[o],s=n[o],u=t[o];if(!_.arraysEqual(a.shape,u.shape))throw new ll("Layer weight shape "+a.shape+" not compatible with provided weight shape "+u.shape);r.push([s,u])}ac(r)}})},e.prototype.addWeight=function(t,e,n,r,i,o,a){if(-1!==this._addedWeightNames.indexOf(t))throw new ll("Duplicate weight name "+t+" for layer "+this.name);this._addedWeightNames.push(t),null==n&&(n="float32");var s=new ic(r.apply(e,n),n,t,o,a);return null!=i&&this.addLoss(function(){return i.apply(s.read())}),null==o&&(o=!0),o?this._trainableWeights.push(s):this._nonTrainableWeights.push(s),s},e.prototype.addLoss=function(t){var e;null==t||Array.isArray(t)&&0===t.length||(t=vl(t),void 0!==this._losses&&null!==this._losses&&(e=this.losses).push.apply(e,t))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,e){var n=this;if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError("Layer "+this.name+" does not support masking,but was passed an inputMask.");e.forEach(function(t){if(null!=t)throw new TypeError("Layer "+n.name+" does not support masking,but was passed an inputMask.")})}return null}return e},e.prototype.addInboundNode=function(t,e,n,r,i,o,a){void 0===a&&(a=null);var s=vl(t);e=vl(e),n=vl(n),r=vl(r),i=Ql(i),o=Ql(o);for(var u=[],l=[],c=[],h=0,p=s;h<p.length;h++){var f=p[h];u.push(f.sourceLayer),l.push(f.nodeIndex),c.push(f.tensorIndex)}new cc({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:s,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:o},a);for(var d=0;d<e.length;d++)e[d].sourceLayer=this,e[d].nodeIndex=this.inboundNodes.length-1,e[d].tensorIndex=d},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t},Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"apply",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e)}(yu.Serializable);var fc=function(t){function e(e){var n=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:rl("input").toString()})||this;if(null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new ll("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var r=e.batchInputShape;if(null==r){if(null==e.inputShape)throw new ll("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new ll("Cannot specify batchSize if batchInputShape isspecified when creating an InputLayer.");var i=e.dtype||"float32";n.batchInputShape=r,n.dtype=i,n.inputSpec=[{shape:r}];var o=new uc(n.dtype,n.batchInputShape,n,[],{},n.name);return o.nodeIndex=0,o.tensorIndex=0,new cc({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]}),n}return $u(e,t),e.prototype.apply=function(t,e){throw new ll("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e.className="InputLayer",e}(pc);function dc(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new ll("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));var n=t.dtype;return null==n&&(n="float32"),new fc({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}yu.SerializationMap.register(fc);var gc=function(t){function e(n){var r=t.call(this,{})||this;if(r.containerNodes=new Set,r.name=n.name,null==r.name){var i=r.getClassName().toLowerCase();r.name=rl(i)}if(r.supportsMasking=!1,r.trainable=!0,r.updatable=!0,Array.isArray(n.inputs)?r.inputs=n.inputs.slice():r.inputs=[n.inputs],Array.isArray(n.outputs)?r.outputs=n.outputs.slice():r.outputs=[n.outputs],El(r.inputs).length!==r.inputs.length)throw new ll("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+r.inputs.map(function(t){return t.name}));El(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+r.outputs.map(function(t){return t.name})),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[];for(var o=0,a=r.outputs;o<a.length;o++){var s=(R=a[o]).sourceLayer,u=R.nodeIndex,l=R.tensorIndex;r.outputLayers.push(s),r.outputLayersNodeIndices.push(u),r.outputLayersTensorIndices.push(l)}for(var c=0,h=r.inputs;c<h.length;c++)s=(R=h[c]).sourceLayer,u=R.nodeIndex,l=R.tensorIndex,fl(0===u,"input layer has >1 nodes"),fl(0===l,"input layer has >1 tensors"),r.inputLayers.push(s),r.inputLayersNodeIndices.push(u),r.inputLayersTensorIndices.push(l);r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var p=0;p<r.inputLayers.length;p++){if(!((s=r.inputLayers[p])instanceof fc))throw new TypeError("Input layers to a Model must be InputLayer objects. Received inputs: "+n.inputs+". Input "+p+" (0-based) originates from layer type "+s.getClassName()+".");r.inputNames.push(s.name),r.feedInputShapes.push(s.batchInputShape),r.feedInputNames.push(s.name)}for(var f=0,d=r.outputLayers;f<d.length;f++)s=d[f],r.outputNames.push(s.name);r.internalInputShapes=r.inputs.map(function(t){return t.shape}),r.internalOutputShapes=r.outputs.map(function(t){return t.shape});for(var g={},v={},m={},y={},b={},w=[],x=function(t,n,i,o,a,s){null!=o&&null!=a&&null!=s||(o=t.sourceLayer,a=t.nodeIndex,s=t.tensorIndex);var u=o.inboundNodes[a];if(-1!==i.indexOf(u))throw new ul("The tensor "+t.name+' at layer "'+o.name+'" is part of a cycle.');if(-1===n.indexOf(u)){r.containerNodes.add(e.nodeKey(o,a)),o.id in b||(b[o.id]=Object.keys(b).length),-1===i.indexOf(u)&&i.push(u);for(var l=u.inboundLayers.length,c=0;c<l;c++){var h=u.inputTensors[c],p=u.inboundLayers[c],f=u.nodeIndices[c],d=u.tensorIndices[c];x(h,n,i,p,f,d)}for(n.push(u);i.indexOf(u)>=0;)i.splice(i.indexOf(u),1);w.push(u)}},S=[],E=[],k=0,C=r.outputs;k<C.length;k++){var R=C[k];x(R,S,E)}for(var I=0,A=w.slice().reverse();I<A.length;I++){v[(J=A[I]).id]=J,J.id in g||(g[J.id]=0);var N=g[J.id],T=null==m[J.outboundLayer.id]?0:m[J.outboundLayer.id];for(N=Math.max(N,T),m[J.outboundLayer.id]=N,y[J.outboundLayer.id]=J.outboundLayer,g[J.id]=N,p=0;p<J.inboundLayers.length;p++){var D=J.inboundLayers[p],z=(u=J.nodeIndices[p],D.inboundNodes[u]),M=null==g[z.id]?0:g[z.id];g[z.id]=Math.max(N+1,M),v[z.id]=z}}var O={};for(var L in g)(N=g[L])in O||(O[N]=[]),O[N].push(v[L]);var F={};for(var _ in m)(N=m[_])in F||(F[N]=[]),F[N].push(y[_]);var B=Object.keys(F).map(function(t){return parseInt(t,10)}).sort(Sl);r.layers=[];for(var P=0,U=B;P<U.length;P++){var W=F[N=U[P]];W.sort(function(t,e){var n=b[t.id],r=b[e.id];return n<r?-1:n>r?1:0});for(var V=0,q=W;V<q.length;V++)s=q[V],r.layers.push(s)}r.layersByDepth=F,B=Object.keys(O).map(function(t){return parseInt(t,10)}).sort(Sl);for(var G=r.inputs.slice(),j=[],H=0,$=B;H<$.length;H++)for(var K=0,X=O[N=$[H]];K<X.length;K++){var J;if(null!=(s=(J=X[K]).outboundLayer)){for(var Y=0,Z=J.inputTensors;Y<Z.length;Y++)if(R=Z[Y],-1===G.indexOf(R))throw new ul("Graph disconnected: cannot obtain value for tensor "+R+' at layer "'+s.name+'". The following previous layers were accessed without issue: '+j);for(var Q=0,tt=J.outputTensors;Q<tt.length;Q++)R=tt[Q],G.push(R);j.push(s.name)}}r.nodesByDepth=O;for(var et=r.layers.map(function(t){return t.name}),nt=function(t){var e=et.filter(function(e){return e===t}).length;if(1!==e)throw new ul('The name "'+t+'" is used '+e+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(et))},rt=0,it=et;rt<it.length;rt++)nt(it[rt]);return r.outboundNodes=[],r.inboundNodes=[],new cc({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map(function(t){return null}),outputMasks:r.outputs.map(function(t){return null}),inputShapes:r.inputs.map(function(t){return t.shape}),outputShapes:r.outputs.map(function(t){return t.shape})}),r.built=!0,r}return $u(e,t),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new ll("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var t=[],e=0,n=this.layers;e<n.length;e++){var r=n[e];t=t.concat(r.trainableWeights)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],e=0,n=this.layers;e<n.length;e++){var r=n[e];t.push.apply(t,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],o=0,a=this.layers;o<a.length;o++)r=a[o],i.push.apply(i,r.trainableWeights);return i.concat(t)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.loadWeights=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1),n?function(t,e){for(var n={},r=0,i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].weights;a<s.length;a++){var u=s[a];if(null!=n[u.originalName])throw new ll("Duplicate weight name: "+u.originalName);n[u.originalName]=u,r++}var l=[];for(var c in t)l.push([n[c],t[c]]),delete n[c];var h=[];for(var p in n)h.push(p);if(h.length>0)throw new ll(h.length+" of "+r+" weights are not set: "+h);ac(l)}(t,this.layers):function(t,e,n){void 0===n&&(n=!1);for(var r=t.keras_version,i=t.backend,o=e.map(function(t){return t.name}),a={},s=0,u=e;s<u.length;s++)null!=(b=u[s]).name&&(null==a[b.name]&&(a[b.name]=[]),a[b.name].push(b));for(var l=t.weights,c=[],h=0;h<o.length;++h){var p=o[h],f=l[p];null==f&&(f=[]);for(var d=[],g=0;g<f.length;++g){var v=f[g];d.push(new ic(vc(v.dtype,v.shape,v.value)))}for(var m=0,y=a[p];m<y.length;m++){var b,w=(b=y[m]).weights;if((d=mc(b,d,r,i)).length!==w.length){if(!n)throw new ll("Layer #"+h+' (named "'+b.name+'") expects '+w.length+" weight(s), but the saved weights have "+d.length+" element(s).");console.warn("Skipping loading of weights of layer "+b.name+" due to mismatch in number of weights: ("+d.length+" vs "+w.length+").")}for(var x=0;x<d.length;++x)!n||_.arraysEqual(w[x].shape,d[x].shape)?c.push([w[x],d[x].read()]):console.warn("Skipping loading of weights for layer "+b.name+" due to mismatch in shape ("+w[x].shape+" vs "+d[x].shape+")")}}ac(c)}(t,this.layers,e)},e.prototype.updatedConfig=function(){var t=this.getConfig();return{className:this.getClassName(),config:t,kerasVersion:"tfjs-layers 0.7.0",backend:"TensorFlow.js"}},e.prototype.toJSON=function(t,e){void 0===e&&(e=!0);var n=function t(e,n){if(null===e||void 0===e)return null;if("string"==typeof e)return ml(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var r=[],i=e.length,o=0;o<i;++o){var a=e[o];Yl(n,o,a)?r.push(a):r.push(t(a,n))}return r}for(var s={},u=0,l=Object.keys(e);u<l.length;u++){var c=l[u],h=e[c];s[ml(c)]="name"!==c&&"className"!==c||"string"!=typeof h?t(h,c):h}return s}(this.updatedConfig());return e?JSON.stringify(n):n},e.prototype.call=function(t,e){var n=this;return pe(function(){var r;return t=vl(t),r="mask"in e?vl(e.mask):pl(null,t.length),n.runInternalGraph(t,r)[0]})},e.prototype.computeMask=function(t,e){var n=this;return pe(function(){var r;return t=vl(t),r=null==e?pl(null,t.length):vl(e),n.runInternalGraph(t,r)[1]})},e.prototype.computeOutputShape=function(t){var e=Ql(t);if(e.length!==this.inputLayers.length)throw new ll("Invalid inputShape argument "+t+": model has "+this.inputLayers.length+" tensor inputs.");for(var n={},r=0;r<e.length;r++){var i=this.inputLayers[r],o=e[r];n[E=i.name+"_0_0"]=o}var a=Object.keys(this.nodesByDepth).map(function(t){return parseInt(t,10)}).sort(Sl);if(a.length>1)for(var s=0,u=a;s<u.length;s++)for(var l=u[s],c=0,h=this.nodesByDepth[l];c<h.length;c++){var p=h[c];if(i=p.outboundLayer,-1===this.inputLayers.map(function(t){return t.id}).indexOf(i.id)){for(var f=[],d=0;d<p.inboundLayers.length;d++){var g=p.inboundLayers[d],v=p.nodeIndices[d],m=p.tensorIndices[d],y=n[E=g.name+"_"+v+"_"+m];f.push(y)}var b=Ql(i.computeOutputShape(gl(f))),w=i.inboundNodes.indexOf(p);for(d=0;d<b.length;d++)n[E=i.name+"_"+w+"_"+d]=b[d]}}var x=[],S=[];for(r=0;r<this.outputLayers.length;r++){i=this.outputLayers[r],w=this.outputLayersNodeIndices[r],m=this.outputLayersTensorIndices[r];var E=i.name+"_"+w+"_"+m;S.push(E)}for(r=0;r<S.length;r++){var k=S[r];fl(k in n),x.push(n[k])}return gl(x)},e.prototype.runInternalGraph=function(t,e){null==e&&(e=pl(null,t.length));for(var n={},r=0;r<this.inputs.length;++r){var i=this.inputs[r],o=t[r],a=e[r];n[i.id]=[o,a]}for(var s=0,u=Object.keys(this.nodesByDepth).map(function(t){return parseInt(t,10)}).sort(Sl);s<u.length;s++)for(var l=u[s],c=0,h=this.nodesByDepth[l];c<h.length;c++){for(var p=h[c],f=p.outboundLayer,d=p.inputTensors,g=p.outputTensors,v=new Array,m=0,y=d;m<y.length;m++)(i=y[m]).id in n&&v.push(n[i.id]);if(v.length===d.length){var b={},w=void 0,x=void 0,S=void 0,E=void 0;if(null!=p.callArgs&&(b=p.callArgs),1===v.length){var k=v[0],C=k[0],R=k[1];null==b.mask&&(b.mask=R),S=vl(f.call(C,b)),E=vl(f.computeMask(C,R)),w=[C],x=[R]}else w=v.map(function(t){return t[0]}),x=v.map(function(t){return t[1]}),null==b.mask&&(b.mask=x),S=vl(f.call(w,b)),E=vl(f.computeMask(w,x));if(f.activityRegularizer)throw new cl("Model invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(r=0;r<g.length;++r)i=g[r],o=S[r],a=E[r],n[i.id]=[o,a]}}for(var I=[],A=[],N=[],T=0,D=this.outputs;T<D.length;T++){fl((i=D[T]).id in n,"Could not compute output "+i.name+" : "+i.id);var z=n[i.id],M=z[0];a=z[1],N.push(M.shape),I.push(M),A.push(a)}return[I,A,N]},e.prototype.buildNodeConversionMap=function(t){for(var n,r={},i=0,o=this.layers;i<o.length;i++){var a=o[i];n=a instanceof e?1:0;for(var s=0;s<a.inboundNodes.length;s++){var u=e.nodeKey(a,s);u in this.containerNodes&&(r[u]=n,n+=1)}}return r},e.prototype.getLayer=function(t,e){if(null!=e){if(this.layers.length<=e)throw new ll("Was asked to retrieve layer at index "+e+", but model only has "+this.layers.length+" layer(s).");return this.layers[e]}if(null==t)throw new ll("Provide either a layer name or layer index");for(var n=0,r=this.layers;n<r.length;n++){var i=r[n];if(i.name===t)return i}throw new ll("No such layer: "+t)},e.prototype.calculateLosses=function(){var t=this;return pe(function(){for(var n=[],r=0,i=t.layers;r<i.length;r++)for(var o=i[r],a=0;a<o.inboundNodes.length;++a){var s=e.nodeKey(o,a);t.containerNodes.has(s)&&n.push.apply(n,o.calculateLosses())}return n})},e.prototype.getConfig=function(){for(var t={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[],i=0,o=this.layers;i<o.length;i++){for(var a=(b=o[i]).getClassName(),s=b.getConfig(),u=[],l=0;l<b.inboundNodes.length;l++){var c=b.inboundNodes[l],h=e.nodeKey(b,l),p={};if(this.containerNodes.has(h)&&(c.callArgs&&(-1===JSON.stringify(c.callArgs).indexOf("undefined")?p=c.callArgs:(console.warn("Layer "+b.name+" was passed non-serializable keyword arguments: "+c.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),p={})),c.inboundLayers.length>0)){for(var f=[],d=0;d<c.inboundLayers.length;d++){var g=c.inboundLayers[d],v=c.nodeIndices[d],m=c.tensorIndices[d];null!==(x=n[e.nodeKey(g,v)])&&void 0!==x||(x=0),f.push([g.name,x,m,p])}u.push(f)}}r.push({name:b.name,className:a,config:s,inboundNodes:u})}t.layers=r;var y=[];for(d=0;d<this.inputLayers.length;d++){var b=this.inputLayers[d];v=this.inputLayersNodeIndices[d],h=e.nodeKey(b,v),this.containerNodes.has(h)&&(null!==(x=n[h])&&void 0!==x||(x=0),m=this.inputLayersTensorIndices[d],y.push([b.name,x,m]))}t.inputLayers=y;var w=[];for(d=0;d<this.outputLayers.length;d++){var x;if(b=this.outputLayers[d],v=this.outputLayersNodeIndices[d],h=e.nodeKey(b,v),this.containerNodes.has(h))null!==(x=n[h])&&void 0!==x||(x=0),m=this.outputLayersTensorIndices[d],w.push([b.name,x,m])}return t.outputLayers=w,t},e.fromConfig=function(t,e){var n={},r={};function i(t,e){t.name in r?r[t.name].push(e):r[t.name]=[e]}function o(t,e){for(var r,o=[],a=0,s=e;a<s.length;a++){var u=s[a],l=u[0],c=u[1],h=u[2];if(3===u.length)r={};else{if(4!==u.length)throw new ll("Improperly formatted model config for layer "+JSON.stringify(t)+": "+JSON.stringify(u));r=u[3]}if(!(l in n))return void i(t,e);var p=n[l];if(p.inboundNodes.length<=c)return void i(t,e);var f=p.inboundNodes[c];o.push(f.outputTensors[h])}o.length>0&&t.apply(gl(o),r)}function a(t){var r=t.name,o=Jl(t,null!=e.customObjects?e.customObjects:{});n[r]=o;for(var a=0,s=t.inboundNodes;a<s.length;a++){var u=s[a];if(!(u instanceof Array))throw new ll("Corrupted configuration, expected array for nodeData: "+u);i(o,u)}}for(var s=e.name,u=e.layers,l=0,c=u;l<c.length;l++)a(f=c[l]);for(;!kl(r);)for(var h=0,p=u;h<p.length;h++){var f=p[h];if((R=n[f.name]).name in r){for(var d=0,g=r[R.name];d<g.length;d++)o(R,g[d]);delete r[R.name]}}for(var v=[],m=[],y=0,b=e.inputLayers;y<b.length;y++){var w=(f=b[y])[0],x=f[1],S=f[2];fl(w in n);var E=(R=n[w]).inboundNodes[x].outputTensors;v.push(E[S])}for(var k=0,C=e.outputLayers;k<C.length;k++){var R;w=(f=C[k])[0],x=f[1],S=f[2],fl(w in n),E=(R=n[w]).inboundNodes[x].outputTensors,m.push(E[S])}return new t({inputs:v,outputs:m,name:s})},Object.defineProperty(e.prototype,"stateful",{get:function(){if(this._stateful)throw new ll("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var t=0,e=this.layers;t<e.length;t++)if(e[t].stateful)return!0;return!1},enumerable:!0,configurable:!0}),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"getLayer",null),e}(pc);function vc(t,e,n){var r=function(t){switch(t){case"float32":return"float32";default:throw new ll("Invalid dtype: "+t)}}(t);return $.make(e,{values:0===e.length?n:_.flatten(n)},r)}function mc(t,e,n,r){if(!n.startsWith("2."))throw new ll("Unsupported Keras version in weights being loaded: "+n);return e}function yc(t){return t===parseInt(t.toString(),10)}function bc(t,e,n){null==e&&(e=0),null==n&&(n=t.length);for(var r=1,i=e;i<n;++i)r*=t[i];return r}function wc(t){return t=Array.isArray(t)?new Float32Array(t):t,Ai(t)}function xc(t){return Dn(wc(t)).dataSync()[0]}function Sc(t){return Nn(wc(t)).dataSync()[0]}function Ec(t,e){if(e<t)throw new ll("end ("+e+") < begin ("+t+") is forbidden.");for(var n=[],r=t;r<e;++r)n.push(r);return n}function kc(t,e){return t.asType(e)}function Cc(t,e){void 0===e&&(e=-1);var n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),t.reshape(n)}function Rc(t,e,n){return pe(function(){switch(t.rank){case 1:return xn(t,e,n);case 2:return Sn(t,[e,0],[n,t.shape[1]]);case 3:return En(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return kn(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);default:throw new ll("sliceAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}})}function Ic(t,e,n){return pe(function(){switch(t.rank){case 1:return xn(t,e,n);case 2:return Sn(t,[0,e],[t.shape[0],n]);case 3:return En(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return kn(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new ll("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function Ac(t,e,n,r){return pe(function(){switch(t.rank){case 1:return xn(t,e,n);case 2:switch(r){case 1:return Rc(t,e,n);case 2:return Ic(t,e,n);default:throw new ll("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return Rc(t,e,n);case 2:return En(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Ic(t,e,n);default:throw new ll("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return Rc(t,e,n);case 2:return kn(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return kn(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Ic(t,e,n);default:throw new ll("The axis is not within the rank of the tensor "+r)}default:throw new ll("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function Nc(t,e){var n;return void 0===e&&(e=-1),e<0&&(e=0!==(n=t[0].rank)?n:0),e===t[0].rank&&(e=-1),Je(t,e)}function Tc(t,e){switch(t.rank){case 1:return Ye([t,e]);case 2:return Ze([t,e],0);case 3:return Qe([t,e],0);case 4:return tn([t,e],0);default:throw new ll("concatAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}}function Dc(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new ll("The length of input n ("+e.length+") does not match the number of dimensions in input x ("+t.rank+")");return bi(t,e)}function zc(t,e,n,r,i){return void 0===e&&(e=0),void 0===n&&(n=1),fi(t,e,n,r,i)}function Mc(t,e){if(2!==e.rank)throw new cl("dot support for y other than rank 2 is not yet implemented: y shape = "+e.shape);if(2===t.rank)return sn(t,e);if(3===t.rank){var n=t.shape[0],r=t.shape[1],i=t.shape[2];return t=t.reshape([n*r,i]),sn(t,e).reshape([n,r,e.shape[1]])}throw new cl("dot support for x of rank "+t.rank+" is not yet implemented: x shape = "+t.shape)}function Oc(t,e,n){return pe(function(){return e=Array.isArray(e)?Ai(e,"int32"):e.toInt(),wi(t,e,n)})}function Lc(t){return Xr(t,t)}function Fc(t,e,n){return pe(function(){if(null==n&&(n="channelsLast"),Pl(n),1!==e.rank&&e.rank!==t.rank)throw new ll("Unexpected bias dimensions: "+e.rank+"; expected it to be 1 or "+t.rank);var r,i=e.shape;if(5===t.rank)"channelsFirst"===n?r=1===i.length?t.add(e.reshape([1,i[0],1,1,1])):t.add(e.reshape([1,i[3],i[0],i[1],i[2]])):"channelsLast"===n&&(r=1===i.length?t.add(e.reshape([1,1,1,1,i[0]])):t.add(e.reshape([1].concat(i))));else if(4===t.rank)"channelsFirst"===n?r=1===i.length?t.add(e.reshape([1,i[0],1,1])):t.add(e.reshape([1,i[2],i[0],i[1]])):"channelsLast"===n&&(r=1===i.length?t.add(e.reshape([1,1,1,i[0]])):t.add(e.reshape([1].concat(i))));else if(3===t.rank)"channelsFirst"===n?r=1===i.length?t.add(e.reshape([1,i[0],1])):t.add(e.reshape([1,i[1],i[0]])):"channelsLast"===n&&(r=1===i.length?t.add(e.reshape([1,1,i[0]])):t.add(e.reshape([1].concat(i))));else{if(!(t.rank<3))throw new ll("Unsupported input rank by biasAdd: "+t.rank);r=t.add(e)}return r})}function _c(t){return Ju(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return Yu(this,function(l){switch(l.label){case 0:if(null==t)return[2];for(i in e=[],n=[],r=[],t)"number"!=typeof(o=t[i])&&(a=o,e.push(a.data()),n.push(i),r.push(a));return[4,Promise.all(e)];case 1:for(s=l.sent(),u=0;u<s.length;++u)t[n[u]]=s[u][0];return de(r),[2]}})})}var Bc=function(){function t(){this.validationData=null}return t.prototype.setParams=function(t){this.params=t},t.prototype.onEpochBegin=function(t,e){return Ju(this,void 0,void 0,function(){return Yu(this,function(t){return[2]})})},t.prototype.onEpochEnd=function(t,e){return Ju(this,void 0,void 0,function(){return Yu(this,function(t){return[2]})})},t.prototype.onBatchBegin=function(t,e){return Ju(this,void 0,void 0,function(){return Yu(this,function(t){return[2]})})},t.prototype.onBatchEnd=function(t,e){return Ju(this,void 0,void 0,function(){return Yu(this,function(t){return[2]})})},t.prototype.onTrainBegin=function(t){return Ju(this,void 0,void 0,function(){return Yu(this,function(t){return[2]})})},t.prototype.onTrainEnd=function(t){return Ju(this,void 0,void 0,function(){return Yu(this,function(t){return[2]})})},t.prototype.setModel=function(t){},t}(),Pc=function(){function t(t,e){void 0===e&&(e=10),null==t&&(t=[]),this.callbacks=t,this.queueLength=e}return t.prototype.append=function(t){this.callbacks.push(t)},t.prototype.setParams=function(t){for(var e=0,n=this.callbacks;e<n.length;e++)n[e].setParams(t)},t.prototype.setModel=function(t){for(var e=0,n=this.callbacks;e<n.length;e++)n[e].setModel(t)},t.prototype.onEpochBegin=function(t,e){return Ju(this,void 0,void 0,function(){var n,r;return Yu(this,function(i){switch(i.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onEpochBegin(t,e)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onEpochEnd=function(t,e){return Ju(this,void 0,void 0,function(){var n,r;return Yu(this,function(i){switch(i.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onEpochEnd(t,e)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onBatchBegin=function(t,e){return Ju(this,void 0,void 0,function(){var n,r;return Yu(this,function(i){switch(i.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onBatchBegin(t,e)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onBatchEnd=function(t,e){return Ju(this,void 0,void 0,function(){var n,r;return Yu(this,function(i){switch(i.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onBatchEnd(t,e)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onTrainBegin=function(t){return Ju(this,void 0,void 0,function(){var e,n;return Yu(this,function(r){switch(r.label){case 0:null==t&&(t={}),e=0,n=this.callbacks,r.label=1;case 1:return e<n.length?[4,n[e].onTrainBegin(t)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t.prototype.onTrainEnd=function(t){return Ju(this,void 0,void 0,function(){var e,n;return Yu(this,function(r){switch(r.label){case 0:null==t&&(t={}),e=0,n=this.callbacks,r.label=1;case 1:return e<n.length?[4,n[e].onTrainEnd(t)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t}(),Uc=function(t){function e(){return t.call(this)||this}return $u(e,t),e.prototype.onEpochBegin=function(t,e){return Ju(this,void 0,void 0,function(){return Yu(this,function(t){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,e){return Ju(this,void 0,void 0,function(){var t,n,r,i,o=this;return Yu(this,function(a){for(i in null==e&&(e={}),t=null==e.size?0:e.size,this.seen+=t,n=function(n){var i=e[n];if("number"==typeof i)r.totals.hasOwnProperty(n)||(r.totals[n]=0),r.totals[n]=r.totals[n]+i*t;else{var a=void 0;n in r.totals?a=r.totals[n]:r.totals[n]=al(0),r.totals[n]=pe(function(){return Fr(o.totals[n],Kr(i,al(t)))}),null!=a&&a.dispose()}},r=this,e)n(i);return[2]})})},e.prototype.onEpochEnd=function(t,e){return Ju(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return Yu(this,function(s){if(null!=e)for(t=function(t){if(null==n.totals[t])return"continue";"number"==typeof n.totals[t]?e[t]=n.totals[t]/n.seen:pe(function(){e[t]=Kr(Pr(al(1),al(a.seen)),a.totals[t]),a.totals[t].dispose(),fe(e[t])})},n=this,r=0,i=this.params.metrics;r<i.length;r++)o=i[r],t(o);return[2]})})},e}(Bc),Wc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.onTrainBegin=function(t){return Ju(this,void 0,void 0,function(){return Yu(this,function(t){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,e){return Ju(this,void 0,void 0,function(){var n;return Yu(this,function(r){for(n in null==e&&(e={}),this.epoch.push(t),e)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(e[n]);return[2]})})},e.prototype.syncData=function(){return Ju(this,void 0,void 0,function(){var t,e,n,r,i,o,a,s,u;return Yu(this,function(l){switch(l.label){case 0:for(r in t=[],e=[],n=[],this.history)for(i=this.history[r],o=0;o<i.length;++o)"number"!=typeof i[o]&&(a=i[o],t.push(a.data()),e.push(r),n.push(o));return[4,Promise.all(t)];case 1:for(s=l.sent(),u=0;u<s.length;++u)this.history[e[u]][n[u]].dispose(),this.history[e[u]][n[u]]=s[u][0];return[2]}})})},e}(Bc),Vc=function(t){function e(e){var n=t.call(this)||this;return n.trainBegin=e.onTrainBegin,n.trainEnd=e.onTrainEnd,n.epochBegin=e.onEpochBegin,n.epochEnd=e.onEpochEnd,n.batchBegin=e.onBatchBegin,n.batchEnd=e.onBatchEnd,n}return $u(e,t),e.prototype.onEpochBegin=function(t,e){return Ju(this,void 0,void 0,function(){return Yu(this,function(n){switch(n.label){case 0:return null==this.epochBegin?[3,3]:[4,_c(e)];case 1:return n.sent(),[4,this.epochBegin(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,e){return Ju(this,void 0,void 0,function(){return Yu(this,function(n){switch(n.label){case 0:return null==this.epochEnd?[3,3]:[4,_c(e)];case 1:return n.sent(),[4,this.epochEnd(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onBatchBegin=function(t,e){return Ju(this,void 0,void 0,function(){return Yu(this,function(n){switch(n.label){case 0:return null==this.batchBegin?[3,3]:[4,_c(e)];case 1:return n.sent(),[4,this.batchBegin(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,e){return Ju(this,void 0,void 0,function(){return Yu(this,function(n){switch(n.label){case 0:return null==this.batchEnd?[3,3]:[4,_c(e)];case 1:return n.sent(),[4,this.batchEnd(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onTrainBegin=function(t){return Ju(this,void 0,void 0,function(){return Yu(this,function(e){switch(e.label){case 0:return null==this.trainBegin?[3,3]:[4,_c(t)];case 1:return e.sent(),[4,this.trainBegin(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return Ju(this,void 0,void 0,function(){return Yu(this,function(e){switch(e.label){case 0:return null==this.trainEnd?[3,3]:[4,_c(t)];case 1:return e.sent(),[4,this.trainEnd(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e}(Bc);function qc(t,e){return pe(function(){var n=Ln(Lc(t),e,!0),r=Kr(Ii(Qu()),ui(t)),i=Nr(Vr(n,r));return Pr(t,i)})}function Gc(t,e){return pe(function(){return Tn(Lc(Zr(e,t)),-1)})}function jc(t,e){return pe(function(){return Tn(Qn(Zr(e,t)),-1)})}function Hc(t,e){return pe(function(){var n=Zr(t,e),r=sr(Qn(t),Qu(),Number.MAX_VALUE),i=Qn(Pr(n,r));return Kr(al(100),Tn(i,-1))})}function $c(t,e){return pe(function(){var n=al(1),r=sr(e,Qu(),Number.MAX_VALUE),i=vr(Fr(n,r)),o=sr(t,Qu(),Number.MAX_VALUE),a=vr(Fr(n,o));return Tn(Lc(Zr(i,a)),-1)})}function Kc(t,e){return pe(function(){var n=al(0),r=al(1),i=Vr(n,Zr(r,Kr(t,e)));return Tn(Lc(i),-1)})}function Xc(t,e){return pe(function(){var n=al(0),r=al(1),i=Vr(n,Zr(r,Kr(t,e)));return Tn(i,-1)})}function Jc(t,e){return pe(function(){var n=al(0),r=al(1),i=Ln(Kr(t,e),-1),o=Nn(Kr(Zr(r,t),e),-1);return Vr(n,Fr(r,Zr(o,i)))})}function Yc(t,e){return pe(function(){var n=al(Math.log(2)),r=Zr(e,t),i=Zr(Fr(r,Ar(Kr(al(-2),r))),n);return Tn(i,-1)})}function Zc(t,e,n){return void 0===n&&(n=!1),pe(function(){if(n)e=Xi(e);else{var r=Ln(e,e.shape.length-1,!0);e=Pr(e,r)}return e=sr(e,Qu(),1-Qu()),br(Ln(Kr(t.toFloat(),vr(e)),e.shape.length-1))})}function Qc(t,e,n){return void 0===n&&(n=!1),pe(function(){var r=fr(function(t){var e=[bc(t.shape)];return t.reshape(e)}(t)).toInt(),i=e.shape;return Zc(xi(r,i[i.length-1]).reshape(i),e,n)})}function th(t,e){return pe(function(){var n;return n=sr(e,Qu(),1-Qu()),n=vr(Pr(n,Zr(ui(n),n))),Tn(function(t,e){return pe(function(){var n=Vr(e,ci(e)),r=Kr(e,t),i=vr(Fr(al(1),hr(br(Qn(e)))));return Fr(Zr(n,r),i)})}(t,n),-1)})}function eh(t,e){return pe(function(){var n=sr(t,Qu(),1),r=sr(e,Qu(),1);return Ln(Kr(t,vr(Pr(n,r))),-1)})}function nh(t,e){return pe(function(){var n=vr(Fr(al(Qu()),e));return Tn(Zr(e,Kr(t,n)),-1)})}function rh(t,e){return pe(function(){var n=qc(t,-1),r=qc(e,-1),i=Kr(n,r);return br(Ln(i,-1))})}function ih(t){var e={meanSquaredError:Gc,meanAbsoluteError:jc,meanAbsolutePercentageError:Hc,meanSquaredLogarithmicError:$c,squaredHinge:Kc,hinge:Xc,categoricalHinge:Jc,logcosh:Yc,categoricalCrossentropy:Zc,sparseCategoricalCrossentropy:Qc,binaryCrossentropy:th,kullbackLeiblerDivergence:eh,poisson:nh,cosineProximity:rh};if("string"==typeof t){if(t in e)return e[t];throw new ll("Unknown loss "+t)}return t}function oh(t,e){return pe(function(){var n=Kr(al(.5),ui(e)),r=kc(Bn(e,n),t.dtype);return Tn(Fn(t,r),-1)})}function ah(t,e){return pe(function(){return kc(Fn(Rn(t,-1),Rn(e,-1)),"float32")})}function sh(t,e){return th(t,e)}function uh(t,e){throw new cl}var lh=Gc,ch=Gc,hh=jc,ph=jc,fh=Hc,dh=Hc,gh=Zc,vh=rh,mh=Qc;function yh(t,e,n){void 0===n&&(n=console.log);for(var r="",i=0;i<t.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=t[i]).slice(0,e[i]),r+=" ".repeat(e[i]-r.length);n(r)}function bh(t,e,n){var r;try{r=JSON.stringify(t.outputShape)}catch(t){r="multiple"}yh([t.name+" ("+t.getClassName()+")",r,t.countParams().toString()],e,n)}function wh(t,e,n,r){var i;try{i=JSON.stringify(t.outputShape)}catch(t){i="multiple"}for(var o=[],a=0,s=t.inboundNodes;a<s.length;a++){var u=s[a];if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(var l=0;l<u.inboundLayers.length;++l){var c=u.inboundLayers[l].name,h=u.nodeIndices[l],p=u.tensorIndices[l];o.push(c+"["+h+"]["+p+"]")}}var f=t.name,d=t.getClassName(),g=0===o.length?"":o[0];for(yh([f+" ("+d+")",i,t.countParams().toString(),g],e,r),l=1;l<o.length;++l)yh(["","","",o[l]],e,r)}var xh,Sh=function(){function t(e){if(this.id2Value={},e instanceof t)for(var n in e.id2Value)this.id2Value[n]=e.id2Value[n];else{if(null==e)return;for(var r=0,i=e;r<i.length;r++){var o=i[r];this.add(o.key,o.value)}}}return t.prototype.add=function(t,e){if(function(t,e){if(null!=t.dtype&&t.dtype!==e.dtype)throw new ll("The dtype of the feed ("+e.dtype+") is incompatible with that of the key '"+t.name+"' ("+t.dtype+").");if(null!=t.shape){if(t.shape.length!==e.shape.length)throw new ll("The rank of feed ("+e.shape.length+") does not match the rank of the key ("+t.shape.length+").");for(var n=0;n<t.shape.length;++n)if(null!=t.shape[n]&&t.shape[n]!==e.shape[n])throw new ll("The "+n+"-th dimension of the feed ("+e.shape[n]+") is incompatible with that of the key ("+t.shape[n]+").")}}(t,e),null!=this.id2Value[t.id])throw new ll("Duplicate key: name="+t.name+", id="+t.id);return this.id2Value[t.id]=e,this},t.prototype.addFeed=function(t){this.add(t.key,t.value)},t.prototype.hasKey=function(t){return null!=this.id2Value[t.id]},t.prototype.getValue=function(t){if(null==this.id2Value[t.id])throw new ll("Nonexistent key: "+JSON.stringify(t));return this.id2Value[t.id]},t}();function Eh(t,e,n){for(var r=Array.isArray(t),i=r?t:[t],o=[],a=new Sh(e),s=0,u=i;s<u.length;s++){var l=u[s];o.push(kh(l,a,n))}return r?o:o[0]}function kh(t,e,n){if(e.hasKey(t))return e.getValue(t);if(t.sourceLayer instanceof fc)throw new ll("Missing a feed value for SymbolicTensor from InputLayer '"+fc.name+"'");for(var r=[],i=0,o=t.inputs;i<o.length;i++){var a=kh(o[i],e,n);r.push(a)}var s=t.sourceLayer.apply(r,n);Array.isArray(s)||(s=[s]);for(var u=function(t){var e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{for(var n=null,r=0;r<t.sourceLayer.inboundNodes.length;++r)for(var i=0,o=t.sourceLayer.inboundNodes[r].outputTensors;i<o.length;i++)if(o[i].id===t.id){n=r;break}e=t.sourceLayer.getOutputAt(n)}return e}(t),l=Array.isArray(u)?u:[u],c=0;c<l.length;++c)e.add(l[c],s[c]);return 1===s.length?s[0]:s[t.outputTensorIndex]}function Ch(t){return Array.isArray(t)}function Rh(t){return!function(t){return t instanceof $}(t)&&!Ch(t)}function Ih(t,e,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=""),null==e||0===e.length){if(null!=t){var o=!1;if(Ch(t)&&t.length>0)o=!0;else if(Rh(t)){for(var a in t)if(t.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new ll("Error when checking model "+i+" expected no data, but got "+t)}return[]}if(null==t)return e.map(function(t){return null});var s;if(Rh(t)){t=t,s=[];for(var u=0,l=e;u<l.length;u++){var c=l[u];if(null==t[c])throw new ll('No data provided for "'+c+'". Need data for each key in: '+e);s.push(t[c])}}else if(Ch(t)){if((t=t).length!==e.length)throw new ll("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+e.length+" Tensor(s), but instead got the following list of Tensor(s): "+t);s=t}else{if(t=t,e.length>1)throw new ll("The model "+i+" expects "+e.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+t.shape);s=[t]}for(var h=0;h<e.length;++h)1===(p=s[h]).shape.length&&(s[h]=Cc(p,1));if(null!=n)for(h=0;h<e.length;++h)if(null!=n[h]){var p;if((p=s[h]).shape.length!==n[h].length)throw new ll("Error when checking "+i+": expected "+e[h]+" to have "+n[h].length+" dimension(s). but got array with shape "+p.shape);for(var f=0;f<n[h].length;++f)if(0!==f||r){var d=p.shape[f],g=n[h][f];if(null!=g&&g>=0&&d!==g)throw new ll("Error when checking "+i+": expected "+e[h]+" to have shape ["+n[h]+"], but got array with shape ["+p.shape+"].")}}return s}function Ah(t,e){for(var n=[],r=0,i=null;r<t;)(i=r+e)>=t&&(i=t),n.push([r,i]),r=i;return n}function Nh(t,e,n){return null==t?[null]:Array.isArray(t)?t.map(function(t){return Rc(t,e,n-e)}):Rc(t,e,n-e)}function Th(t,e){return pe(function(){return null==t?null:Array.isArray(t)?t.map(function(t){return Th(t,e)}):Oc(t,"int32"===e.dtype?e:e.toInt())})}function Dh(t,e,n,r,i){var o;if(void 0===r&&(r=!0),void 0===i&&(i=""),Array.isArray(t)){if(t.length!==e.length)throw new ll("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+e.length+" Tensor(s), but instead got "+t.length+" Tensors(s).");o=t}else{if(e.length>1)throw new ll("The model expects "+e.length+" "+i+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(t.shape)+".");o=[t]}if(null!=n)for(var a=0;a<e.length;++a)if(null!=n[a]){var s=o[a];if(s.shape.length!==n[a].length)throw new ll("Error when checking "+i+": expected "+e[a]+" to have "+n[a].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<n[a].length;++u)if(0!==u||r){var l=s.shape[u],c=n[a][u];if(null!=c&&c!==l)throw new ll("Error when checking "+i+": expected "+e[a]+" to have shape "+JSON.stringify(n[a])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}!function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(xh||(xh={}));var zh=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.summary=function(t,e,n){if(void 0===n&&(n=console.log),!this.built)throw new ll("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(t,e,n,r){void 0===r&&(r=console.log);var i,o=function(t){var e=!0,n=[],r=[];for(var i in t.nodesByDepth)n.push(t.nodesByDepth[i]);for(var o=0,a=n;o<a.length;o++){var s=a[o];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){e=!1;break}r.push.apply(r,s)}if(e)for(var u=0,l=t.layers;u<l.length;u++){for(var c=!1,h=0,p=l[u].inboundNodes;h<p.length;h++){var f=p[h];if(-1!==r.indexOf(f)){if(c){e=!1;break}c=!0}}if(!e)break}return e}(t),a=["Layer (type)","Output shape","Param #"];if(o?(e=e||65,n=n||[.45,.85,1]):(e=e||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map(function(t){return Math.floor(e*t)})),!o)for(var s in a.push("Receives inputs"),i=[],t.nodesByDepth)i.push.apply(i,t.nodesByDepth[s]);r("_".repeat(e)),yh(a,n,r),r("=".repeat(e));for(var u,l=t.layers,c=0;c<l.length;++c)o?bh(l[c],n,r):wh(l[c],n,i,r),r((c===l.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency(),u=null!=t.collectedTrainableWeights?nc(t.collectedTrainableWeights):nc(t.trainableWeights);var h=nc(t.nonTrainableWeights);r("Total params: "+(u+h)),r("Trainable params: "+u),r("Non-trainable params: "+h),r("_".repeat(e))}(this,t,e,n)},e.prototype.compile=function(t){var e=this;if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer=function(t){var e={Adagrad:function(){return Uu.adagrad(.01)},Adadelta:function(){return Uu.adadelta(1,.95,Qu())},Adam:function(){return Uu.adam(.001,.9,.999,Qu())},Adamax:function(){return Uu.adamax(.002,.9,.999,Qu(),0)},RMSProp:function(){return Uu.rmsprop(.001,.9,0,Qu())},SGD:function(){return Uu.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new ll("Unknown Optimizer "+t)}(t.optimizer);else{if(!(t.optimizer instanceof Au))throw new ll("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer=t.optimizer}var n=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new ll("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+t.loss+".");var r=t.loss;n=r.map(function(t){return ih(t)})}else{var i=ih(t.loss);this.outputs.map(function(t){n.push(i)})}else{for(var o in t.loss=t.loss,t.loss)if(-1===this.outputNames.indexOf(o))throw new ll('Unknown entry in loss dictionary: "'+o+'". Only expect the following keys: '+this.outputNames);for(var a in this.outputNames)null==t.loss[a]&&console.warn('Output "'+a+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+a+" during training"),n.push(ih(t.loss[a]))}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var s=0;s<this.outputs.length;++s){var u=this.internalOutputShapes[s],l=this.outputNames[s];this.feedOutputNames.push(l),this.feedOutputShapes.push(u),this.feedLossFns.push(this.lossFunctions[s])}var c=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],jl("loss",function(){for(var t=0;t<e.outputs.length;++t)if(-1===c.indexOf(t)){var n=e.lossFunctions[t];e.outputs.length>1&&(e.metricsTensors.push([n,t]),e.metricsNames.push(e.outputNames[t]+"_loss"))}});var h=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map(function(t){return[]});if(Array.isArray(t))return e.map(function(e){return t});if(null!=t){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r],a=t.hasOwnProperty(o)?t[o]:[];Array.isArray(a)||(a=[a]),n.push(a)}return n}throw new TypeError("Type of metrics argument not understood. Expected an Array or Object, found: "+t)}(t.metrics,this.outputNames);jl("metric",function(){for(var t=function(t){if(-1!==c.indexOf(t))return"continue";!function(n){for(var r,i,o,a=function(n){if(-1!==["accuracy","acc","crossentropy","ce"].indexOf(n)){var a=e.internalOutputShapes[t];1===a[a.length-1]||e.lossFunctions[t]===th?-1!==["accuracy","acc"].indexOf(n)?i=oh:-1!==["crossentropy","ce"].indexOf(n)&&(i=sh):e.lossFunctions[t]===Qc?-1!==["accuracy","acc"].indexOf(n)?i=uh:-1!==["crossentropy","ce"].indexOf(n)&&(i=mh):-1!==["accuracy","acc"].indexOf(n)?i=ah:-1!==["crossentropy","ce"].indexOf(n)&&(i=gh);var s=void 0;-1!==["accuracy","acc"].indexOf(n)?s="acc":-1!==["crossentropy","ce"].indexOf(n)&&(s="ce"),o=i,r=""+s}else{var u=function(t){var e={binaryAccuracy:oh,categoricalAccuracy:ah,categoricalCrossentropy:gh,sparseCategoricalCrossentropy:mh,mse:lh,MSE:ch,mae:hh,MAE:ph,mape:fh,MAPE:dh,cosine:vh};if("string"==typeof t&&t in e)return e[t];if("string"!=typeof t&&null!=t)return t;throw new ll("Unknown metric "+t)}(n);o=u,r=""+n}var l;jl(r,function(){l=o}),function(t,n,r){e.outputNames.length>1&&(n=e.outputNames[t]+"_"+n),e.metricsNames.push(n),e.metricsTensors.push([r,t])}(t,r,l)},s=0,u=h[t];s<u.length;s++)a(u[s])}()},n=0;n<e.outputs.length;++n)t(n)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,e,n){void 0===n&&(n={});var r=null==n.batchSize?32:n.batchSize,i=this.standardizeUserData(t,e,!0,r),o=i[0].concat(i[1]);this.makeTestFunction();var a=this.testFunction;return gl(this.testLoop(a,o,r,n.verbose,n.steps))},e.prototype.checkNumSamples=function(t,e,n,r){var i;if(void 0===r&&(r="steps"),null!=n){if(i=null,null!=e)throw new ll("If "+r+" is set, batchSize must be null or undefined.Got batchSize = "+e)}else{if(null==t)throw new ll("Either the input data should have a defined shape, or "+r+" shoud be specified.");i=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return i},e.prototype.execute=function(t,e){if(Array.isArray(e)&&0===e.length)throw new ll("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(e),r=n?e:[e],i=this.retrieveSymbolicTensors(r),o=new Sh;if(t instanceof $&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new ll("The number of inputs provided ("+t.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var a=0;a<this.inputs.length;++a)o.add(this.inputs[a],t[a])}else for(var s=0,u=this.inputs;s<u.length;s++){var l=u[s],c=t[l.name];if(null==c)throw new ll("No value is provided for the model's input "+l.name);o.add(l,c)}var h=Eh(i,o);return n?h:h[0]},e.prototype.retrieveSymbolicTensors=function(t){for(var e=pl(null,t.length),n=t.length,r=0,i=this.layers;r<i.length;r++){for(var o=i[r],a=Array.isArray(o.output)?o.output:[o.output],s=a.map(function(t){return t.name}),u=0;u<t.length;++u){var l=s.indexOf(t[u]);if(-1!==l&&(e[u]=a[l],n--),0===n)break}if(0===n)break}if(n>0){var c=[];throw e.forEach(function(e,n){null==e&&c.push(t[n])}),new ll("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(c))}return e},e.prototype.predictLoop=function(t,e,n){var r=this;return void 0===e&&(e=32),void 0===n&&(n=!1),pe(function(){var i=r.checkNumSamples(t);if(n)throw new cl("Verbose predictLoop() is not implemented yet.");for(var o=Ah(i,e),a=[],s=function(e){var n=pe(function(){var n=o[e][0],i=o[e][1],a=Nh(t,n,i),s=[];if(Array.isArray(a))for(var u=0;u<a.length;++u)s.push({key:r.inputs[u],value:a[u]});else s.push({key:r.inputs[0],value:a});var l=new Sh(s);return Eh(r.outputs,l)});if(0===e)for(var i=0,s=n;i<s.length;i++){var u=s[i];a.push(u)}else for(var l=0;l<n.length;++l)a[l]=Tc(a[l],n[l])},u=0;u<o.length;++u)s(u);return gl(a)})},e.prototype.predict=function(t,e){void 0===e&&(e={}),Dh(t,this.inputNames,this.feedInputShapes,!1);var n=null==e.batchSize?32:e.batchSize;return this.predictLoop(t,n)},e.prototype.predictOnBatch=function(t){return Dh(t,this.inputNames,this.feedInputShapes,!0),this.predictLoop(t,t.shape[0])},e.prototype.standardizeUserData=function(t,e,n,r){if(void 0===n&&(n=!0),null==this.optimizer)throw new ul("You must compile a model before training/testing. Use Model.compile(modelCompileConfig).");for(var i=[],o=0;o<this.feedOutputShapes.length;++o){var a=this.feedOutputShapes[o];this.feedLossFns[o]===Qc?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(function(t,e,n){var r=El(t.map(function(t){return t.shape[0]}));r.sort();var i=El(e.map(function(t){return t.shape[0]}));if(i.sort(),r.length>1)throw new ll("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(function(t){return t.shape})));if(i.length>1)throw new ll("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(function(t){return t.shape})));if(r.length>0&&i.length>0&&!_.arraysEqual(r,i))throw new ll("Input Tensors should have the same number of samples as target Tensors. Found "+r[0]+" input sample(s) and "+i[0]+" target sample(s).")}(t=Ih(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=Ih(e,this.feedOutputNames,i,!1,"target")),function(t,e,n){for(var r=[Gc,th,Zc],i=0;i<t.length;++i){var o=t[i],a=e[i],s=n[i];if(null!=a){if(a===Zc&&1===o.shape[o.shape.length-1])throw new ll("You are passing a target array of shape "+o.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(a))for(var u=o.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var h=u[c],p=l[c];if(null!=p&&h!==p)throw new ll("A target Tensor with shape "+o.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&t[0].shape[0]%r!=0)throw new ll("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+r+". Found: "+t[0].shape[0]+" sample(s).");return[t,e,null]},e.prototype.fitLoop=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f){return void 0===h&&(h=0),Ju(this,void 0,void 0,function(){var d,g,v,m,y,b,w,x=this;return Yu(this,function(S){switch(S.label){case 0:if(null==r&&(r=32),null==i&&(i=1),null==l&&(l=!0),null==h&&(h=0),d=!1,null!=s&&null!=u&&(d=!0),null!=f&&(d=!0,null==p))throw new ll("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");if(null!=(g=this.checkNumSamples(e,r,p,"steps_per_epoch"))&&(v=Ec(0,g)),this.history=new Wc,a=(a=null==a?[new Uc]:[new Uc].concat(a)).concat([this.history]),o>0)throw new cl("Verbose mode is not implemented yet.");return(m=new Pc(a)).setModel(this),m.setParams({epochs:i,steps:p,verbose:o,doValidation:d,metrics:c}),[4,m.onTrainBegin()];case 1:S.sent(),this.stopTraining=!1,y=function(i){var o,a,c,h,f;return Yu(this,function(y){switch(y.label){case 0:return[4,m.onEpochBegin(i)];case 1:if(y.sent(),o={},null==p)return[3,2];throw new cl("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===l)throw new cl("batch shuffling is not implemneted yet");l&&_.shuffle(v),a=Ai(v),c=Ah(g,r),h=function(i){var l;return Yu(this,function(h){switch(h.label){case 0:return l={},[4,m.onBatchBegin(i,l)];case 1:return h.sent(),pe(function(){var h=c[i][0],p=c[i][1],f=Rc(a,h,p-h);l.batch=i,l.size=p-h;for(var g=Th(e,f),v=t(g),m=0;m<n.length;++m){var y=n[m],b=v[m];l[y]=b,fe(b)}if(i===c.length-1&&d){var w=x.testLoop(s,u,r);for(m=0;m<n.length;++m)y=n[m],b=w[m],fe(b),o["val_"+y]=b}}),[4,m.onBatchEnd(i,l)];case 2:return h.sent(),function(t){if(null!=t)for(var e in t){var n=t[e];"number"!=typeof n&&n.dispose()}}(l),b.stopTraining?[2,"break"]:[2]}})},f=0,y.label=3;case 3:return f<c.length?[5,h(f)]:[3,6];case 4:if("break"===y.sent())return[3,6];y.label=5;case 5:return++f,[3,3];case 6:a.dispose(),y.label=7;case 7:return[4,m.onEpochEnd(i,o)];case 8:return y.sent(),b.stopTraining?[2,"break"]:[2]}})},b=this,w=h,S.label=2;case 2:return w<i?[5,y(w)]:[3,5];case 3:if("break"===S.sent())return[3,5];S.label=4;case 4:return++w,[3,2];case 5:return[4,m.onTrainEnd()];case 6:return S.sent(),[4,this.history.syncData()];case 7:return S.sent(),[2,this.history]}})})},e.prototype.testLoop=function(t,e,n,r,i){var o=this;return void 0===r&&(r=0),pe(function(){var a=o.checkNumSamples(e,n,i,"steps"),s=[];if(1===r)throw new cl("Verbose mode is not implemented yet.");if(null!=i)throw new cl("steps mode in testLoop() is not implemented yet");for(var u=Ah(a,n),l=Ai(Ec(0,a)),c=0;c<u.length;++c){var h=u[c][0],p=u[c][1],f=Rc(l,h,p-h),d=Th(e,f),g=t(d);if(0===c)for(var v=0;v<g.length;++v)s.push(al(0));for(v=0;v<g.length;++v){var m=g[v];s[v]=Fr(s[v],Kr(al(p-h),m))}}for(v=0;v<s.length;++v)s[v]=Pr(s[v],al(a));return s})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,e=[],n=0;n<t.length;++n){var r=t[n],i=r;dl(t,r)>1&&(i+="_"+dl(t.slice(0,n),r)),e.push(i)}return e},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(e){return pe(function(){for(var n,r=[],i=e.slice(0,t.inputs.length),o=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),a=[],s=0;s<t.inputs.length;++s)a.push({key:t.inputs[s],value:i[s]});var u=new Sh(a),l=Eh(t.outputs,u);for(s=0;s<t.lossFunctions.length;++s){var c=t.lossFunctions[s],h=Tn(c(o[s],l[s]));n=0===s?h:Fr(n,h),r.push(n)}for(s=0;s<t.metricsTensors.length;++s){var p=t.metricsTensors[s][0],f=t.metricsTensors[s][1],d=Tn(p(o[f],l[f]));r.push(d)}return r})}},e.prototype.fit=function(t,e,n){return void 0===n&&(n={}),Ju(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,h,p,f,d,g,v,m,y,b,w,x,S=this;return Yu(this,function(E){switch(E.label){case 0:if(r=null==n.batchSize?32:n.batchSize,i=this.standardizeUserData(t,e,!1,r),o=i[0],a=i[1],s=!1,h=!1,null!=n.validationData&&n.validationData.length>0){if(s=!0,2!==n.validationData.length)throw 3===n.validationData.length?new cl("validationData including sample weights is not supported yet."):new ll("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+n.validationData+" is invalid.");u=n.validationData[0],l=n.validationData[1],p=this.standardizeUserData(u,l,!0,r),u=p[0],l=p[1],c=u.concat(l)}else null!=n.validationSplit&&n.validationSplit>0&&n.validationSplit<1?(s=!0,f=Math.floor(o[0].shape[0]*(1-n.validationSplit)),d=o[0].shape[0],u=Nh(o,f,d),o=Nh(o,0,f),l=Nh(a,f,d),a=Nh(a,0,f),h=!0,c=u.concat(l)):null!=n.validationSteps&&(s=!0);return g=o.concat(a),this.checkTrainableWeightsConsistency(),v=function(t){var e=t.slice(0,S.inputs.length),n=t.slice(S.inputs.length,S.inputs.length+S.outputs.length),r=[],i=S.collectedTrainableWeights.map(function(t){return t.read()});return[S.optimizer.minimize(function(){for(var t=[],i=0;i<S.inputs.length;++i)t.push({key:S.inputs[i],value:e[i]});var o,a=new Sh(t),s=Eh(S.outputs,a,{training:!0});for(i=0;i<S.lossFunctions.length;++i){var u=(0,S.lossFunctions[i])(n[i],s[i]);Tn(u),o=0===i?u:Fr(o,u)}for(i=0;i<S.metricsTensors.length;++i){var l=S.metricsTensors[i][0],c=S.metricsTensors[i][1],h=Tn(l(n[c],s[c]));fe(h),r.push(h)}return o=Tn(o),S.calculateLosses().forEach(function(t){o=Fr(o,t)}),o},!0,i)].concat(r)},m=this.getDedupedMetricsNames(),s?(this.makeTestFunction(),y=this.testFunction,b=m.slice().concat(m.map(function(t){return"val_"+t}))):(y=null,c=[],b=m.slice()),w=function(t){return null==t?null:t instanceof Bc?[t]:Array.isArray(t)&&t[0]instanceof Bc?t:vl(t).map(function(t){return new Vc(t)})}(n.callbacks),[4,this.fitLoop(v,g,m,r,n.epochs,n.verbose,w,y,c,n.shuffle,b,null,null,null)];case 1:return x=E.sent(),h&&(c.forEach(function(t){return t.dispose()}),o.forEach(function(t){return t.dispose()}),a.forEach(function(t){return t.dispose()})),[2,x]}})})},e.prototype.getNamedWeights=function(t){for(var e={},n=null!=t&&t.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n),o=0;o<r.length;++o)n&&!r[o].trainable||(e[r[o].originalName]=i[o]);return e},e.prototype.save=function(t,e){return Ju(this,void 0,void 0,function(){var n,r,i,o,a;return Yu(this,function(s){switch(s.label){case 0:if("string"==typeof t){if(0===(n=gu.getSaveHandlers(t)).length)throw new ll("Cannot find any save handlers for URL '"+t+"'");if(n.length>1)throw new ll("Found more than one ("+n.length+") save handlers for URL '"+t+"'");t=n[0]}if(null==t.save)throw new ll("Model.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,gu.encodeWeights(this.getNamedWeights(e))];case 1:return r=s.sent(),i=!1,o=null,a=this.toJSON(o,i),[2,t.save({modelTopology:a,weightData:r.data,weightSpecs:r.specs})]}})})},e.className="Model",Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"summary",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"compile",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"evaluate",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"predict",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"predictOnBatch",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"fit",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"save",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e)}(gc);yu.SerializationMap.register(zh);var Mh=["fanIn","fanOut","fanAvg"];var Oh=["normal","uniform"];var Lh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e)}(yu.Serializable),Fh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t,e){return li(t,e)},e.className="Zeros",e}(Lh);yu.SerializationMap.register(Fh);var _h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t,e){return si(t,e)},e.className="Ones",e}(Lh);yu.SerializationMap.register(_h);var Bh=function(t){function e(e){var n=t.call(this)||this;return n.value=e.value,n}return $u(e,t),e.prototype.apply=function(t,e){var n=this;return pe(function(){return Kr(Ii(n.value),si(t,e))})},e.prototype.getConfig=function(){return{value:this.value}},e.className="Constant",e}(Lh);yu.SerializationMap.register(Bh);var Ph=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=e.minval||n.DEFAULT_MINVAL,n.maxval=e.maxval||n.DEFAULT_MAXVAL,n.seed=e.seed,n}return $u(e,t),e.prototype.apply=function(t,e){return gi(t,this.minval,this.maxval,e)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e.className="RandomUniform",e}(Lh);yu.SerializationMap.register(Ph);var Uh=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return $u(e,t),e.prototype.apply=function(t,e){if("bool"===e)throw new cl("randomNormal does not support dType bool.");return zc(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="RandomNormal",e}(Lh);yu.SerializationMap.register(Uh);var Wh=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return $u(e,t),e.prototype.apply=function(t,e){if("bool"===e)throw new cl("truncatedNormal does not support dType bool.");return di(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="TruncatedNormal",e}(Lh);yu.SerializationMap.register(Wh);var Vh=function(t){function e(e){var n=t.call(this)||this;return n.gain=null!=e.gain?Ii(e.gain):al(1),n}return $u(e,t),e.prototype.apply=function(t,e){var n=this;return pe(function(){if(2!==t.length||t[0]!==t[1])throw new ll("Identity matrix initializer can only be used for 2D square matrices.");return Kr(n.gain,hi(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain.get()}},e.className="Identity",e}(Lh);yu.SerializationMap.register(Vh);var qh=function(t){function e(e){var n=t.call(this)||this;if(e.scale<0)throw new ll("scale must be a positive float. Got: "+e.scale);return n.scale=null==e.scale?1:e.scale,n.mode=e.mode,function(t){Cl(Mh,"FanMode",t)}(n.mode),n.distribution=e.distribution,function(t){Cl(Oh,"Distribution",t)}(n.distribution),n.seed=e.seed,n}return $u(e,t),e.prototype.apply=function(t,e){var n=function(t,e){var n,r;if(void 0===e&&(e="channelsLast"),Pl(e),2===t.length)n=t[0],r=t[1];else if(-1!==[3,4,5].indexOf(t.length))if("channelsFirst"===e){var i=bc(t,2);n=t[1]*i,r=t[0]*i}else"channelsLast"===e&&(i=bc(t,0,t.length-2),n=t[t.length-2]*i,r=t[t.length-1]*i);else{var o=bc(t);n=Math.sqrt(o),r=Math.sqrt(o)}return[n,r]}(t),r=n[0],i=n[1],o=this.scale;if("fanIn"===this.mode?o/=Math.max(1,r):"fanOut"===this.mode?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),"normal"===this.distribution){var a=Math.sqrt(o);if("bool"===e)throw new cl(this.getClassName()+" does not support dType bool.");return di(t,0,a,e,this.seed)}var s=Math.sqrt(3*o);return gi(t,-s,s,e)},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e.className="VarianceScaling",e}(Lh);yu.SerializationMap.register(qh);var Gh=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})||this}return $u(e,t),e.prototype.getClassName=function(){return qh.className},e}(qh),jh=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})||this}return $u(e,t),e.prototype.getClassName=function(){return qh.className},e}(qh),Hh=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return $u(e,t),e.prototype.getClassName=function(){return qh.className},e}(qh),$h=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return $u(e,t),e.prototype.getClassName=function(){return qh.className},e}(qh),Kh=function(t){function e(e){var n=t.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==e.gain?n.DEFAULT_GAIN:e.gain,n.seed=e.seed,null!=n.seed)throw new cl("Random seed is not implemented for Orthogonal Initializer yet.");return n}return $u(e,t),e.prototype.apply=function(t,e){var n=this;return pe(function(){if(2!==t.length)throw new cl("The Orthogonal Initializer does not support non-2D shapes yet.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+t[0]*t[1]+") elements: Slowness may result.");var e=zc(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32"),r=Zi.gramSchmidt(e);return t[0]>t[1]&&(r=r.transpose()),Kr(al(n.gain),r)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e.className="Orthogonal",e}(Lh);yu.SerializationMap.register(Kh);var Xh={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",identity:"Identity",leCunNormal:"LeCunNormal",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Jh(t,e){return void 0===e&&(e={}),xl(t,yu.SerializationMap.getMap().classNameMap,e,"initializer")}function Yh(t){return wl(t)}function Zh(t){if("string"==typeof t){var e=t in Xh?Xh[t]:t;return"GlorotUniform"===e?new Gh:"GlorotNormal"===e?new jh:"HeNormal"===e?new Hh:"LeCunNormal"===e?new $h:Jh({className:e,config:{}})}return t instanceof Lh?t:Jh(t)}var Qh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.getConfig=function(){return{}},e}(yu.Serializable),tp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=1),function(t,e){if(void 0===e&&(e=1),1!==e)throw new cl("Support for alpha values other than 1 ("+e+") is not implemented yet.");return cr(t)}(t,e)},e.className="elu",e}(Qh);yu.SerializationMap.register(tp);var ep=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t){return kr(t)},e.className="selu",e}(Qh);yu.SerializationMap.register(ep);var np=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t){return xr(t)},e.className="relu",e}(Qh);yu.SerializationMap.register(np);var rp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t){return pe(function(){return Gr(al(6),xr(t))})},e.className="relu6",e}(Qh);yu.SerializationMap.register(rp);var ip=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t){return t},e.className="linear",e}(Qh);yu.SerializationMap.register(ip);var op=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t){return Cr(t)},e.className="sigmoid",e}(Qh);yu.SerializationMap.register(op);var ap=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t){return function(t){return pe(function(){var e=Fr(al(.5),Kr(al(.2),t));return sr(e,0,1)})}(t)},e.className="hardSigmoid",e}(Qh);yu.SerializationMap.register(ap);var sp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t){return Ar(t)},e.className="softplus",e}(Qh);yu.SerializationMap.register(sp);var up=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t){return function(t){return pe(function(){return Pr(t,Fr(al(1),Qn(t)))})}(t)},e.className="softsign",e}(Qh);yu.SerializationMap.register(up);var lp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t){return Or(t)},e.className="tanh",e}(Qh);yu.SerializationMap.register(lp);var cp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=-1),Xi(t,e)},e.className="softmax",e}(Qh);function hp(t){return t.getClassName()}function pp(t,e){return void 0===e&&(e={}),xl(t,yu.SerializationMap.getMap().classNameMap,e,"activation")}function fp(t){return null==t?pp({className:"linear",config:{}}):"string"==typeof t?pp({className:t,config:{}}):t instanceof Qh?t:pp(t)}yu.SerializationMap.register(cp);var dp=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_ALPHA=.3,null==e&&(e={}),n.alpha=null==e.alpha?n.DEFAULT_ALPHA:e.alpha,n}return $u(e,t),e.prototype.call=function(t,e){var n=tc(t);return gr(n,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={alpha:this.alpha},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="LeakyReLU",e}(pc);yu.SerializationMap.register(dp);var gp=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;if(n.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==n.DEFAULT_ALPHA)throw new cl("Non-default alpha value ("+e.alpha+") is not supported by the ELU layer yet.");return n.alpha=null==e.alpha?n.DEFAULT_ALPHA:e.alpha,n}return $u(e,t),e.prototype.call=function(t,e){var n=tc(t);return cr(n)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={alpha:this.alpha},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ELU",e}(pc);yu.SerializationMap.register(gp);var vp=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_THETA=1,null==e&&(e={}),n.theta=null==e.theta?n.DEFAULT_THETA:e.theta,n.thetaTensor=al(n.theta),n}return $u(e,t),e.prototype.call=function(t,e){var n=tc(t);return n.mul(kc(n.greater(this.thetaTensor),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={theta:this.theta},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ThresholdedReLU",e}(pc);yu.SerializationMap.register(vp);var mp=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_AXIS=1,null==e&&(e={}),n.softmax=(new cp).apply,n.axis=null==e.axis?n.DEFAULT_AXIS:e.axis,n}return $u(e,t),e.prototype.call=function(t,e){var n=tc(t);return this.softmax(n,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={axis:this.axis},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Softmax",e}(pc);yu.SerializationMap.register(mp);var yp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e}(yu.Serializable),bp=function(t){function e(e){var n=t.call(this)||this,r=null==e||null==e.l1?.01:e.l1,i=null==e||null==e.l2?.01:e.l2;return n.hasL1=0!==r,n.hasL2=0!==i,n.l1=al(r),n.l2=al(i),n}return $u(e,t),e.prototype.apply=function(t){var e=this;return pe(function(){var n=li([1]);return e.hasL1&&(n=Fr(n,Ln(Kr(e.l1,Qn(t))))),e.hasL2&&(n=Fr(n,Ln(Kr(e.l2,Lc(t))))),n.asScalar()})},e.prototype.getConfig=function(){return{l1:this.l1.dataSync()[0],l2:this.l2.dataSync()[0]}},e.fromConfig=function(t,e){return new t({l1:e.l1,l2:e.l2})},e.className="L1L2",Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e)}(yp);yu.SerializationMap.register(bp);var wp={l1l2:"L1L2"};function xp(t){return wl(t)}function Sp(t,e){return void 0===e&&(e={}),xl(t,yu.SerializationMap.getMap().classNameMap,e,"regularizer")}function Ep(t){return null==t?null:"string"==typeof t?Sp({className:t in wp?wp[t]:t,config:{}}):t instanceof yp?t:Sp(t)}function kp(t,e,n){if("number"==typeof t)return pl(t,e);if(t.length!==e)throw new ll("The "+n+" argument must be a tuple of "+e+" integers. Received: "+t.length+" elements.");for(var r=0;r<e;++r){var i=t[r];if(!yc(i))throw new ll("The "+n+" argument must be a tuple of "+e+" integers. Received: "+JSON.stringify(t)+" including a non-integer number "+i)}return t}function Cp(t,e,n,r,i){return void 0===i&&(i=1),null==t?t:(o="same"===n?t:t-(e+(e-1)*(i-1))+1,Math.floor((o+r-1)/r));var o}function Rp(t,e,n,r){if(null==t)return null;if("valid"===r)t=t*e+Sc([n-e,0]);else{if("same"!==r)throw new ll("Unsupport padding mode: "+r+".");t*=e}return t}function Ip(t,e){return pe(function(){return Pl(e),"channelsFirst"===e?dn(t,[0,2,3,1]):t})}var Ap=function(t){function e(n,r){var i=t.call(this,r)||this;if(i.bias=null,i.DEFAULT_KERNEL_INITIALIZER="glorotNormal",i.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyConfig(r),i.rank=n,1!==i.rank&&2!==i.rank)throw new cl("Convolution layer for rank other than 1 or 2 ("+i.rank+") is not implemented yet.");if(i.kernelSize=kp(r.kernelSize,n,"kernelSize"),i.strides=kp(null==r.strides?1:r.strides,n,"strides"),i.padding=null==r.padding?"valid":r.padding,Wl(i.padding),i.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Pl(i.dataFormat),i.activation=fp(r.activation),i.useBias=null==r.useBias||r.useBias,i.biasInitializer=Zh(r.biasInitializer||i.DEFAULT_BIAS_INITIALIZER),i.biasConstraint=Fl(r.biasConstraint),i.biasRegularizer=Ep(r.biasRegularizer),i.activityRegularizer=Ep(r.activityRegularizer),i.dilationRate=kp(null==r.dilationRate?1:r.dilationRate,n,"dilationRate"),1===i.rank&&Array.isArray(i.dilationRate)&&1!==i.dilationRate.length)throw new ll("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(i.dilationRate));if(2===i.rank)if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate];else if(2!==i.dilationRate.length)throw new ll("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(i.dilationRate));return i}return $u(e,t),e.verifyConfig=function(t){if(fl("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!Rl(t.kernelSize,"number",1,2))throw new ll("BaseConv expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(t.kernelSize)+".")},e}(pc),Np=function(t){function e(n,r){var i=t.call(this,n,r)||this;return i.kernel=null,e.verifyConfig(r),i.filters=r.filters,i.kernelInitializer=Zh(r.kernelInitializer||i.DEFAULT_KERNEL_INITIALIZER),i.kernelConstraint=Fl(r.kernelConstraint),i.kernelRegularizer=Ep(r.kernelRegularizer),i}return $u(e,t),e.prototype.build=function(t){t=ec(t);var e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new ll("The channel dimension of the input should be defined. Found "+t[e]);var n,r=t[e],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[e]=r,n)}],this.built=!0},e.prototype.call=function(t,e){var n=this;return pe(function(){var e;t=tc(t);var r=null==n.bias?null:n.bias.read();if(1===n.rank)e=function(t,e,n,r,i,o,a){return void 0===r&&(r=1),void 0===i&&(i="valid"),void 0===a&&(a=1),pe(function(){if(null==o&&(o="channelsLast"),Pl(o),3!==t.shape.length)throw new ll("The input of a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead.");if(3!==e.shape.length)throw new ll("The kernel for a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new ll("The bias for a conv1dWithBias operation should be 1, but is "+e.shape.length+" instead");if("channelsFirst"===o&&(t=dn(t,[0,2,1])),"causal"===i)throw new cl("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=en(t,e,r,"same"===i?"same":"valid","NWC",a);return null!=n&&(s=Fc(s,n)),s})}(t,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)e=function(t,e,n,r,i,o,a){return void 0===r&&(r=[1,1]),void 0===i&&(i="valid"),pe(function(){if(null==o&&(o="channelsLast"),Pl(o),3!==t.rank&&4!==t.rank)throw new ll("conv2dWithBias expects input to be of rank 3 or 4, but received "+t.rank+".");if(3!==e.rank&&4!==e.rank)throw new ll("conv2dWithBias expects kernel to be of rank 3 or 4, but received "+t.rank+".");var s=Ip(t,o);if("causal"===i)throw new cl("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return s=nn(s,e,r,"same"===i?"same":"valid","NHWC",a),null!=n&&(s=Fc(s,n)),"channelsFirst"===o&&(s=dn(s,[0,3,1,2])),s})}(t,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else if(3===n.rank)throw new cl("3D convolution is not implemented yet.");return null!=n.activation&&(e=n.activation.apply(e)),e})},e.prototype.computeOutputShape=function(t){t=ec(t);for(var e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2),r=0;r<n.length;++r){var i=Cp(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);e.push(i)}var o=[t[0]];return"channelsLast"===this.dataFormat?(o=o.concat(e)).push(this.filters):(o.push(this.filters),o=o.concat(e)),o},e.prototype.getConfig=function(){var e={rank:this.rank,filters:this.filters,kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:hp(this.activation),useBias:this.useBias,kernelInitializer:Yh(this.kernelInitializer),biasInitializer:Yh(this.biasInitializer),kernelRegularizer:xp(this.kernelRegularizer),biasRegularizer:xp(this.biasRegularizer),activityRegularizer:xp(this.activityRegularizer),kernelConstraint:Ol(this.kernelConstraint),biasConstraint:Ol(this.biasConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.verifyConfig=function(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new ll("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(t.filters))},e}(Ap),Tp=function(t){function e(n){var r=t.call(this,2,n)||this;return e.verifyConfig(n),r}return $u(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,e},e.verifyConfig=function(t){if("number"!=typeof t.kernelSize&&!Rl(t.kernelSize,"number",1,2))throw new ll("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv2D",e}(Np);yu.SerializationMap.register(Tp);var Dp=function(t){function e(e){var n=t.call(this,e)||this;if(n.inputSpec=[new sc({ndim:4})],"same"!==n.padding&&"valid"!==n.padding)throw new ll("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return $u(e,t),e.prototype.build=function(t){if(4!==(t=ec(t)).length)throw new ll("Input should have rank 4; Received input shape: "+JSON.stringify(t));var e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new ll("The channel dimension of the inputs should be defined. Found `None`.");var n,r=t[e],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new sc({ndim:4,axes:(n={},n[e]=r,n)})],this.built=!0},e.prototype.call=function(t,e){var n=this;return pe(function(){var e=tc(t);if(4!==e.shape.length)throw new ll("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+e.shape.length);var r,i,o=e.shape,a=o[0];"channelsFirst"===n.dataFormat?(r=2,i=3):(r=1,i=2);var s=o[r],u=o[i],l=n.kernelSize[0],c=n.kernelSize[1],h=n.strides[0],p=n.strides[1],f=[a,Rp(s,h,l,n.padding),Rp(u,p,c,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(e=dn(e,[0,2,3,1]));var d=rn(e,n.kernel.read(),f,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(d=dn(d,[0,3,1,2])),null!=n.bias&&(d=Fc(d,n.bias.read(),n.dataFormat)),null!=n.activation&&(d=n.activation.apply(d)),d})},e.prototype.computeOutputShape=function(t){var e,n,r,i=(t=ec(t)).slice();"channelsFirst"===this.dataFormat?(e=1,n=2,r=3):(e=3,n=1,r=2);var o=this.kernelSize[0],a=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return i[e]=this.filters,i[n]=Rp(i[n],s,o,this.padding),i[r]=Rp(i[r],u,a,this.padding),i},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.dilationRate,e},e.className="Conv2DTranspose",e}(Tp);yu.SerializationMap.register(Dp);var zp=function(t){function e(e){return t.call(this,2,e)||this}return $u(e,t),e.className="SeparableConv2D",e}(function(t){function e(e,n){var r=t.call(this,e,n)||this;if(r.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",r.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",r.depthwiseKernel=null,r.pointwiseKernel=null,null==n.filters)throw new ll("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=n.kernelInitializer||null!=n.kernelRegularizer||null!=n.kernelConstraint)throw new ll("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=n.padding&&"same"!==n.padding&&"valid"!==n.padding)throw new ll("SeparableConv"+r.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return r.depthMultiplier=null==n.depthMultiplier?1:n.depthMultiplier,r.depthwiseInitializer=Zh(n.depthwiseInitializer||r.DEFAULT_DEPTHWISE_INITIALIZER),r.depthwiseRegularizer=Ep(n.depthwiseRegularizer),r.depthwiseConstraint=Fl(n.depthwiseConstraint),r.pointwiseInitializer=Zh(n.depthwiseInitializer||r.DEFAULT_POINTWISE_INITIALIZER),r.pointwiseRegularizer=Ep(n.pointwiseRegularizer),r.pointwiseConstraint=Fl(n.pointwiseConstraint),r}return $u(e,t),e.prototype.build=function(t){if((t=ec(t)).length<this.rank+2)throw new ll("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(t));var e,n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n]||t[n]<0)throw new ll("The channel dimension of the inputs should be defined, but found "+JSON.stringify(t[n]));for(var r=t[n],i=this.kernelSize.concat([r,this.depthMultiplier]),o=[],a=0;a<this.rank;++a)o.push(1);o.push(r*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new sc({ndim:this.rank+2,axes:(e={},e[n]=r,e)})],this.built=!0},e.prototype.call=function(t,e){var n=this;return pe(function(){var e;if(t=tc(t),1===n.rank)throw new cl("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(t=dn(t,[0,2,3,1])),e=an(t,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(e=Fc(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),"channelsFirst"===n.dataFormat&&(e=dn(e,[0,3,1,2])),e})},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Yh(this.depthwiseInitializer),e.pointwiseInitializer=Yh(this.pointwiseInitializer),e.depthwiseRegularizer=xp(this.depthwiseRegularizer),e.pointwiseRegularizer=xp(this.pointwiseRegularizer),e.depthwiseConstraint=Ol(this.depthwiseConstraint),e.pointwiseConstraint=Ol(this.pointwiseConstraint),e},e.className="SeparableConv",e}(Np));yu.SerializationMap.register(zp);var Mp=function(t){function e(n){var r=t.call(this,1,n)||this;return e.verifyConfig(n),r.inputSpec=[{ndim:3}],r}return $u(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.dataFormat,e},e.verifyConfig=function(t){if("number"!=typeof t.kernelSize&&!Rl(t.kernelSize,"number",1,1))throw new ll("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv1D",e}(Np);yu.SerializationMap.register(Mp);var Op=function(t){function e(e){var n=t.call(this,e)||this;return"number"==typeof e.cropping?n.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?n.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:n.cropping=e.cropping,n.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,n.inputSpec=[{ndim:4}],n}return $u(e,t),e.prototype.computeOutputShape=function(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,e){var n=this;return pe(function(){return t=tc(t),"channelsLast"===n.dataFormat?Ac(Ac(t,n.cropping[0][0],t.shape[1]-n.cropping[0][0]-n.cropping[0][1],2),n.cropping[1][0],t.shape[2]-n.cropping[1][1]-n.cropping[1][0],3):Ac(Ac(t,n.cropping[0][0],t.shape[2]-n.cropping[0][0]-n.cropping[0][1],3),n.cropping[1][0],t.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)})},e.prototype.getConfig=function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Cropping2D",e}(pc);yu.SerializationMap.register(Op);var Lp=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=void 0===e.size?n.DEFAULT_SIZE:e.size,n.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,n}return $u(e,t),e.prototype.computeOutputShape=function(t){if("channelsFirst"===this.dataFormat){var e=this.size[0]*t[2],n=this.size[1]*t[3];return[t[0],t[1],e,n]}return e=this.size[0]*t[1],n=this.size[1]*t[2],[t[0],e,n,t[3]]},e.prototype.call=function(t,e){var n=this;return pe(function(){var e=tc(t),r=e.shape;if("channelsFirst"===n.dataFormat){e=dn(e,[0,2,3,1]);var i=n.size[0]*r[2],o=n.size[1]*r[3],a=e.resizeNearestNeighbor([i,o]);return dn(a,[0,3,1,2])}return i=n.size[0]*r[1],o=n.size[1]*r[2],e.resizeNearestNeighbor([i,o])})},e.prototype.getConfig=function(){var e={size:this.size,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="UpSampling2D",e}(pc);yu.SerializationMap.register(Lp);var Fp=function(t){function e(e){var n=t.call(this,2,e)||this;return n.depthwiseKernel=null,n.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,n.depthwiseInitializer=Zh(e.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=Fl(e.depthwiseConstraint),n.depthwiseRegularizer=Ep(e.depthwiseRegularizer),n}return $u(e,t),e.prototype.build=function(t){if((t=ec(t)).length<4)throw new ll("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(t)+".");var e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new ll("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+t[e]+").");var n=t[e],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,e){var n=this;return pe(function(){var e=function(t,e,n,r,i,o){return void 0===n&&(n=[1,1]),void 0===r&&(r="valid"),pe(function(){null==i&&(i="channelsLast"),Pl(i);var a=Ip(t,i);if(4!==t.rank)throw new ll("Input for depthwiseConv2d is required to be 4-D, but is instead "+t.rank+"-D");if(4!==e.rank)throw new ll("depthwiseKernel is required to be 4-D, but is instead "+e.rank+"-D");return a=on(a,e,n,"same"===r?"same":"valid","NHWC",o),"channelsFirst"===i&&(a=dn(a,[0,3,1,2])),a})}(t=tc(t),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(e=Fc(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),e})},e.prototype.computeOutputShape=function(t){t=ec(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=Cp(e,this.kernelSize[0],this.padding,this.strides[0]),o=Cp(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],r,i,o]:[t[0],i,o,r]},e.className="DepthwiseConv2D",e}(Ap);yu.SerializationMap.register(Fp);var _p=function(t){function e(e){var n=t.call(this,e)||this;if(n.rate=Math.max(Math.min(e.rate,1),0),n.rateScalar=al(n.rate),n.noiseShape=e.noiseShape,n.seed=e.seed,null!=n.seed)throw new cl("Non-default seed is not implemented in Dropout layer yet: "+n.seed);return n.supportsMasking=!0,n}return $u(e,t),e.prototype.getNoiseShape=function(t){if(null==this.noiseShape)return this.noiseShape;for(var e=t.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?e[r]:this.noiseShape[r]);return n},e.prototype.call=function(t,e){var n=this;return pe(function(){n.invokeCallHook(t,e);var r=tc(t);if(null!=n.noiseShape&&!_.arraysEqual(r.shape,n.noiseShape))throw new cl("Non-default noise shape is not implemented in Dropout layer yet: "+JSON.stringify(n.noiseShape));if(0<n.rate&&n.rate<1){var i=null!=e.training&&e.training,o=n.getNoiseShape(r);return function(t,e,n){return void 0===n&&(n=!1),n?t():e()}(function(){return function(t,e,n,r){return pe(function(){if(null!=n&&!_.arraysEqual(t.shape,n))throw new cl("Non-default noise shape is not implemented yet: "+JSON.stringify(n));if(null!=r)throw new cl("seed is not implemented for dropout yet.");var i=zr(Fr(br(e),gi(t.shape,0,1,"float32")));return i=Kr(Pr(al(1),Zr(al(1),e)),i),Kr(t,i)})}(r,n.rateScalar,o,n.seed)},function(){return r},i)}return t})},e.prototype.getConfig=function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Dropout",e}(pc);yu.SerializationMap.register(_p);var Bp=function(t){function e(e){var n=t.call(this,e)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var r=null;null!=e.batchSize&&(r=e.batchSize),n.batchInputShape=[r,e.inputDim]}return n.units=e.units,n.activation=fp(e.activation),null!=e.useBias&&(n.useBias=e.useBias),n.kernelInitializer=Zh(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=Zh(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=Fl(e.kernelConstraint),n.biasConstraint=Fl(e.biasConstraint),n.kernelRegularizer=Ep(e.kernelRegularizer),n.biasRegularizer=Ep(e.biasRegularizer),n.activityRegularizer=Ep(e.activityRegularizer),n.inputSpec=[{minNDim:2}],n}return $u(e,t),e.prototype.build=function(t){var e,n=(t=ec(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(e={},e[-1]=n,e)}],this.built=!0},e.prototype.computeOutputShape=function(t){var e=(t=ec(t)).slice();return e[e.length-1]=this.units,e},e.prototype.call=function(t,e){var n=this;return pe(function(){n.invokeCallHook(t,e);var r=Mc(tc(t),n.kernel.read());return null!=n.bias&&(r=Fc(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r)),r})},e.prototype.getConfig=function(){var e={units:this.units,activation:hp(this.activation),useBias:this.useBias,kernelInitializer:Yh(this.kernelInitializer),biasInitializer:Yh(this.biasInitializer),kernelRegularizer:xp(this.kernelRegularizer),biasRegularizer:xp(this.biasRegularizer),activityRegularizer:xp(this.activityRegularizer),kernelConstraint:Ol(this.kernelConstraint),biasConstraint:Ol(this.biasConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Dense",e}(pc);yu.SerializationMap.register(Bp);var Pp=function(t){function e(e){var n=t.call(this,e||{})||this;return n.inputSpec=[{minNDim:3}],n}return $u(e,t),e.prototype.computeOutputShape=function(t){for(var e=0,n=(t=ec(t)).slice(1);e<n.length;e++)if(null==n[e])throw new ll('The shape of the input to "Flatten" is not fully defined (got '+t.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[t[0],bc(t,1)]},e.prototype.call=function(t,e){var n=this;return pe(function(){return n.invokeCallHook(t,e),function(t){if(t.rank<=1)throw new ll("batchFlatten requires a minimum rank of 2. Got rank: "+t.rank+".");var e=[t.shape[0],bc(t.shape,1)];return t.reshape(e)}(tc(t))})},e.className="Flatten",e}(pc);yu.SerializationMap.register(Pp);var Up=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.activation=fp(e.activation),n}return $u(e,t),e.prototype.call=function(t,e){var n=this;return pe(function(){n.invokeCallHook(t,e);var r=tc(t);return n.activation.apply(r)})},e.prototype.getConfig=function(){var e={activation:hp(this.activation)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Activation",e}(pc);yu.SerializationMap.register(Up);var Wp=function(t){function e(e){var n=t.call(this,e)||this;return n.n=e.n,n.inputSpec=[{ndim:2}],n}return $u(e,t),e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,e){var n=this;return pe(function(){return function(t,e){return pe(function(){if(2!==t.shape.length)throw new ll("repeat() expects a rank-2 tensor, but received a rank-"+t.shape.length+" tensor.");return Dc(Cc(t,1),[1,e,1])})}(t=tc(t),n.n)})},e.prototype.getConfig=function(){var e={n:this.n},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="RepeatVector",e}(pc);yu.SerializationMap.register(Wp);var Vp=function(t){function e(e){var n=t.call(this,e)||this;n.targetShape=e.targetShape;for(var r=0;r<n.targetShape.length;++r)n.isUnknown(n.targetShape[r])&&(n.targetShape[r]=null);return n}return $u(e,t),e.prototype.isUnknown=function(t){return t<0||null==t},e.prototype.fixUnknownDimension=function(t,e){for(var n="Total size of new array must be unchanged.",r=e.slice(),i=1,o=null,a=0;a<r.length;++a){var s=r[a];if(this.isUnknown(s)){if(null!==o)throw new ll("Can only specifiy one unknown dimension.");o=a}else i*=s}var u=bc(t);if(null!==o){if(0===i||u%i!=0)throw new ll(n);r[o]=u/i}else if(u!==i)throw new ll(n);return r},e.prototype.computeOutputShape=function(t){for(var e=!1,n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,e){var n=this;return pe(function(){n.invokeCallHook(t,e);var r=tc(t),i=r.shape,o=i.slice(0,1).concat(n.fixUnknownDimension(i.slice(1),n.targetShape));return r.reshape(o)})},e.prototype.getConfig=function(){var e={targetShape:this.targetShape},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Reshape",e}(pc);yu.SerializationMap.register(Vp);var qp=function(t){function e(e){var n=t.call(this,e)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var r=null;null!=e.batchSize&&(r=e.batchSize),null==e.inputLength?n.batchInputShape=[r,null]:n.batchInputShape=[r].concat(vl(e.inputLength))}return n.inputDim=e.inputDim,n.outputDim=e.outputDim,n.embeddingsInitializer=Zh(e.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=Ep(e.embeddingsRegularizer),n.activityRegularizer=Ep(e.activityRegularizer),n.embeddingsConstraint=Fl(e.embeddingsConstraint),n.maskZero=e.maskZero,n.inputLength=e.inputLength,n}return $u(e,t),e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.computeMask=function(t,e){throw new cl("computeMask has not been implemented for Embedding yet")},e.prototype.computeOutputShape=function(t){if(t=ec(t),null==this.inputLength)return t.concat([this.outputDim]);var e=vl(this.inputLength);if(e.length!==t.length-1)throw new ll('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);for(var n=0,r=0;r<e.length;++r){var i=e[r],o=t[r+1];if(null!=i&&null!=o&&i!==o)throw new ll('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);null==i&&(e[n]=o),n++}return[t[0]].concat(e,[this.outputDim])},e.prototype.call=function(t,e){var n=this;return pe(function(){n.invokeCallHook(t,e);var r=tc(t);return"int32"!==r.dtype&&(r=kc(r,"int32")),Oc(n.embeddings.read(),r.as1D()).reshape(ec(n.computeOutputShape(r.shape)))})},e.prototype.getConfig=function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Yh(this.embeddingsInitializer),embeddingsRegularizer:xp(this.embeddingsRegularizer),activityRegularizer:xp(this.activityRegularizer),embeddingsConstraint:Ol(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Embedding",e}(pc);yu.SerializationMap.register(qp);var Gp=function(t){function e(e){var n=t.call(this,e||{})||this;return n.supportsMasking=!0,n}return $u(e,t),e.prototype.mergeFunction=function(t){throw new cl},e.prototype.computeElementwiseOpOutputShape=function(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;for(var n=t.slice(0,t.length-e.length),r=0;r<e.length;++r){var i=t[t.length-e.length+r],o=e[r];if(null==i||null==o||i<0||o<0)n.push(null);else if(1===i)n.push(o);else if(1===o)n.push(i);else{if(i!==o)throw new ll("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(i)}}return n},e.prototype.build=function(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[ec(t)]),(t=t).length<2)throw new ll("A merge layer should be called on an Array of at least 2 inputs. Got "+t.length+" input(s).");for(var e=[],n=0,r=t;n<r.length;n++)null!=(a=r[n])&&null!==a[0]&&e.push(a[0]);if((e=El(e)).length>1)throw new ll("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(t)+".");for(var i=null==t[0]?null:t[0].slice(1),o=1;o<t.length;++o){var a=null==t[o]?null:t[o].slice(1);i=this.computeElementwiseOpOutputShape(i,a)}var s=t.map(function(t){return t.length});-1===t.indexOf(null)&&1===El(s).length?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,e){var n=this;return pe(function(){if(t=t,n.reshapeRequired){var e=[],r=t.map(function(t){return t.rank});if(-1===r.indexOf(null)){for(var i=Sc(r),o=0,a=t;o<a.length;o++){for(var s=(p=a[o]).rank,u=0;u<i-s;++u)p=Cc(p,1);e.push(p)}return n.mergeFunction(e)}for(var l=!1,c=0,h=t;c<h.length;c++){var p;if(null==(s=(p=h[c]).rank)){var f=p.shape,d=f[0],g=f.slice(1).concat([d]),v=p.reshape([d].concat(bc(f.slice(1))));v=(v=dn(v,[1,0])).reshape(g),e.push(v),l=!0}else if(s>1){var m=Ec(1,s).concat([0]);e.push(dn(p,m)),l=!0}else e.push(p)}var y=n.mergeFunction(e),b=y.rank;if(l)if(null==b){var w=y.shape;g=[d=w[w.length-1]].concat(w.slice(0,w.length-1)),y=dn(y.reshape([-1,d]),[1,0]).reshape(g)}else b>1&&(m=[b-1].concat(Ec(0,b-1)),y=dn(y,m));return y}return n.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var e;e=null==(t=t)[0]?null:t[0].slice(1);for(var n=1;n<t.length;++n){var r=null==t[n]?null:t[n].slice(1);e=this.computeElementwiseOpOutputShape(e,r)}for(var i=[],o=0,a=t;o<a.length;o++)null!=(r=a[o])&&null!==r[0]&&i.push(r[0]);return 1===(i=El(i)).length?i.concat(e):[null].concat(e)},e}(pc),jp=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.mergeFunction=function(t){return pe(function(){for(var e=li(t[0].shape),n=0,r=t;n<r.length;n++){var i=r[n];e=Fr(e,i)}return e})},e.className="Add",e}(Gp);yu.SerializationMap.register(jp);var Hp=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.mergeFunction=function(t){return pe(function(){for(var e=si(t[0].shape),n=0,r=t;n<r.length;n++){var i=r[n];e=Kr(e,i)}return e})},e.className="Multiply",e}(Gp);yu.SerializationMap.register(Hp);var $p=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.mergeFunction=function(t){return pe(function(){for(var e=li(t[0].shape),n=0,r=t;n<r.length;n++){var i=r[n];e=Fr(e,i)}return Kr(al(1/t.length),e)})},e.className="Average",e}(Gp);yu.SerializationMap.register($p);var Kp=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.mergeFunction=function(t){return pe(function(){for(var e=t[0],n=1;n<t.length;++n)e=Vr(e,t[n]);return e})},e.className="Maximum",e}(Gp);yu.SerializationMap.register(Kp);var Xp=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.mergeFunction=function(t){return pe(function(){for(var e=t[0],n=1;n<t.length;++n)e=Gr(e,t[n]);return e})},e.className="Minimum",e}(Gp);yu.SerializationMap.register(Xp);var Jp=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_AXIS=-1,null==e&&(e={}),n.axis=null==e.axis?n.DEFAULT_AXIS:e.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return $u(e,t),e.prototype.build=function(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new ll("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var e=!0,n=0,r=t=t;n<r.length;n++)if(null!=(c=r[n])){e=!1;break}if(!e){for(var i=[],o=0;o<t.length;++o){var a=t[o].slice();a.splice(this.axis,1);for(var s=!1,u=0,l=i;u<l.length;u++){var c=l[u];if(_.arraysEqual(c,a)){s=!0;break}}s||i.push(a)}if(i.length>1)throw new ll("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var e=this;return pe(function(){return Nc(t,e.axis)})},e.prototype.computeOutputShape=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new ll("A `Concatenate` layer should be called on a list of inputs.");for(var e=t,n=e[0].slice(),r=this.axis<0?n.length+this.axis:this.axis,i=0,o=e.slice(1);i<o.length;i++){var a=o[i];if(null==n[r]||null==a[r]){n[r]=null;break}n[r]+=a[r]}return n},e.prototype.getConfig=function(){var e={axis:this.axis},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Concatenate",e}(Gp);function Yp(t,e,n,r,i,o){var a;if(void 0===o&&(o=.001),2===t.rank)a=$e(t,e,n,o,i,r);else if(3===t.rank)a=Ke(t,e,n,o,i,r);else{if(4!==t.rank)throw new cl("batchNormalization is not implememnted for array of rank "+t.rank+" yet");a=Xe(t,e,n,o,i,r)}return a}function Zp(t,e,n,r,i){return void 0===i&&(i=.001),_.arraysEqual(r.slice().sort(),Ec(0,t.rank-1))?function(t,e,n,r,i){return void 0===i&&(i=.001),pe(function(){var o=On(t,r),a=o.mean,s=o.variance;return[Yp(t,a,s,n,e,i),a,s]})}(t,e,n,r,i):function(t,e,n,r,i){return void 0===i&&(i=.001),pe(function(){for(var o=On(t,r),a=o.mean,s=o.variance,u=[],l=0,c=Ec(0,t.rank);l<c.length;l++){var h=c[l];-1!==r.indexOf(h)?u.push(1):u.push(t.shape[h])}var p=a.reshape(u),f=s.reshape(u),d=null==e?null:e.reshape(u),g=null==n?null:n.reshape(u);return[Yp(t,p,f,g,d,i),a,s]})}(t,e,n,r,i)}yu.SerializationMap.register(Jp);var Qp=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.axis=null==e.axis?-1:e.axis,n.momentum=null==e.momentum?.99:e.momentum,n.epsilon=null==e.epsilon?.001:e.epsilon,n.center=null==e.center||e.center,n.scale=null==e.scale||e.scale,n.betaInitializer=Zh(e.betaInitializer||"zeros"),n.gammaInitializer=Zh(e.gammaInitializer||"ones"),n.movingMeanInitializer=Zh(e.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=Zh(e.movingVarianceInitializer||"ones"),n.betaConstraint=Fl(e.betaConstraint),n.gammaConstraint=Fl(e.gammaConstraint),n.betaRegularizer=Ep(e.betaRegularizer),n.gammaRegularizer=Ep(e.gammaRegularizer),n.stepCount=0,n}return $u(e,t),e.prototype.build=function(t){t=ec(t);var e=this.axis>=0?this.axis:this.axis+t.length,n=t[e];if(null==n)throw new ll("Axis "+e+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(t)+".");this.inputSpec=[new sc({ndim:t.length,axes:(r={},r[e]=n,r)})];var r,i=[n];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,e){var n=this;return pe(function(){var r=null!=e.training&&e.training,i=tc(t),o=i.shape,a=o.length,s=Ec(0,a),u=n.axis>=0?n.axis:n.axis+a;s.splice(u,1);var l=pl(1,a);l[u]=o[u];var c=s.slice();c.sort();var h=!_.arraysEqual(c,Ec(0,a).slice(0,a-1));if(!r)return function(){if(h){var t=n.movingMean.read().reshape(l),e=n.movingVariance.read().reshape(l),r=n.center?n.beta.read().reshape(l):null,o=n.scale?n.gamma.read().reshape(l):null;return Yp(i,t,e,r,o,n.epsilon)}return Yp(i,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var p=Zp(i,n.gamma.read(),n.beta.read(),s,n.epsilon),f=p[0],d=p[1],g=p[2],v=bc(s.map(function(t){return i.shape[t]})),m=g.mul(al(v/(v-(1+n.epsilon))));return function(){n.stepCount++;var t=Hi(n.movingMean.read(),d,n.momentum,n.stepCount);n.movingMean.write(t);var e=Hi(n.movingVariance.read(),m,n.momentum,n.stepCount);n.movingVariance.write(e)}(),f})},e.prototype.getConfig=function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Yh(this.betaInitializer),gammaInitializer:Yh(this.gammaInitializer),movingMeanInitializer:Yh(this.movingMeanInitializer),movingVarianceInitializer:Yh(this.movingVarianceInitializer),betaRegularizer:xp(this.betaRegularizer),gammaRegularizer:xp(this.gammaRegularizer),betaConstraint:Ol(this.betaConstraint),gammaConstraint:Ol(this.gammaConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="BatchNormalization",e}(pc);yu.SerializationMap.register(Qp);var tf=function(t){function e(e){var n=this;if(null==e&&(e={}),(n=t.call(this,e)||this).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)n.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)n.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new ll("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+e.padding.length+" array.");var r=void 0,i=void 0;if("number"==typeof e.padding[0])r=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new ll("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+e.padding[0].length+" array.");if(r=e.padding[0],2!==e.padding[1].length)throw new ll("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+e.padding[1].length+" array.");i=e.padding[1]}n.padding=[r,i]}return n.inputSpec=[new sc({ndim:4})],n}return $u(e,t),e.prototype.computeOutputShape=function(t){var e,n;return t=ec(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])},e.prototype.call=function(t,e){var n=this;return pe(function(){return function(t,e,n){return pe(function(){if(4!==t.rank)throw new ll("temporalPadding expects input tensor to be 4-D, but received a "+t.rank+"-D tensor.");if(null==e&&(e=[[1,1],[1,1]]),2!==e.length||2!==e[0].length||2!==e[1].length)throw new ll("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new ll("Unknown data format: "+n+". Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return r="channelsFirst"===n?[[0,0],[0,0],e[0],e[1]]:[[0,0],e[0],e[1],[0,0]],Ui(t,r)})}(tc(t),n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={padding:this.padding,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ZeroPadding2D",e}(pc);function ef(t,e,n,r,i,o){return pe(function(){var a;Pl(i),function(t){Cl(Vl,"PoolMode",t)}(o),Wl(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==o&&(o="max"),t=Ip(t,i);var s="same"===r?"same":"valid";return a="max"===o?fn(t,e,n,s):pn(t,e,n,s),"channelsFirst"===i&&(a=dn(a,[0,3,1,2])),a})}yu.SerializationMap.register(tf);var nf=function(t){function e(e){var n=this;if(null==e.poolSize&&(e.poolSize=2),n=t.call(this,e)||this,"number"==typeof e.poolSize)n.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new ll("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));n.poolSize=e.poolSize}if(null==e.strides)n.strides=n.poolSize;else if("number"==typeof e.strides)n.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new ll("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));n.strides=e.strides}return n.padding=null==e.padding?"valid":e.padding,Wl(n.padding),n.inputSpec=[new sc({ndim:3})],n}return $u(e,t),e.prototype.computeOutputShape=function(t){var e=Cp((t=ec(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]},e.prototype.call=function(t,e){var n=this;return pe(function(){n.invokeCallHook(t,e),t=Cc(tc(t),2);var r=n.poolingFunction(tc(t),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return yi(r,[2])})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(pc),rf=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.poolingFunction=function(t,e,n,r,i){return Pl(i),Wl(r),ef(t,e,n,r,i,"max")},e.className="MaxPooling1D",e}(nf);yu.SerializationMap.register(rf);var of=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.poolingFunction=function(t,e,n,r,i){return Pl(i),Wl(r),ef(t,e,n,r,i,"avg")},e.className="AveragePooling1D",e}(nf);yu.SerializationMap.register(of);var af=function(t){function e(e){var n=this;if(null==e.poolSize&&(e.poolSize=[2,2]),(n=t.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)n.strides=n.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new ll("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");n.strides=e.strides}else n.strides=[e.strides,e.strides];return n.padding=null==e.padding?"valid":e.padding,n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Pl(n.dataFormat),Wl(n.padding),n.inputSpec=[new sc({ndim:4})],n}return $u(e,t),e.prototype.computeOutputShape=function(t){t=ec(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=Cp(e,this.poolSize[0],this.padding,this.strides[0]),n=Cp(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]},e.prototype.call=function(t,e){var n=this;return pe(function(){return n.invokeCallHook(t,e),n.poolingFunction(tc(t),n.poolSize,n.strides,n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(pc),sf=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.poolingFunction=function(t,e,n,r,i){return Pl(i),Wl(r),ef(t,e,n,r,i,"max")},e.className="MaxPooling2D",e}(af);yu.SerializationMap.register(sf);var uf=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.poolingFunction=function(t,e,n,r,i){return Pl(i),Wl(r),ef(t,e,n,r,i,"avg")},e.className="AveragePooling2D",e}(af);yu.SerializationMap.register(uf);var lf=function(t){function e(e){var n=t.call(this,e)||this;return n.inputSpec=[new sc({ndim:3})],n}return $u(e,t),e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,e){throw new cl},e}(pc),cf=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.call=function(t,e){return pe(function(){var e=tc(t);return Tn(e,1)})},e.className="GlobalAveragePooling1D",e}(lf);yu.SerializationMap.register(cf);var hf=function(t){function e(e){return t.call(this,e)||this}return $u(e,t),e.prototype.call=function(t,e){return pe(function(){var e=tc(t);return Nn(e,1)})},e.className="GlobalMaxPooling1D",e}(lf);yu.SerializationMap.register(hf);var pf=function(t){function e(e){var n=t.call(this,e)||this;return n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Pl(n.dataFormat),n.inputSpec=[new sc({ndim:4})],n}return $u(e,t),e.prototype.computeOutputShape=function(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,e){throw new cl},e.prototype.getConfig=function(){var e={dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(pc),ff=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.call=function(t,e){var n=this;return pe(function(){var e=tc(t);return"channelsLast"===n.dataFormat?Tn(e,[1,2]):Tn(e,[2,3])})},e.className="GlobalAveragePooling2D",e}(pf);yu.SerializationMap.register(ff);var df=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.call=function(t,e){var n=this;return pe(function(){var e=tc(t);return"channelsLast"===n.dataFormat?Nn(e,[1,2]):Nn(e,[2,3])})},e.className="GlobalMaxPooling2D",e}(pf);function gf(t,e,n,r,i,o,a,s){void 0===r&&(r=!1),void 0===a&&(a=!1);var u=e.shape.length;if(u<3)throw new ll("Input should be at least 3D, but is "+u+"D.");var l,c,h=[1,0].concat(Ec(2,u));if(e=dn(e,h),null!=i)throw new cl("The rnn() function of the deeplearn.js backend does not support masking yet.");if(null!=o)throw new cl("The rnn() functoin of the deeplearn.js backend does not support constants yet.");a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r&&(e=gn(e,0));for(var p=n,f=e.shape[0],d=0;d<f;++d){var g=Rc(e,d,1),v=t(g=g.reshape(g.shape.slice(1)),p);c=v[0],l=0===d?c.reshape([1].concat(c.shape)):Tc(l,c.reshape([1].concat(c.shape))),p=v[1]}return[c,dn(l,[1,0].concat(Ec(2,l.shape.length))),p]}yu.SerializationMap.register(df);var vf=function(t){function e(e){var n,r=t.call(this,e)||this;if(null==e.cell)throw new ll("cell property is missing for the constructor of RNN.");if(null==(n=Array.isArray(e.cell)?new kf({cells:e.cell}):e.cell).stateSize)throw new ll("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=n,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new sc({ndim:3})],r.stateSpec=null,r.states=null,r.numConstants=null,r}return $u(e,t),e.prototype.getStates=function(){return null==this.states?Ec(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(t){return null}):this.states},e.prototype.setStates=function(t){this.states=t},e.prototype.computeOutputShape=function(t){Zl(t)&&(t=t[0]),t=t;var e=this.cell.stateSize;Array.isArray(e)||(e=[e]);var n,r=e[0];if(n=this.returnSequences?[t[0],t[1],r]:[t[0],r],this.returnState){for(var i=[],o=0,a=e;o<a.length;o++){var s=a[o];i.push([t[0],s])}return[n].concat(i)}return n},e.prototype.computeMask=function(t,e){throw new cl("computeMask has not been implemented for RNN yet")},e.prototype.build=function(t){if(null!=this.numConstants)throw new cl("Constants support is not implemented in RNN yet.");Zl(t)&&(t=t[0]),t=t;var e=this.stateful?t[0]:null,n=t[t.length-1];this.inputSpec[0]=new sc({shape:[e,null,n]});var r,i=[t[0]].concat(t.slice(2));if(this.cell.build(i),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!_.arraysEqual(this.stateSpec.map(function(t){return t.shape[t.shape.length-1]}),r))throw new ll("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=r.map(function(t){return new sc({shape:[null,t]})});if(this.stateful)throw new cl("stateful RNN layer is not implemented yet")},e.prototype.resetStates=function(t){var e=this;pe(function(){if(!e.stateful)throw new sl("Cannot call resetState() on an RNN Layer that is not stateful.");var n=e.inputSpec[0].shape[0];if(null==n)throw new ll("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==e.states)Array.isArray(e.cell.stateSize)?e.states=e.cell.stateSize.map(function(t){return li([n,t])}):e.states=[li([n,e.cell.stateSize])];else if(null==t)Array.isArray(e.cell.stateSize)?e.states=e.cell.stateSize.map(function(t){return li([n,t])}):e.states[0]=li([n,e.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==e.states.length)throw new ll("Layer "+e.name+" expects "+e.states.length+" state(s), but it received "+t.length+" state value(s). Input received: "+t);for(var r=0;r<e.states.length;++r){var i=t[r],o=Array.isArray(e.cell.stateSize)?e.cell.stateSize[r]:e.cell.stateSize,a=[n,o];if(!_.arraysEqual(i.shape,a))throw new ll("State "+r+" is incompatible with layer "+e.name+": expected shape="+a+", received shape="+i.shape);e.states[r]=i}}})},e.prototype.standardizeArgs=function(t,e,n){if(Array.isArray(t)){if(null!=e||null!=n)throw new ll("When inputs is an array, neither initialState or constants should be provided");null!=this.numConstants&&(n=t.slice(t.length-this.numConstants,t.length),t=t.slice(0,t.length-this.numConstants)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=r(e),constants:n=r(n)}},e.prototype.apply=function(e,n){var r=null==n?null:n.initialState,i=null==n?null:n.constants;null==n&&(n={});var o=this.standardizeArgs(e,r,i);e=o.inputs,r=o.initialState,i=o.constants;var a=[],s=[];if(null!=r){n.initialState=r,a=a.concat(r),this.stateSpec=[];for(var u=0,l=r;u<l.length;u++){var c=l[u];this.stateSpec.push(new sc({shape:c.shape}))}s=s.concat(this.stateSpec)}if(null!=i&&(n.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof uc){var h=[e].concat(a),p=this.inputSpec.concat(s),f=this.inputSpec;this.inputSpec=p;var d=t.prototype.apply.call(this,h,n);return this.inputSpec=f,d}return t.prototype.apply.call(this,e,n)},e.prototype.call=function(t,e){var n=this;return pe(function(){var r=null==e?null:e.mask,i=null==e?null:e.training,o=null==e?null:e.initialState;if(t=tc(t),null==o){if(n.stateful)throw new cl("stateful RNN layer is not implemented yet.");o=n.getInitialState(t)}if(null!=r)throw new cl("Masking is not implemented for RNN yet");var a=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(o.length!==a)throw new ll("RNN Layer has "+a+" state(s) but was passed "+o.length+" initial state(s).");t.shape[1];n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:i},u=gf(function(t,e){var r=n.cell.call([t].concat(e),s);return[r[0],r.slice(1)]},t,o,n.goBackwards,null,null,n.unroll),l=u[0],c=u[1],h=u[2];if(n.stateful)throw new cl("stateful RNN layer is not implemented yet");var p=n.returnSequences?c:l;return n.returnState?[p].concat(h):p})},e.prototype.getInitialState=function(t){var e=this;return pe(function(){var n=li(t.shape);return n=Cc(n=Ln(n,[1,2])),Array.isArray(e.cell.stateSize)?e.cell.stateSize.map(function(t){return t>1?Dc(n,[1,t]):n}):e.cell.stateSize>1?[Dc(n,[1,e.cell.stateSize])]:[n]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);var n=this.cell.getConfig();e.cell={className:this.cell.getClassName(),config:n};var r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="RNN",e}(pc);yu.SerializationMap.register(vf);var mf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e)}(pc),yf=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,n.activation=fp(null==e.activation?n.DEFAULT_ACTIVATION:e.activation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=Zh(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Zh(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Zh(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=Ep(e.kernelRegularizer),n.recurrentRegularizer=Ep(e.recurrentRegularizer),n.biasRegularizer=Ep(e.biasRegularizer),n.kernelConstraint=Fl(e.kernelConstraint),n.recurrentConstraint=Fl(e.recurrentConstraint),n.biasConstraint=Fl(e.biasConstraint),n.dropout=xc([1,Sc([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=xc([1,Sc([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.stateSize=n.units,n}return $u(e,t),e.prototype.build=function(t){t=ec(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,e){var n=this;return pe(function(){if(2!==(t=t).length)throw new ll("SimpleRNNCell expects 2 input Tensors, got "+t.length+".");var e=t[1];if(t=t[0],0!==n.dropout||0!==n.recurrentDropout)throw new cl("Dropout is not implemented for SimpleRNNCell yet");var r=Mc(t,n.kernel.read());null!=n.bias&&(r=Fc(r,n.bias.read()));var i=Fr(r,Mc(e,n.recurrentKernel.read()));return null!=n.activation&&(i=n.activation.apply(i)),[i,i]})},e.prototype.getConfig=function(){var e={units:this.units,activation:hp(this.activation),useBias:this.useBias,kernelInitializer:Yh(this.kernelInitializer),recurrentInitializer:Yh(this.recurrentInitializer),biasInitializer:Yh(this.biasInitializer),kernelRegularizer:xp(this.kernelRegularizer),recurrentRegularizer:xp(this.recurrentRegularizer),biasRegularizer:xp(this.biasRegularizer),activityRegularizer:xp(this.activityRegularizer),kernelConstraint:Ol(this.kernelConstraint),recurrentConstraint:Ol(this.recurrentConstraint),biasConstraint:Ol(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="SimpleRNNCell",e}(mf);yu.SerializationMap.register(yf);var bf=function(t){function e(e){return e.cell=new yf(e),t.call(this,e)||this}return $u(e,t),e.prototype.call=function(e,n){var r=this;return pe(function(){var i=null==n?null:n.mask,o=null==n?null:n.training,a=null==n?null:n.initialState;return t.prototype.call.call(r,e,{mask:i,training:o,initialState:a})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:hp(this.activation),useBias:this.useBias,kernelInitializer:Yh(this.kernelInitializer),recurrentInitializer:Yh(this.recurrentInitializer),biasInitializer:Yh(this.biasInitializer),kernelRegularizer:xp(this.kernelRegularizer),recurrentRegularizer:xp(this.recurrentRegularizer),biasRegularizer:xp(this.biasRegularizer),activityRegularizer:xp(this.activityRegularizer),kernelConstraint:Ol(this.kernelConstraint),recurrentConstraint:Ol(this.recurrentConstraint),biasConstraint:Ol(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.className="SimpleRNN",e}(vf);yu.SerializationMap.register(bf);var wf=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,n.activation=fp(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=fp(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=Zh(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Zh(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Zh(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=Ep(e.kernelRegularizer),n.recurrentRegularizer=Ep(e.recurrentRegularizer),n.biasRegularizer=Ep(e.biasRegularizer),n.kernelConstraint=Fl(e.kernelConstraint),n.recurrentConstraint=Fl(e.recurrentConstraint),n.biasConstraint=Fl(e.biasConstraint),n.dropout=xc([1,Sc([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=xc([1,Sc([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=n.units,n}return $u(e,t),e.prototype.build=function(t){var e=(t=ec(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,e){var n=this;return pe(function(){if(0!==n.dropout||0!==n.recurrentDropout)throw new cl("Dropout is not implemented for GRUCell yet");if(2!==(t=t).length)throw new ll("GRUCell expects 2 input Tensors (inputs, h, c), got "+t.length+".");var e,r,i,o=t[1];if(t=t[0],1===n.implementation){var a=Ic(n.kernel.read(),0,n.units),s=Ic(n.kernel.read(),n.units,n.units),u=Ic(n.kernel.read(),2*n.units,n.units),l=Ic(n.recurrentKernel.read(),0,n.units),c=Ic(n.recurrentKernel.read(),n.units,n.units),h=Ic(n.recurrentKernel.read(),2*n.units,n.units),p=t,f=t,d=Mc(t,a),g=Mc(p,s),v=Mc(f,u);if(n.useBias){var m=Rc(n.bias.read(),0,n.units),y=Rc(n.bias.read(),n.units,n.units),b=Rc(n.bias.read(),2*n.units,n.units);d=Fc(d,m),g=Fc(g,y),v=Fc(v,b)}var w=o,x=o,S=o;e=n.recurrentActivation.apply(Fr(d,Mc(w,l))),r=n.recurrentActivation.apply(Fr(g,Mc(x,c))),i=n.activation.apply(Fr(v,Mc(Kr(r,S),h)))}else{var E=Mc(t,n.kernel.read());n.useBias&&(E=Fc(E,n.bias.read()));var k=Mc(o,Ic(n.recurrentKernel.read(),0,2*n.units)),C=(d=Ic(E,0,n.units),g=Ic(E,n.units,n.units),Ic(k,0,n.units)),R=Ic(k,n.units,n.units);e=n.recurrentActivation.apply(Fr(d,C)),r=n.recurrentActivation.apply(Fr(g,R)),v=Ic(E,2*n.units,n.units);var I=Mc(Kr(r,o),Ic(n.recurrentKernel.read(),2*n.units,n.units));i=n.activation.apply(Fr(v,I))}var A=Fr(Kr(e,o),Kr(Fr(al(1),br(e)),i));return[A,A]})},e.prototype.getConfig=function(){var e={units:this.units,activation:hp(this.activation),recurrentActivation:hp(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Yh(this.kernelInitializer),recurrentInitializer:Yh(this.recurrentInitializer),biasInitializer:Yh(this.biasInitializer),kernelRegularizer:xp(this.kernelRegularizer),recurrentRegularizer:xp(this.recurrentRegularizer),biasRegularizer:xp(this.biasRegularizer),activityRegularizer:xp(this.activityRegularizer),kernelConstraint:Ol(this.kernelConstraint),recurrentConstraint:Ol(this.recurrentConstraint),biasConstraint:Ol(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="GRUCell",e}(mf);yu.SerializationMap.register(wf);var xf=function(t){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new wf(e),t.call(this,e)||this}return $u(e,t),e.prototype.call=function(e,n){var r=this;return pe(function(){var i=null==n?null:n.mask,o=null==n?null:n.training,a=null==n?null:n.initialState;return t.prototype.call.call(r,e,{mask:i,training:o,initialState:a})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:hp(this.activation),recurrentActivation:hp(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Yh(this.kernelInitializer),recurrentInitializer:Yh(this.recurrentInitializer),biasInitializer:Yh(this.biasInitializer),kernelRegularizer:xp(this.kernelRegularizer),recurrentRegularizer:xp(this.recurrentRegularizer),biasRegularizer:xp(this.biasRegularizer),activityRegularizer:xp(this.activityRegularizer),kernelConstraint:Ol(this.kernelConstraint),recurrentConstraint:Ol(this.recurrentConstraint),biasConstraint:Ol(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},e.className="GRU",e}(vf);yu.SerializationMap.register(xf);var Sf=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,n.activation=fp(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=fp(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=Zh(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Zh(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Zh(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=e.unitForgetBias,n.kernelRegularizer=Ep(e.kernelRegularizer),n.recurrentRegularizer=Ep(e.recurrentRegularizer),n.biasRegularizer=Ep(e.biasRegularizer),n.kernelConstraint=Fl(e.kernelConstraint),n.recurrentConstraint=Fl(e.recurrentConstraint),n.biasConstraint=Fl(e.biasConstraint),n.dropout=xc([1,Sc([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=xc([1,Sc([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=[n.units,n.units],n}return $u(e,t),e.prototype.build=function(t){var e,n,r=(t=ec(t))[t.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var i=this.biasInitializer,o=this.units;e=new((n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $u(e,t),e.prototype.apply=function(t,e){var n=i.apply([o]),r=(new _h).apply([o]),a=i.apply([2*o]);return Tc(Tc(n,r),a)},e}(Lh)).className="CustomInit",n)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,e,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,e){var n=this;return pe(function(){if(0!==n.dropout||0!==n.recurrentDropout)throw new cl("Dropout is not implemented for LSTMCell yet");if(3!==(t=t).length)throw new ll("LSTMCell expects 3 input Tensors (inputs, h, c), got "+t.length+".");var e,r,i,o,a=t[1],s=t[2];if(t=t[0],1===n.implementation){var u=Ic(n.kernel.read(),0,n.units),l=Ic(n.kernel.read(),n.units,n.units),c=Ic(n.kernel.read(),2*n.units,n.units),h=Ic(n.kernel.read(),3*n.units,n.units),p=Ic(n.recurrentKernel.read(),0,n.units),f=Ic(n.recurrentKernel.read(),n.units,n.units),d=Ic(n.recurrentKernel.read(),2*n.units,n.units),g=Ic(n.recurrentKernel.read(),3*n.units,n.units),v=t,m=t,y=t,b=Mc(t,u),w=Mc(v,l),x=Mc(m,c),S=Mc(y,h);if(n.useBias){var E=Rc(n.bias.read(),0,n.units),k=Rc(n.bias.read(),n.units,n.units),C=Rc(n.bias.read(),2*n.units,n.units),R=Rc(n.bias.read(),3*n.units,n.units);b=Fc(b,E),w=Fc(w,k),x=Fc(x,C),S=Fc(S,R)}var I=a,A=a,N=a,T=a;e=n.recurrentActivation.apply(Fr(b,Mc(I,p))),r=n.recurrentActivation.apply(Fr(w,Mc(A,f))),i=Fr(Kr(r,s),Kr(e,n.activation.apply(Fr(x,Mc(N,d))))),o=n.recurrentActivation.apply(Fr(S,Mc(T,g)))}else{var D=Mc(t,n.kernel.read());D=Fr(D,Mc(a,n.recurrentKernel.read())),n.useBias&&(D=Fc(D,n.bias.read()));var z=Ic(D,0,n.units),M=Ic(D,n.units,n.units),O=Ic(D,2*n.units,n.units),L=Ic(D,3*n.units,n.units);e=n.recurrentActivation.apply(z),r=n.recurrentActivation.apply(M),i=Fr(Kr(r,s),Kr(e,n.activation.apply(O))),o=n.recurrentActivation.apply(L)}var F=Kr(o,n.activation.apply(i));return[F,F,i]})},e.prototype.getConfig=function(){var e={units:this.units,activation:hp(this.activation),recurrentActivation:hp(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Yh(this.kernelInitializer),recurrentInitializer:Yh(this.recurrentInitializer),biasInitializer:Yh(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:xp(this.kernelRegularizer),recurrentRegularizer:xp(this.recurrentRegularizer),biasRegularizer:xp(this.biasRegularizer),activityRegularizer:xp(this.activityRegularizer),kernelConstraint:Ol(this.kernelConstraint),recurrentConstraint:Ol(this.recurrentConstraint),biasConstraint:Ol(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="LSTMCell",e}(mf);yu.SerializationMap.register(Sf);var Ef=function(t){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Sf(e),t.call(this,e)||this}return $u(e,t),e.prototype.call=function(e,n){var r=this;return pe(function(){var i=null==n?null:n.mask,o=null==n?null:n.training,a=null==n?null:n.initialState;return t.prototype.call.call(r,e,{mask:i,training:o,initialState:a})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:hp(this.activation),recurrentActivation:hp(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Yh(this.kernelInitializer),recurrentInitializer:Yh(this.recurrentInitializer),biasInitializer:Yh(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:xp(this.kernelRegularizer),recurrentRegularizer:xp(this.recurrentRegularizer),biasRegularizer:xp(this.biasRegularizer),activityRegularizer:xp(this.activityRegularizer),kernelConstraint:Ol(this.kernelConstraint),recurrentConstraint:Ol(this.recurrentConstraint),biasConstraint:Ol(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},e.className="LSTM",e}(vf);yu.SerializationMap.register(Ef);var kf=function(t){function e(e){var n=t.call(this,e)||this;return n.cells=e.cells,n}return $u(e,t),Object.defineProperty(e.prototype,"stateSize",{get:function(){for(var t=[],e=0,n=this.cells.slice().reverse();e<n.length;e++){var r=n[e];Array.isArray(r.stateSize)?t.push.apply(t,r.stateSize):t.push(r.stateSize)}return t},enumerable:!0,configurable:!0}),e.prototype.call=function(t,e){var n=this;return pe(function(){for(var r=(t=t).slice(1),i=[],o=0,a=n.cells.slice().reverse();o<a.length;o++){var s=a[o];Array.isArray(s.stateSize)?i.push(r.splice(0,s.stateSize.length)):i.push(r.splice(0,1))}i.reverse();for(var u,l=[],c=0;c<n.cells.length;++c)s=n.cells[c],r=i[c],u=0===c?[t[0]].concat(r):[u[0]].concat(r),u=s.call(u,e),l.push(u.slice(1));r=[];for(var h=0,p=l.slice().reverse();h<p.length;h++){var f=p[h];r.push.apply(r,f)}return[u[0]].concat(r)})},e.prototype.build=function(t){var e;Zl(t)&&(t=t[0]),t=t;for(var n=0,r=this.cells;n<r.length;n++){var i=r[n];i.build(t),e=Array.isArray(i.stateSize)?i.stateSize[0]:i.stateSize,t=[t[0],e]}this.built=!0},e.prototype.getConfig=function(){for(var e=[],n=0,r=this.cells;n<r.length;n++){var i=r[n];e.push({className:this.getClassName(),config:i.getConfig()})}var o={cells:e},a=t.prototype.getConfig.call(this);return Object.assign(o,a),o},e.fromConfig=function(t,e,n){void 0===n&&(n={});for(var r=[],i=0,o=e.cells;i<o.length;i++){var a=o[i];r.push(Jl(a,n))}return new t({cells:r})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var t=[],e=0,n=this.cells;e<n.length;e++){var r=n[e];t.push.apply(t,r.trainableWeights)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],e=0,n=this.cells;e<n.length;e++){var r=n[e];t.push.apply(t,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],o=0,a=this.cells;o<a.length;o++)r=a[o],i.push.apply(i,r.trainableWeights);return i.concat(t)}return t},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){for(var t=[],e=0,n=this.cells;e<n.length;e++){var r=n[e];t.push.apply(t,r.weights)}return oc(t)},e.prototype.setWeights=function(t){for(var e=[],n=0,r=this.cells;n<r.length;n++)for(var i=r[n],o=i.weights.length,a=t.splice(o),s=0;s<i.weights.length;++s)e.push([i.weights[s],a[s]]);ac(e)},e.className="StackedRNNCells",e}(mf);yu.SerializationMap.register(kf);var Cf=function(t){function e(e){var n=t.call(this,e)||this;return n.layer=e.layer,n}return $u(e,t),e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(t){null!=this.layer&&(this.layer.trainable=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.fromConfig=function(t,e,n){void 0===n&&(n={});var r=Jl(e.layer,n);delete e.layer;var i={layer:r};return Object.assign(i,e),new t(i)},e}(pc),Rf=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n}return $u(e,t),e.prototype.build=function(e){if((e=ec(e)).length<3)throw new ll("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),t.prototype.build.call(this,e)},e.prototype.computeOutputShape=function(t){var e=[(t=ec(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e),r=t[1];return[n[0],r].concat(n.slice(1))},e.prototype.call=function(t,e){var n=this;return pe(function(){return gf(function(t,r){return[n.layer.call(t,e),[]]},t=tc(t),[],!1,null,null,!1,t.shape[1])[1]})},e.className="TimeDistributed",e}(Cf);yu.SerializationMap.register(Rf);var If=["sum","mul","concat","ave"];var Af=function(t){function e(e){var n=t.call(this,e)||this,r=e.layer.getConfig();if(n.forwardLayer=Jl({className:e.layer.getClassName(),config:r}),r.goBackwards=!0!==r.goBackwards,n.backwardLayer=Jl({className:e.layer.getClassName(),config:r}),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,function(t){Cl(If,"BidirectionalMergeMode",t)}(e.mergeMode),n.mergeMode=e.mergeMode,e.weights)throw new cl("weights support is not implemented for Bidirectional layer yet.");return n._stateful=e.layer.stateful,n.returnSequences=e.layer.returnSequences,n.returnState=e.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=e.layer.inputSpec,n}return $u(e,t),Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var e=t.length,n=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,n)),this.backwardLayer.setWeights(t.slice(n))},e.prototype.computeOutputShape=function(t){var e,n,r,i=this.forwardLayer.computeOutputShape(t);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState?(r=i.slice(1),e=i[0]):e=i[0],e=e,"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[e].concat(r).concat(r.slice()):gl(n)},e.prototype.apply=function(e,n){var r=null;if(null!=n&&(r=n.initialState),Array.isArray(e)&&(r=e.slice(1),e=e[0]),null==r||0===r.length)return t.prototype.apply.call(this,e,n);throw new cl("The support for initial states is not implemented for Bidirectional layers yet.")},e.prototype.call=function(t,e){var n=this;return pe(function(){if(null!=e.mask)throw new cl("The support for masking is not implemented for Bidirectional layers yet.");if(null!=e.initialState)throw new cl("The support for initial states is not implemented for Bidirectional layers yet.");var r,i,o=n.forwardLayer.call(t,e),a=n.backwardLayer.call(t,e);return n.returnState&&(Array.isArray(o)&&(r=o.slice(1).concat(a.slice(1))),o=o[0],a=a[0]),n.returnSequences&&(a=gn(a,1)),"concat"===n.mergeMode?i=Nc([o,a]):"sum"===n.mergeMode?i=Fr(o,a):"ave"===n.mergeMode?i=Kr(al(.5),Fr(o,a)):"mul"===n.mergeMode?i=Kr(o,a):null==n.mergeMode&&(i=[o,a]),n.returnState?null==n.mergeMode?i.concat(r):[i].concat(r):i})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var e=this;jl(this.forwardLayer.name,function(){e.forwardLayer.build(t)}),jl(this.backwardLayer.name,function(){e.backwardLayer.build(t)}),this.built=!0},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={mergeMode:this.mergeMode},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.fromConfig=function(t,e){var n=Jl(e.layer);if(delete e.layer,null!=e.numConstants)throw new cl("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=e;return r.layer=n,new t(r)},e.className="Bidirectional",e}(Cf);function Nf(t){return Ju(this,void 0,void 0,function(){var e;return Yu(this,function(n){if("string"==typeof t){if(0===(e=gu.getLoadHandlers(t)).length)e.push(gu.browserHTTPRequest(t));else if(e.length>1)throw new ll("Found more than one ("+e.length+") load handlers for URL '"+t+"'");t=e[0]}return[2,function(t,e){return Ju(this,void 0,void 0,function(){var n,r,i,o,a;return Yu(this,function(s){switch(s.label){case 0:if(null==t.load)throw new ll("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,t.load()];case 1:if(n=s.sent(),null!=(r=n.modelTopology).model_config&&(r=r.model_config),i=Jl(function t(e,n){if(null===e)return null;if("string"==typeof e)return yl(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var r=[],i=e.length,o=0;o<i;++o){var a=e[o];Yl(n,o,a)?r.push(a):r.push(t(a,n))}return r}for(var s={},u=0,l=Object.keys(e);u<l.length;u++){var c=l[u],h=e[c];if("name"===c&&"string"==typeof h)s[c]=h;else{var p=yl(c);s[p]=t(h,p)}}return s}(r),e),null!=n.weightData){if(null==n.weightSpecs)throw new ll("Model artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");o=!1,a=!0,i.loadWeights(gu.decodeWeights(n.weightData,n.weightSpecs),o,a)}return[2,i]}})})}(t)]})})}yu.SerializationMap.register(Af);var Tf=function(t){function e(e){var n=t.call(this,{inputs:[],outputs:[]})||this;if(e=e||{},n.trainable=!0,n._updatable=!0,n.built=!1,n.name=null!=e.name?e.name:rl("sequential_"),null!=e.layers)for(var r=0,i=e.layers;r<i.length;r++){var o=i[r];n.add(o)}return n}return $u(e,t),n=e,e.prototype.add=function(t){var e,r=t instanceof n||t instanceof zh;if(r){if(1!==(e=t).outputs.length)throw new ll("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==e.inputs.length)throw new ll("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new ll("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=dc({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(r)this.outputs=e.outputs,this.inputs=e.inputs;else{if(1!==t.inboundNodes.length)throw new ll("A layer added to a Sequential model must not already be connected somewhere else. Model received layer "+t.name+" which has "+t.inboundNodes.length+" pre-existing inbound connections.");if(1!==t.inboundNodes[0].outputTensors.length)throw new ll("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=function t(e,n,r){if((null==n||null!=r&&r>0)&&(n=e.sourceLayer,r=e.nodeIndex),0===n.inboundNodes.length)return[e];var i=n.inboundNodes[r];if(0===i.inboundLayers.length)return i.inputTensors;for(var o=[],a=0;a<i.inboundLayers.length;a++)for(var s=0,u=t(i.inputTensors[a],i.inboundLayers[a],i.nodeIndices[a]);s<u.length;s++){var l=u[s];-1===o.indexOf(l)&&o.push(l)}return o}(this.outputs[0])}this.inboundNodes=[],new cc({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:pl(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(t){return t.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,e){return null==this.model&&this.build(),this.model.call(t,e)},e.prototype.build=function(t){if(ec(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new zh({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.model.updatable=this.updatable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),t.prototype.countParams.call(this)},e.prototype.summary=function(e,n,r){void 0===r&&(r=console.log),this.built||this.build(),t.prototype.summary.call(this,e,n,r)},e.prototype.setWeights=function(t){null==this.model&&this.build(),this.model.setWeights(t)},Object.defineProperty(e.prototype,"updatable",{get:function(){return this._updatable},set:function(t){this.built&&(this.model.updatable=t),this._updatable=t},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t,e,n){if(void 0===n&&(n={}),!this.built)throw new ul("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)},e.prototype.predict=function(t,e){return void 0===e&&(e={}),null==this.model&&this.build(),this.model.predict(t,e)},e.prototype.predictOnBatch=function(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer=this.model.optimizer,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},e.prototype.fit=function(t,e,n){return void 0===n&&(n={}),Ju(this,void 0,void 0,function(){return Yu(this,function(r){if(!this.built)throw new ul("The model needs to be compiled before being used.");return[2,this.model.fit(t,e,n)]})})},e.fromConfig=function(t,e){var r=new t({});if(!(r instanceof n))throw new ll("Sequential.fromConfig called on non-Sequential input: "+r);if(!(e instanceof Array))throw new ll("Sequential.fromConfig called without an array of configs");if(null==e[0].className||"Merge"===e[0].className)throw new ll("Legacy serialization format not supported yet.");for(var i=0,o=e;i<o.length;i++){var a=Jl(o[i]);r.add(a)}return r},e.prototype.getConfig=function(){for(var t=[],e=0,n=this.layers;e<n.length;e++){var r=n[e];t.push({className:r.getClassName(),config:r.getConfig()})}return t},e.className="Sequential",Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"add",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"summary",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"evaluate",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"predict",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e.prototype,"fit",null),n=Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],e);var n}(zh);yu.SerializationMap.register(Tf);var Df=function(){function t(){}return t.model=function(t){return new zh(t)},t.sequential=function(t){return new Tf(t)},t.loadModel=function(t){return Nf(t)},t.input=function(t){return dc(t)},Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"model",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"sequential",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"loadModel",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"input",null),t}(),zf=function(){function t(){}return t.inputLayer=function(t){return new fc(t)},t.elu=function(t){return new gp(t)},t.leakyReLU=function(t){return new dp(t)},t.softmax=function(t){return new mp(t)},t.thresholdedReLU=function(t){return new vp(t)},t.conv1d=function(t){return new Mp(t)},t.conv2d=function(t){return new Tp(t)},t.conv2dTranspose=function(t){return new Dp(t)},t.separableConv2d=function(t){return new zp(t)},t.cropping2D=function(t){return new Op(t)},t.upSampling2d=function(t){return new Lp(t)},t.depthwiseConv2d=function(t){return new Fp(t)},t.activation=function(t){return new Up(t)},t.dense=function(t){return new Bp(t)},t.dropout=function(t){return new _p(t)},t.flatten=function(t){return new Pp(t)},t.repeatVector=function(t){return new Wp(t)},t.reshape=function(t){return new Vp(t)},t.embedding=function(t){return new qp(t)},t.add=function(t){return new jp(t)},t.average=function(t){return new $p(t)},t.concatenate=function(t){return new Jp(t)},t.maximum=function(t){return new Kp(t)},t.minimum=function(t){return new Xp(t)},t.multiply=function(t){return new Hp(t)},t.batchNormalization=function(t){return new Qp(t)},t.zeroPadding2d=function(t){return new tf(t)},t.averagePooling1d=function(t){return new of(t)},t.avgPool1d=function(e){return t.averagePooling1d(e)},t.avgPooling1d=function(e){return t.averagePooling1d(e)},t.averagePooling2d=function(t){return new uf(t)},t.avgPool2d=function(e){return t.averagePooling2d(e)},t.avgPooling2d=function(e){return t.averagePooling2d(e)},t.globalAveragePooling1d=function(t){return new cf(t)},t.globalAveragePooling2d=function(t){return new ff(t)},t.globalMaxPooling1d=function(t){return new hf(t)},t.globalMaxPooling2d=function(t){return new df(t)},t.maxPooling1d=function(t){return new rf(t)},t.maxPooling2d=function(t){return new sf(t)},t.gru=function(t){return new xf(t)},t.gruCell=function(t){return new wf(t)},t.lstm=function(t){return new Ef(t)},t.lstmCell=function(t){return new Sf(t)},t.simpleRNN=function(t){return new bf(t)},t.simpleRNNCell=function(t){return new yf(t)},t.rnn=function(t){return new vf(t)},t.stackedRNNCells=function(t){return new kf(t)},t.bidirectional=function(t){return new Af(t)},t.timeDistributed=function(t){return new Rf(t)},t.Layer=pc,t.RNN=vf,t.RNNCell=mf,t.input=Df.input,Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"inputLayer",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"elu",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"leakyReLU",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"softmax",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"thresholdedReLU",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"conv1d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"conv2d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"conv2dTranspose",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"separableConv2d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"cropping2D",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"upSampling2d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"depthwiseConv2d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"activation",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"dense",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"dropout",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"flatten",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"repeatVector",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"reshape",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"embedding",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"add",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"average",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"concatenate",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"maximum",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"minimum",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"multiply",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"batchNormalization",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"zeroPadding2d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"averagePooling1d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"averagePooling2d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"globalAveragePooling1d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"globalAveragePooling2d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"globalMaxPooling1d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"globalMaxPooling2d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"maxPooling1d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"maxPooling2d",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"gru",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"gruCell",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"lstm",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"lstmCell",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"simpleRNN",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"simpleRNNCell",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"rnn",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"stackedRNNCells",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"bidirectional",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"timeDistributed",null),t}(),Mf=function(){function t(){}return t.maxNorm=function(t){return new Nl(t)},t.unitNorm=function(t){return new Tl(t)},t.nonNeg=function(){return new Dl},t.minMaxNorm=function(t){return new zl(t)},Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"maxNorm",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"unitNorm",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"nonNeg",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"minMaxNorm",null),t}(),Of=function(){function t(){}return t.zeros=function(){return new Fh},t.ones=function(){return new _h},t.constant=function(t){return new Bh(t)},t.randomUniform=function(t){return new Ph(t)},t.randomNormal=function(t){return new Uh(t)},t.truncatedNormal=function(t){return new Wh(t)},t.identity=function(t){return new Vh(t)},t.varianceScaling=function(t){return new qh(t)},t.glorotUniform=function(t){return new Gh(t)},t.glorotNormal=function(t){return new jh(t)},t.heNormal=function(t){return new Hh(t)},t.leCunNormal=function(t){return new $h(t)},t.orthogonal=function(t){return new Kh(t)},Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"zeros",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"ones",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"constant",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"randomUniform",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"randomNormal",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"truncatedNormal",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"identity",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"varianceScaling",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"glorotUniform",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"glorotNormal",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"heNormal",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"leCunNormal",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"orthogonal",null),t}(),Lf=function(){function t(){}return t.binaryAccuracy=function(t,e){return oh(t,e)},t.binaryCrossentropy=function(t,e){return sh(t,e)},t.categoricalAccuracy=function(t,e){return ah(t,e)},t.categoricalCrossentropy=function(t,e){return Zc(t,e)},t.cosineProximity=function(t,e){return rh(t,e)},t.prototype.meanAbsoluteError=function(t,e){return jc(t,e)},t.prototype.meanAbsolutePercentageError=function(t,e){return Hc(t,e)},t.prototype.MAPE=function(t,e){return Hc(t,e)},t.prototype.mape=function(t,e){return Hc(t,e)},t.meanSquaredError=function(t,e){return Gc(t,e)},t.MSE=function(t,e){return Gc(t,e)},t.mse=function(t,e){return Gc(t,e)},Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"meanAbsoluteError",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t.prototype,"meanAbsolutePercentageError",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"binaryAccuracy",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"binaryCrossentropy",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"categoricalAccuracy",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"categoricalCrossentropy",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"cosineProximity",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"meanSquaredError",null),t}(),Ff=function(){function t(){}return t.l1l2=function(t){return new bp(t)},t.l1=function(t){return function(t){return new bp({l1:null!=t?t.l1:null,l2:0})}(t)},t.l2=function(t){return function(t){return new bp({l2:null!=t?t.l2:null,l1:0})}(t)},Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"l1l2",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"l1",null),Xu([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}],t,"l2",null),t}(),_f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=null,e}return $u(e,t),e.prototype.setModel=function(t){if(!(t instanceof zh))throw new Error("model must be a Model, not some other Container");this.model=t},e}(Bc),Bf=Df.model,Pf=Df.sequential,Uf=Df.loadModel,Wf=Df.input,Vf=zf,qf=Mf,Gf=Of,jf=Lf,Hf=Ff,$f={"tfjs-core":"0.12.0","tfjs-layers":"0.7.0",tfjs:"0.12.0"};t.version=$f,t.setBackend=Wu,t.getBackend=Vu,t.disposeVariables=qu,t.memory=Gu,t.version_core="0.12.0",t.nextFrame=ju,t.environment=wt,t.io=gu,t.serialization=yu,t.test_util=Ru,t.util=_,t.webgl=Iu,t.AdadeltaOptimizer=zu,t.AdagradOptimizer=Mu,t.AdamOptimizer=Ou,t.AdamaxOptimizer=Lu,t.MomentumOptimizer=_u,t.Optimizer=Au,t.RMSPropOptimizer=Bu,t.SGDOptimizer=Fu,t.Tensor=$,t.TensorBuffer=q,t.variable=X,t.Variable=K,t.ENV=bt,t.Environment=dt,t.doc=a,t.batchNormalization=He,t.batchNormalization2d=$e,t.batchNormalization3d=Ke,t.batchNormalization4d=Xe,t.concat=Je,t.concat1d=Ye,t.concat2d=Ze,t.concat3d=Qe,t.concat4d=tn,t.conv1d=en,t.conv2d=nn,t.conv2dTranspose=rn,t.depthwiseConv2d=on,t.separableConv2d=an,t.matMul=sn,t.matrixTimesVector=un,t.outerProduct=ln,t.vectorTimesMatrix=cn,t.dot=hn,t.avgPool=pn,t.maxPool=fn,t.transpose=dn,t.reverse=gn,t.reverse1d=vn,t.reverse2d=mn,t.reverse3d=yn,t.reverse4d=bn,t.slice=wn,t.slice1d=xn,t.slice2d=Sn,t.slice3d=En,t.slice4d=kn,t.stridedSlice=Cn,t.argMax=Rn,t.argMin=In,t.logSumExp=An,t.max=Nn,t.mean=Tn,t.min=Dn,t.all=zn,t.any=Mn,t.moments=On,t.sum=Ln,t.equal=Fn,t.equalStrict=_n,t.greater=Bn,t.greaterStrict=Pn,t.greaterEqual=Un,t.greaterEqualStrict=Wn,t.less=Vn,t.lessStrict=qn,t.lessEqual=Gn,t.lessEqualStrict=jn,t.notEqual=Hn,t.notEqualStrict=$n,t.logicalNot=Kn,t.logicalAnd=Xn,t.logicalOr=Jn,t.logicalXor=Yn,t.where=Zn,t.abs=Qn,t.acos=tr,t.acosh=er,t.asin=nr,t.asinh=rr,t.atan=ir,t.atanh=or,t.ceil=ar,t.clipByValue=sr,t.cos=ur,t.cosh=lr,t.elu=cr,t.exp=hr,t.expm1=pr,t.floor=fr,t.sign=dr,t.leakyRelu=gr,t.log=vr,t.log1p=mr,t.logSigmoid=yr,t.neg=br,t.prelu=wr,t.relu=xr,t.reciprocal=Sr,t.round=Er,t.selu=kr,t.sigmoid=Cr,t.sin=Rr,t.sinh=Ir,t.softplus=Ar,t.sqrt=Nr,t.rsqrt=Tr,t.square=Dr,t.step=zr,t.tan=Mr,t.tanh=Or,t.erf=Lr,t.add=Fr,t.addStrict=_r,t.atan2=Br,t.div=Pr,t.floorDiv=Ur,t.divStrict=Wr,t.maximum=Vr,t.maximumStrict=qr,t.minimum=Gr,t.minimumStrict=jr,t.mod=Hr,t.modStrict=$r,t.mul=Kr,t.mulStrict=Xr,t.pow=Jr,t.powStrict=Yr,t.sub=Zr,t.subStrict=Qr,t.squaredDifference=ti,t.squaredDifferenceStrict=ei,t.norm=ni,t.cast=ri,t.clone=ii,t.fromPixels=oi,t.toPixels=ai,t.ones=si,t.onesLike=ui,t.zeros=li,t.zerosLike=ci,t.eye=hi,t.rand=pi,t.randomNormal=fi,t.truncatedNormal=di,t.randomUniform=gi,t.multinomial=vi,t.reshape=mi,t.squeeze=yi,t.tile=bi,t.gather=wi,t.oneHot=xi,t.linspace=Si,t.range=Ei,t.buffer=ki,t.fill=Ci,t.tensor=Ri,t.scalar=Ii,t.tensor1d=Ai,t.tensor2d=Ni,t.tensor3d=Ti,t.tensor4d=Di,t.tensor5d=zi,t.tensor6d=Mi,t.print=Oi,t.expandDims=Li,t.stack=Fi,t.unstack=_i,t.split=Bi,t.cumsum=Pi,t.pad=Ui,t.pad1d=Wi,t.pad2d=Vi,t.pad3d=qi,t.pad4d=Gi,t.unsortedSegmentSum=ji,t.movingAverage=Hi,t.basicLSTMCell=$i,t.multiRNNCell=Ki,t.softmax=Xi,t.sigmoidCrossEntropyWithLogits=Ji,t.localResponseNormalization=Yi,t.linalg=Zi,t.losses=Qi,t.image=to,t.operation=Mt,t.train=Uu,t.tidy=pe,t.keep=fe,t.dispose=de,t.time=ge,t.grad=ve,t.valueAndGrad=me,t.grads=ye,t.valueAndGrads=be,t.variableGrads=we,t.customGrad=xe,t.model=Bf,t.sequential=Pf,t.loadModel=Uf,t.input=Wf,t.layers=Vf,t.constraints=qf,t.initializers=Gf,t.metrics=jf,t.regularizers=Hf,t.CallbackList=Pc,t.CustomCallback=Vc,t.Callback=_f,t.SymbolicTensor=uc,t.Model=zh,t.RNN=vf,t.Sequential=Tf,t.version_layers="0.7.0",Object.defineProperty(t,"__esModule",{value:!0})});
